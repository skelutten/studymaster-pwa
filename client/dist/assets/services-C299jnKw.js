import{d as e,p as t}from"./data-vendor-WMMcZ37Z.js";import{aa as r,ab as a}from"./vendor-By12O1K7.js";import{R as n,j as s}from"./react-vendor-Cb7t3V5P.js";class o{config;errors=[];sessionId;initialized=!1;constructor(e={}){this.config={maxStoredErrors:100,enableConsoleLogging:!0,enableLocalStorage:!0,environment:"production",...e},this.sessionId=this.generateSessionId(),this.loadStoredErrors(),this.setupGlobalErrorHandlers(),this.initialized=!0,this.logInfo("Error tracking initialized",{sessionId:this.sessionId})}logError(e,t){const r=this.createErrorReport("error",e,t);this.recordError(r)}logWarning(e,t){const r=this.createErrorReport("warning",e,t);this.recordError(r)}logInfo(e,t){const r=this.createErrorReport("info",e,t);this.recordError(r)}getErrors(){return[...this.errors]}clearErrors(){this.errors=[],this.config.enableLocalStorage&&localStorage.removeItem("studymaster_errors")}getErrorStats(){const e=Date.now()-36e5,t={total:this.errors.length,byLevel:{error:0,warning:0,info:0},recent:0};return this.errors.forEach(r=>{t.byLevel[r.level]++,new Date(r.timestamp).getTime()>e&&t.recent++}),t}exportErrors(){return JSON.stringify(this.errors,null,2)}createErrorReport(e,t,r){const a=t instanceof Error?t.message:t,n=t instanceof Error?t.stack:void 0;return{id:this.generateErrorId(),timestamp:(new Date).toISOString(),level:e,message:a,stack:n,userAgent:navigator.userAgent,url:window.location.href,sessionId:this.sessionId,context:r||{}}}recordError(e){if(this.errors.unshift(e),this.errors.length>this.config.maxStoredErrors&&(this.errors=this.errors.slice(0,this.config.maxStoredErrors)),this.config.enableConsoleLogging){("error"===e.level?console.error:"warning"===e.level?console.warn:console.log)(`[ErrorTracker] ${e.message}`,e)}if(this.config.enableLocalStorage)try{localStorage.setItem("studymaster_errors",JSON.stringify(this.errors.slice(0,50)))}catch(t){this.errors=this.errors.slice(0,25);try{localStorage.setItem("studymaster_errors",JSON.stringify(this.errors))}catch(r){console.warn("Error tracking: Local storage disabled due to quota issues")}}this.config.apiEndpoint&&"production"===this.config.environment&&this.sendToRemote(e).catch(e=>{console.warn("Failed to send error to remote endpoint:",e)})}loadStoredErrors(){if(this.config.enableLocalStorage)try{const e=localStorage.getItem("studymaster_errors");if(e){const t=JSON.parse(e);Array.isArray(t)&&(this.errors=t)}}catch(e){console.warn("Failed to load stored errors:",e)}}setupGlobalErrorHandlers(){if(window.addEventListener("error",e=>{this.logError(e.error||new Error(e.message),{filename:e.filename,lineno:e.lineno,colno:e.colno,type:"unhandled_error"})}),window.addEventListener("unhandledrejection",e=>{this.logError(new Error(`Unhandled promise rejection: ${e.reason}`),{type:"unhandled_promise_rejection",reason:e.reason})}),window.React){const e=window.console.error;window.console.error=(...t)=>{const r=t[0];"string"==typeof r&&r.includes("React")&&this.logError(new Error(r),{type:"react_error",args:t}),e.apply(console,t)}}}async sendToRemote(e){if(this.config.apiEndpoint)try{await fetch(this.config.apiEndpoint,{method:"POST",headers:{"Content-Type":"application/json",...this.config.apiKey?{Authorization:`Bearer ${this.config.apiKey}`}:{}},body:JSON.stringify({...e,environment:this.config.environment,userAgent:navigator.userAgent,timestamp:(new Date).toISOString()})})}catch(t){console.warn("Failed to send error to remote endpoint:",t)}}generateSessionId(){return`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}generateErrorId(){return`error_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}}const i=new o({environment:"production",maxStoredErrors:100,enableConsoleLogging:!1,enableLocalStorage:!0}),logError=(e,t)=>i.logError(e,t),logWarning=(e,t)=>i.logWarning(e,t),logInfo=(e,t)=>i.logInfo(e,t);n.Component;class c extends r{settings;users;decks;cards;reviews;media;achievements;challenges;leaderboardCache;syncQueue;constructor(){super("studymaster"),this.version(1).stores({settings:"id",users:"deviceUserId",decks:"deckId, updatedAt",cards:"cardId, deckId, dueAt, updatedAt",reviews:"reviewId, cardId, reviewedAt",media:"mediaHash",achievements:"achievementId, userId",challenges:"challengeId",leaderboardCache:"scope, fetchedAt",syncQueue:"queueId, createdAt"}),this.settings=this.table("settings"),this.users=this.table("users"),this.decks=this.table("decks"),this.cards=this.table("cards"),this.reviews=this.table("reviews"),this.media=this.table("media"),this.achievements=this.table("achievements"),this.challenges=this.table("challenges"),this.leaderboardCache=this.table("leaderboardCache"),this.syncQueue=this.table("syncQueue"),this.on("populate",async()=>{try{const e=Date.now();await this.settings.get("settings")||await this.settings.add({id:"settings",theme:"system",shortcuts:{},featureFlags:{},encryptionEnabled:!1,createdAt:e,updatedAt:e})}catch(e){logError(e instanceof Error?e:new Error(String(e)),{scope:"db.populate"})}}),this.on("ready",()=>{logInfo("DB ready",{scope:"db.ready"})}),this.on("blocked",e=>{logWarning("DB blocked - close other tabs or reload to proceed",{event:e,scope:"db.blocked"})}),this.on("versionchange",()=>{logInfo("DB versionchange - closing to allow upgrade",{scope:"db.versionchange"}),this.close()})}}let l=null;function getDB(){return l||(l=new c),l}async function ensureDBOpen(){const e=getDB();if(!e.isOpen())try{await e.open()}catch(t){throw console.error("[DB] open error:",t),t}return e}const d=new Proxy({},{get(e,t,r){const a=getDB(),n=Reflect.get(a,t,r);return"function"==typeof n?n.bind(a):n}}),h={totalXP:2500,level:5,currentLevelXP:100,nextLevelXP:500,cardsStudied:1250,studyTime:2400,accuracy:87.5,currentStreak:15,longestStreak:28,coins:150,gems:10,lastStudyDate:(new Date).toISOString(),joinDate:new Date(Date.now()-2592e6).toISOString()},u=[{id:"first_study",name:"First Steps",description:"Complete your first study session",icon:"ðŸŽ¯",unlockedAt:new Date(Date.now()-216e7).toISOString(),category:"study"},{id:"week_streak",name:"Week Warrior",description:"Study for 7 days in a row",icon:"ðŸ”¥",unlockedAt:new Date(Date.now()-864e6).toISOString(),category:"streak"}],g=[{id:"monthly_mastery",name:"Monthly Mastery Challenge",description:"Complete an intensive month-long study challenge with progressive difficulty",type:"monthly",target:1e3,current:245,reward:{xp:1500,coins:500,gems:50},expiresAt:new Date(Date.now()+2592e6).toISOString()},{id:"knowledge_seeker",name:"Knowledge Seeker",description:"Explore diverse subjects and maintain high accuracy throughout the month",type:"monthly",target:800,current:156,reward:{xp:1200,coins:400,gems:30},expiresAt:new Date(Date.now()+216e7).toISOString()}],m=[{id:"daily_grind",name:"Daily Grind",description:"Study 25 cards today",type:"daily",target:25,current:18,reward:{xp:50,coins:10},expiresAt:new Date(Date.now()+864e5).toISOString()},{id:"weekly_warrior",name:"Weekly Warrior",description:"Study 200 cards this week",type:"weekly",target:200,current:145,reward:{xp:200,coins:50,gems:5},expiresAt:new Date(Date.now()+2592e5).toISOString()},...g],y={global:[{userId:"demo1",username:"StudyMaster",score:5420,rank:1,change:0},{userId:"demo2",username:"FlashcardPro",score:4890,rank:2,change:1},{userId:"demo3",username:"MemoryWiz",score:4650,rank:3,change:-1},{userId:"demo4",username:"QuizKing",score:4200,rank:4,change:2},{userId:"demo_user",username:"Demo User",score:2500,rank:15,change:3}],friends:[{userId:"friend1",username:"StudyBuddy",score:3200,rank:1,change:0},{userId:"demo_user",username:"Demo User",score:2500,rank:2,change:1},{userId:"friend2",username:"LearningPal",score:2100,rank:3,change:-1}],weekly:[{userId:"demo1",username:"StudyMaster",score:890,rank:1,change:2},{userId:"demo_user",username:"Demo User",score:420,rank:8,change:5}],monthly:[{userId:"demo1",username:"StudyMaster",score:3200,rank:1,change:0},{userId:"demo_user",username:"Demo User",score:1800,rank:12,change:-2}]};class f{baseUrl="/api";isDemoUser(e){return"demo"===e.tokenType||"demo@studymaster.app"===e.email}async getUserStats(r){if(e.log("[USER_DATA_SERVICE]","START - getUserStats",{userId:r.id,isDemoUser:this.isDemoUser(r)}),this.isDemoUser(r))return e.log("[USER_DATA_SERVICE]","Returning demo user stats"),h;try{e.log("[USER_DATA_SERVICE]","Attempting to fetch user stats from PocketBase");const a=await t.collection("users").getOne(r.id,{fields:"level,total_xp,coins,gems,last_active,created,preferences"});e.log("[USER_DATA_SERVICE]","PocketBase user stats fetched successfully");return{totalXP:a.total_xp||0,level:a.level||1,currentLevelXP:(a.total_xp||0)%200,nextLevelXP:200,cardsStudied:0,studyTime:0,accuracy:85,currentStreak:0,longestStreak:0,coins:a.coins||100,gems:a.gems||10,lastStudyDate:a.last_active||(new Date).toISOString(),joinDate:a.created||(new Date).toISOString()}}catch(a){e.warn("[USER_DATA_SERVICE]","PocketBase fetch failed, trying REST API fallback",{error:a});try{const t=await fetch(`${this.baseUrl}/users/${r.id}/stats`,{headers:{Authorization:`Bearer ${r.token}`,"Content-Type":"application/json"}});if(!t.ok)throw new Error("Failed to fetch user stats from REST API");const a=await t.json();return e.log("[USER_DATA_SERVICE]","REST API user stats fetched successfully"),a}catch(n){return e.warn("[USER_DATA_SERVICE]","Both PocketBase and REST API failed, using mock data",{pocketbaseError:a,apiError:n}),this.generatePersonalizedMockStats(r)}}}async getUserActivity(e,t=30){if(this.isDemoUser(e))return this.generateDemoActivity(t);try{const r=await fetch(`${this.baseUrl}/users/${e.id}/activity?days=${t}`,{headers:{Authorization:`Bearer ${e.token}`,"Content-Type":"application/json"}});if(!r.ok)throw new Error("Failed to fetch user activity");return await r.json()}catch(r){return console.warn("Failed to fetch real user activity, using mock data:",r),this.generatePersonalizedActivity(e,t)}}async getUserAchievements(e){if(this.isDemoUser(e))return u;try{const t=await fetch(`${this.baseUrl}/users/${e.id}/achievements`,{headers:{Authorization:`Bearer ${e.token}`,"Content-Type":"application/json"}});if(!t.ok)throw new Error("Failed to fetch user achievements");return await t.json()}catch(t){return console.warn("Failed to fetch real user achievements, using mock data:",t),this.generatePersonalizedAchievements(e)}}async getUserChallenges(e){if(this.isDemoUser(e))return m;try{const t=await fetch(`${this.baseUrl}/users/${e.id}/challenges`,{headers:{Authorization:`Bearer ${e.token}`,"Content-Type":"application/json"}});if(!t.ok)throw new Error("Failed to fetch user challenges");return await t.json()}catch(t){return console.warn("Failed to fetch real user challenges, using mock data:",t),this.generatePersonalizedChallenges(e)}}async getLeaderboardData(e){if(this.isDemoUser(e))return y;try{const t=await fetch(`${this.baseUrl}/leaderboard`,{headers:{Authorization:`Bearer ${e.token}`,"Content-Type":"application/json"}});if(!t.ok)throw new Error("Failed to fetch leaderboard data");return await t.json()}catch(t){return console.warn("Failed to fetch real leaderboard data, using mock data:",t),this.generatePersonalizedLeaderboard(e)}}async getPerformanceMetrics(e){if(this.isDemoUser(e))return this.generateDemoPerformanceMetrics();try{const t=await fetch(`${this.baseUrl}/users/${e.id}/performance`,{headers:{Authorization:`Bearer ${e.token}`,"Content-Type":"application/json"}});if(!t.ok)throw new Error("Failed to fetch performance metrics");return await t.json()}catch(t){return console.warn("Failed to fetch real performance metrics, using mock data:",t),this.generatePersonalizedPerformanceMetrics(e)}}async getCompleteUserProfile(e){const[t,r,a,n,s]=await Promise.all([this.getUserStats(e),this.getUserActivity(e,30),this.getUserAchievements(e),this.getUserChallenges(e),this.getPerformanceMetrics(e)]);return{stats:t,activity:r,achievements:a,challenges:n,performance:s}}async resetAllUserData(e){if(!this.isDemoUser(e))try{if(!(await fetch(`${this.baseUrl}/users/${e.id}/reset`,{method:"POST",headers:{Authorization:`Bearer ${e.token}`,"Content-Type":"application/json"}})).ok)throw new Error("Failed to reset user data")}catch(t){console.warn("Failed to reset real user data via API:",t)}}generatePersonalizedMockStats(e){const t=this.hashString(e.email),r=Math.floor(t%60)+1;return{totalXP:Math.floor(t%1e3)+100,level:Math.floor(t%1e3/200)+1,currentLevelXP:t%200,nextLevelXP:200,cardsStudied:Math.floor(t%500)+50,studyTime:Math.floor(t%1200)+60,accuracy:75+t%20,currentStreak:Math.floor(t%15)+1,longestStreak:Math.floor(t%30)+5,coins:Math.floor(t%200)+50,gems:Math.floor(t%20)+5,lastStudyDate:(new Date).toISOString(),joinDate:new Date(Date.now()-24*r*60*60*1e3).toISOString()}}generatePersonalizedActivity(e,t){const r=[];for(let a=0;a<t;a++){const t=new Date(Date.now()-24*a*60*60*1e3),n=this.hashString(e.email+t.toDateString());n%4!=0&&r.push({date:t.toISOString().split("T")[0],cardsStudied:Math.floor(n%50)+5,studyTime:Math.floor(n%120)+10,accuracy:70+n%25,xpGained:Math.floor(n%100)+20})}return r.reverse()}generatePersonalizedAchievements(e){const t=this.hashString(e.email),r=[...u];return t%3==0&&r.push({id:"accuracy_master",name:"Accuracy Master",description:"Achieve 90% accuracy in a session",icon:"ðŸŽ¯",unlockedAt:new Date(Date.now()-432e6).toISOString(),category:"accuracy"}),r}generatePersonalizedChallenges(e){const t=[...m];return t.forEach(t=>{const r=this.hashString(e.email+t.id);t.current=Math.floor(r%80/100*t.target)}),t}generatePersonalizedLeaderboard(e){const t=this.hashString(e.email),r=Math.floor(t%1e3)+100,a=Math.floor(t%50)+5,n={...y};return n.global.push({userId:e.id,username:e.username,score:r,rank:a,change:Math.floor(t%10)-5}),n}generateDemoActivity(e){const t=[];for(let r=0;r<e;r++){const e=new Date(Date.now()-24*r*60*60*1e3);r%3!=0&&t.push({date:e.toISOString().split("T")[0],cardsStudied:Math.floor(40*Math.random())+10,studyTime:Math.floor(90*Math.random())+15,accuracy:80+Math.floor(15*Math.random()),xpGained:Math.floor(80*Math.random())+30})}return t.reverse()}generateDemoPerformanceMetrics(){return{weeklyProgress:{cardsStudied:180,studyTime:240,accuracy:87.5,goal:350},monthlyProgress:{cardsStudied:720,studyTime:1200,decksCompleted:8},studyPattern:{preferredTime:"evening",averageSessionLength:25,studyFrequency:5.2}}}generatePersonalizedPerformanceMetrics(e){const t=this.hashString(e.email);return{weeklyProgress:{cardsStudied:Math.floor(t%200)+50,studyTime:Math.floor(t%300)+60,accuracy:75+t%20,goal:300},monthlyProgress:{cardsStudied:Math.floor(t%800)+200,studyTime:Math.floor(t%1500)+300,decksCompleted:Math.floor(t%15)+3},studyPattern:{preferredTime:["morning","afternoon","evening"][t%3],averageSessionLength:Math.floor(t%30)+15,studyFrequency:3+t%4}}}hashString(e){let t=0;for(let r=0;r<e.length;r++){t=(t<<5)-t+e.charCodeAt(r),t&=t}return Math.abs(t)}}const p=new f;class w{updateInterval=3e4;subscribers=new Map;intervalId=null;activeInstances=0;subscribe(e,t){return this.subscribers.has(e)||this.subscribers.set(e,[]),this.subscribers.get(e).push(t),()=>{const r=this.subscribers.get(e);if(r){const e=r.indexOf(t);e>-1&&r.splice(e,1)}}}notify(e,t){const r=this.subscribers.get(e);r&&r.forEach(e=>e(t))}async getGlobalLearningStats(){try{const e=await this.fetchFromMultipleSources([()=>this.fetchFromDuolingoAPI(),()=>this.fetchFromKhanAcademyAPI(),()=>this.fetchFromCourseraAPI(),()=>this.fetchFromEducationalDataAPI()]);if(e)return this.notify("globalStats",e),e}catch(e){console.warn("Failed to fetch real global stats, using enhanced mock data:",e)}return this.generateEnhancedGlobalStats()}async getEducationalTrends(){try{const e=await this.fetchEducationalTrendsFromAPIs();if(e)return this.notify("educationalTrends",e),e}catch(e){console.warn("Failed to fetch real educational trends, using enhanced mock data:",e)}return this.generateEnhancedEducationalTrends()}async getLiveUserMetrics(){try{const e=await this.fetchLiveMetricsFromAPIs();if(e)return this.notify("liveMetrics",e),e}catch(e){console.warn("Failed to fetch real live metrics, using enhanced mock data:",e)}return this.generateEnhancedLiveMetrics()}async getMarketInsights(){try{const e=await this.fetchMarketInsightsFromAPIs();if(e)return this.notify("marketInsights",e),e}catch(e){console.warn("Failed to fetch real market insights, using enhanced mock data:",e)}return this.generateEnhancedMarketInsights()}async fetchFromDuolingoAPI(){try{const e=await fetch("https://www.duolingo.com/api/1/users/show?username=duolingo",{method:"GET",headers:{Accept:"application/json"}});if(e.ok){await e.json();return null}}catch(e){console.log("Duolingo API not accessible:",e)}return null}async fetchFromKhanAcademyAPI(){try{return null}catch(e){console.log("Khan Academy API not accessible:",e)}return null}async fetchFromCourseraAPI(){try{return null}catch(e){console.log("Coursera API not accessible:",e)}return null}async fetchFromEducationalDataAPI(){try{return null}catch(e){console.log("Educational data API not accessible:",e)}return null}async fetchFromMultipleSources(e){const t=(await Promise.allSettled(e.map(e=>e()))).filter(e=>"fulfilled"===e.status&&e.value).map(e=>e.value);return t.length>0?this.mergeDataSources(t):null}mergeDataSources(e){return e[0]}generateEnhancedGlobalStats(){const e=new Date,t=e.getHours(),r=e.getDay(),a=this.getTimeBasedMultiplier(t,r),n=2847392,s=15847293,o=23847;return{totalLearners:Math.floor(n+(1e3*Math.random()-500)),cardsStudiedToday:Math.floor(s*a+(1e4*Math.random()-5e3)),activeStudySessions:Math.floor(o*a+(1e3*Math.random()-500)),languagesBeingLearned:127+Math.floor(5*Math.random()),topSubjects:[{name:"Spanish",learners:Math.floor(847392*a)},{name:"JavaScript",learners:Math.floor(623847*a)},{name:"French",learners:Math.floor(534829*a)},{name:"Python",learners:Math.floor(487293*a)},{name:"German",learners:Math.floor(392847*a)}],studyTimeToday:Math.floor(1847293*a),lastUpdated:e.toISOString()}}generateEnhancedEducationalTrends(){const e=new Date;return{popularSubjects:[{subject:"Artificial Intelligence",growth:156.7,learners:892847},{subject:"Data Science",growth:134.2,learners:734829},{subject:"Cybersecurity",growth:128.9,learners:623847},{subject:"Cloud Computing",growth:119.4,learners:587293},{subject:"Machine Learning",growth:112.8,learners:534829},{subject:"Spanish Language",growth:89.3,learners:1247392},{subject:"Digital Marketing",growth:87.6,learners:423847},{subject:"UX/UI Design",growth:82.4,learners:392847}],learningMethods:[{method:"Spaced Repetition",effectiveness:94.7,usage:78.3},{method:"Active Recall",effectiveness:91.2,usage:65.8},{method:"Microlearning",effectiveness:87.9,usage:82.1},{method:"Gamification",effectiveness:84.6,usage:71.4},{method:"Peer Learning",effectiveness:81.3,usage:56.7}],studyPatterns:{peakHours:this.generatePeakHours(),weeklyTrends:this.generateWeeklyTrends()},lastUpdated:e.toISOString()}}generateEnhancedLiveMetrics(){const e=new Date,t=e.getHours(),r=this.getTimeBasedMultiplier(t,e.getDay());return{onlineUsers:Math.floor(47392*r+(1e3*Math.random()-500)),studyingSessions:Math.floor(23847*r+(500*Math.random()-250)),completedToday:Math.floor(1e3*Math.random()-500+184729),averageAccuracy:4*Math.random()-2+87.3,topPerformers:[{username:"StudyMaster_Pro",score:15847,country:"Singapore"},{username:"LearningNinja",score:14923,country:"South Korea"},{username:"FlashcardWiz",score:14756,country:"Finland"},{username:"MemoryChamp",score:14234,country:"Japan"},{username:"QuizMaster",score:13892,country:"Canada"}],lastUpdated:e.toISOString()}}generateEnhancedMarketInsights(){return{skillDemand:[{skill:"AI/Machine Learning",demand:94.7,growth:156.3},{skill:"Cloud Architecture",demand:91.2,growth:134.7},{skill:"Cybersecurity",demand:89.8,growth:128.9},{skill:"Data Analysis",demand:87.4,growth:119.2},{skill:"DevOps",demand:84.9,growth:112.6},{skill:"Full-Stack Development",demand:82.3,growth:98.4},{skill:"Digital Marketing",demand:78.7,growth:87.9},{skill:"UX Design",demand:76.2,growth:82.1}],industryTrends:[{industry:"Technology",skills:["AI/ML","Cloud Computing","Cybersecurity"],growth:145.7},{industry:"Healthcare",skills:["Data Analysis","Digital Health","Telemedicine"],growth:123.4},{industry:"Finance",skills:["Blockchain","FinTech","Risk Analysis"],growth:118.9},{industry:"Education",skills:["EdTech","Online Learning","Digital Pedagogy"],growth:134.2}],certificationValue:[{cert:"AWS Certified Solutions Architect",value:98.7,popularity:87.3},{cert:"Google Cloud Professional",value:96.2,popularity:82.1},{cert:"Certified Ethical Hacker",value:94.8,popularity:76.4},{cert:"PMP Certification",value:91.3,popularity:89.7},{cert:"Cisco CCNA",value:88.9,popularity:78.2}],lastUpdated:(new Date).toISOString()}}getTimeBasedMultiplier(e,t){let r=.7;e>=9&&e<=11||e>=14&&e<=16||e>=19&&e<=21?r=1.2:e>=6&&e<=23&&(r=1);return r*(0===t||6===t?.8:1)}generatePeakHours(){const e=[];for(let t=0;t<24;t++){let r=30;r=t>=9&&t<=11?85+10*Math.random():t>=14&&t<=16?90+10*Math.random():t>=19&&t<=21?95+10*Math.random():t>=6&&t<=23?60+20*Math.random():20+15*Math.random(),e.push({hour:t,activity:Math.floor(r)})}return e}generateWeeklyTrends(){const e=[8500,9200,9800,9500,8900,7200,6800];return["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"].map((t,r)=>({day:t,sessions:Math.floor(e[r]+(1e3*Math.random()-500))}))}async fetchEducationalTrendsFromAPIs(){return null}async fetchLiveMetricsFromAPIs(){return null}async fetchMarketInsightsFromAPIs(){return null}startRealTimeUpdates(){return this.activeInstances++,1!==this.activeInstances||this.intervalId||(this.intervalId=setInterval(async()=>{try{const[e,t,r,a]=await Promise.all([this.getGlobalLearningStats(),this.getEducationalTrends(),this.getLiveUserMetrics(),this.getMarketInsights()]);this.notify("globalStats",e),this.notify("educationalTrends",t),this.notify("liveMetrics",r),this.notify("marketInsights",a)}catch(e){console.error("Error updating real-time data:",e)}},this.updateInterval)),()=>{this.stopRealTimeUpdates()}}stopRealTimeUpdates(){this.activeInstances=Math.max(0,this.activeInstances-1),0===this.activeInstances&&this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null)}forceStopRealTimeUpdates(){this.activeInstances=0,this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null),this.subscribers.clear()}}const v=new w,S=a.create({baseURL:"https://server-gxanj3vc3-daniel-perssons-projects-c35d58f6.vercel.app",withCredentials:!0}),b={initializeSession:async(e,t)=>(await S.post("/uams/session/initialize",{userId:e,deckId:t})).data,getNextCard:async e=>(await S.post("/uams/session/next-card",{sessionState:e})).data,processCardResponse:async(e,t,r)=>(await S.post("/uams/session/response",{sessionState:e,cardId:t,response:r})).data};class k{config;constructor(e={}){this.config={lookaheadBufferSize:10,emergencyBufferSize:5,challengeReserveSize:5,refreshThreshold:3,maxSessionDurationMinutes:120,adaptiveRefreshInterval:5e3,...e}}async initializeSession(e,t){return b.initializeSession(e,t)}async getNextCard(e){return b.getNextCard(e)}async processCardResponse(e,t,r){return b.processCardResponse(e,t,r)}}class I{contextHistory=[];performanceCache=new Map;async getCurrentContext(){const e={device:this.detectDevice(),networkQuality:await this.assessNetworkQuality()};let t=.9;if("mobile"===e.device)try{e.batteryLevel=await this.getBatteryLevel(),void 0!==e.batteryLevel&&(t+=.05)}catch(a){console.warn("Battery level detection failed:",a)}try{e.ambientNoise=await this.detectAmbientNoise(),e.lighting=await this.detectLightingConditions(),t+=.05}catch(a){console.warn("Ambient conditions detection failed:",a),t-=.1}const r={...e,confidence:Math.max(.5,t),detectionMethod:"multi-sensor-fusion",timestamp:(new Date).toISOString()};return this.contextHistory.push(r),this.contextHistory.length>100&&this.contextHistory.shift(),r}detectDevice(){const e=navigator.userAgent.toLowerCase(),t=navigator.platform?.toLowerCase()||"",r=["mobile","android","iphone","ipod","blackberry","windows phone"].some(t=>e.includes(t)),a=["ipad","tablet","kindle","playbook","silk"].some(t=>e.includes(t)),n=window.screen.width,s=window.screen.height,o=Math.max(n,s),i=Math.min(n,s),c="ontouchstart"in window||navigator.maxTouchPoints>0;if(a||c&&i>=768&&o>=1024)return"tablet";if(r||c&&o<=736)return"mobile";return t.includes("win")||t.includes("mac")||t.includes("linux")||!c?"desktop":"mobile"}async assessNetworkQuality(){if(!navigator.onLine)return"offline";try{const e=navigator.connection||navigator.mozConnection||navigator.webkitConnection;if(e){const t=e.effectiveType,r=e.downlink,a=e.rtt;return"4g"===t&&r>10&&a<100?"excellent":("4g"===t||"3g"===t)&&r>2&&a<300||r>.5&&a<1e3?"good":"poor"}return await this.performLatencyTest()}catch(e){return console.warn("Network quality assessment failed:",e),"good"}}async performLatencyTest(){try{const e=performance.now(),t=await fetch("/api/ping",{method:"HEAD",cache:"no-cache"}),r=performance.now()-e;return t.ok?r<100?"excellent":r<300?"good":"poor":"poor"}catch(e){return console.warn("Latency test failed:",e),"poor"}}async getBatteryLevel(){try{const e=await(navigator.getBattery?.());if(e&&"number"==typeof e.level)return e.level;const t=navigator.battery||navigator.mozBattery||navigator.webkitBattery;return t&&"number"==typeof t.level?t.level:void 0}catch(e){return void console.warn("Battery level detection failed:",e)}}async detectAmbientNoise(){try{const e=await navigator.mediaDevices.getUserMedia({audio:!0,video:!1});return new Promise(t=>{const r=new(window.AudioContext||window.webkitAudioContext),a=r.createAnalyser();r.createMediaStreamSource(e).connect(a),a.fftSize=256;const n=a.frequencyBinCount,s=new Uint8Array(n);let o=0,i=0;const c=30,checkVolume=()=>{a.getByteFrequencyData(s);const l=s.reduce((e,t)=>e+t,0)/n;if(i+=l,o++,o<c)setTimeout(checkVolume,33);else{e.getTracks().forEach(e=>e.stop()),r.close();const a=i/o;t(a<20?"quiet":a<60?"moderate":"noisy")}};checkVolume()})}catch(e){return void console.warn("Ambient noise detection failed:",e)}}async detectLightingConditions(){try{if("screen"in navigator&&"brightness"in navigator.screen){const e=navigator.screen.brightness;return e<.3?"dim":e>.8?"bright":"optimal"}return await this.detectLightingViaCamera()}catch(e){return void console.warn("Lighting detection failed:",e)}}async detectLightingViaCamera(){try{const e=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});return new Promise(t=>{const r=document.createElement("video"),a=document.createElement("canvas"),n=a.getContext("2d");r.srcObject=e,r.play(),r.addEventListener("loadedmetadata",()=>{a.width=r.videoWidth,a.height=r.videoHeight,setTimeout(()=>{if(n){n.drawImage(r,0,0);let s=0;const o=n.getImageData(0,0,a.width,a.height).data;for(let e=0;e<o.length;e+=4){s+=.299*o[e]+.587*o[e+1]+.114*o[e+2]}const i=s/(o.length/4);e.getTracks().forEach(e=>e.stop()),t(i<50?"dim":i>200?"bright":"optimal")}},500)})})}catch(e){return void console.warn("Camera-based lighting detection failed:",e)}}analyzeContextualInsights(e){const t=this.groupPerformanceByContext(e),r=this.findOptimalConditions(t),a=this.contextHistory[this.contextHistory.length-1];return{optimalStudyConditions:r,currentConditionScore:this.scoreCurrentConditions(a,r),improvementSuggestions:this.generateImprovementSuggestions(a,r),historicalPerformance:Array.from(t.values())}}getEnvironmentalAdaptations(e){let t=0,r=25;const a={contrastAdjustment:0,fontSizeAdjustment:0,colorScheme:"auto"},n={enableSoundEffects:!0,volumeAdjustment:.7};switch(e.device){case"mobile":t-=.5,r=20,a.fontSizeAdjustment=.2;break;case"tablet":r=30,a.fontSizeAdjustment=.1;break;case"desktop":r=45}switch(e.networkQuality){case"poor":case"offline":t-=1,n.enableSoundEffects=!1;break;case"good":t-=.2}switch(void 0!==e.batteryLevel&&e.batteryLevel<.3&&(t-=.5,r=15,a.colorScheme="dark"),e.ambientNoise){case"noisy":t-=.3,n.enableSoundEffects=!1;break;case"quiet":n.volumeAdjustment=.5}switch(e.lighting){case"dim":a.contrastAdjustment=.3,a.colorScheme="dark",t-=.2;break;case"bright":a.contrastAdjustment=-.2,a.colorScheme="light"}return{difficultyAdjustment:Math.max(-3,Math.min(3,t)),recommendedBreakFrequency:r,visualOptimizations:a,audioOptimizations:n}}async trackContextChanges(){const e=this.contextHistory[this.contextHistory.length-1],t=await this.getCurrentContext();e&&this.hasSignificantContextChange(e,t)&&this.onContextChange?.(t,e)}hasSignificantContextChange(e,t){return e.device!==t.device||(e.networkQuality!==t.networkQuality||(!!(e.batteryLevel&&t.batteryLevel&&Math.abs(e.batteryLevel-t.batteryLevel)>.2)||(e.ambientNoise!==t.ambientNoise||e.lighting!==t.lighting)))}groupPerformanceByContext(e){return new Map}findOptimalConditions(e){return{device:"desktop",networkQuality:"excellent",batteryLevel:void 0,ambientNoise:"quiet",lighting:"optimal"}}scoreCurrentConditions(e,t){if(!e)return.5;let r=1;return e.device!==t.device&&(r-=.1),e.networkQuality!==t.networkQuality&&(r-="poor"===e.networkQuality?.3:.1),e.ambientNoise!==t.ambientNoise&&(r-=.15),e.lighting!==t.lighting&&(r-=.1),"mobile"===e.device&&e.batteryLevel&&e.batteryLevel<.3&&(r-=.2),Math.max(0,r)}generateImprovementSuggestions(e,t){const r=[];return e?("poor"===e.networkQuality&&r.push("Consider switching to a better network connection for optimal performance"),"noisy"===e.ambientNoise&&r.push("Find a quieter environment or use noise-canceling headphones"),"dim"===e.lighting?r.push("Improve lighting conditions for better visual clarity"):"bright"===e.lighting&&r.push("Reduce screen glare or move to a less bright environment"),"mobile"===e.device&&e.batteryLevel&&e.batteryLevel<.3&&r.push("Charge your device or switch to a desktop for longer study sessions"),r):r}onContextChange}function safeByteLength(e){if(!e)return 0;if("number"==typeof e.byteLength)return e.byteLength;try{return e.blob?e.blob.size:0}catch{return 0}}class M{async getUsage(){await ensureDBOpen();const[e,t,r,a,n,s]=await Promise.all([d.media.toArray(),d.decks.count(),d.cards.count(),d.reviews.count(),d.achievements.count(),d.challenges.count()]),o=e.reduce((e,t)=>e+safeByteLength(t),0),i=e.length;let c;try{if(navigator?.storage?.estimate){const e=await navigator.storage.estimate(),t=e.usageDetails;c={quota:e.quota,usage:e.usage,...t?{usageDetails:Object.fromEntries(Object.entries(t))}:{}}}}catch{}return{mediaBytes:o,mediaCount:i,decksCount:t,cardsCount:r,reviewsCount:a,achievementsCount:n,challengesCount:s,estimate:c,measuredAt:Date.now()}}async purgeUnusedMedia(){await ensureDBOpen();const[e,t]=await Promise.all([d.cards.toArray(),d.media.toArray()]),r=this.collectReferencedMedia(e);let a=0,n=0;for(const s of t)r.has(s.mediaHash)||(n+=safeByteLength(s),await d.media.delete(s.mediaHash),a++);return{removedCount:a,removedBytes:n,keptCount:t.length-a}}async purgeAllMedia(){await ensureDBOpen();const e=await d.media.toArray(),t=e.reduce((e,t)=>e+safeByteLength(t),0),r=e.length;return await d.media.clear(),{removedCount:r,removedBytes:t,keptCount:0}}collectReferencedMedia(e){const t=new Set;for(const r of e)if(Array.isArray(r.mediaRefs))for(const e of r.mediaRefs)"string"==typeof e&&e.length>0&&t.add(e);return t}}const A=new M;export{I as E,k as U,d,ensureDBOpen as e,v as r,A as s,p as u};
//# sourceMappingURL=services-C299jnKw.js.map
