import{j as e,N as s,r as t,O as a,b as r,L as l,R as n,Z as d,d as i,e as c,f as o,h as x,i as m,k as g,C as h,X as u,Y as b,T as y,l as p,m as j,P as f,n as v,o as N,A as k,p as w,S,q as C,B as A,s as M,t as D,v as L,w as T,x as E,y as I,z as R,D as P,E as F,F as $,Q as O,G as B}from"./react-vendor-D7Istm-s.js";import{a as U,b as K,u as z,c as H,d as G,e as W}from"./stores-sGyTT1ft.js";import{g as q,r as _,a as X}from"./anki-services-DlKSjqeH.js";import{f as V,g as Y,h as Q,j as J,U as Z,E as ee,s as se,k as te}from"./services-BlEXT7_S.js";import{X as ae,S as re,M as le,C as ne,u as de,R as ie,T as ce,a as oe}from"./heavy-components-B7HWpKsh.js";import"./data-vendor-x8Mxs_7j.js";import{ac as xe}from"./vendor-DojJshIj.js";import"./ui-vendor-C86Gg0gy.js";!function polyfill(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))processPreload(e);new MutationObserver(e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&processPreload(e)}).observe(document,{childList:!0,subtree:!0})}function getFetchOpts(e){const s={};return e.integrity&&(s.integrity=e.integrity),e.referrerPolicy&&(s.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?s.credentials="include":"anonymous"===e.crossOrigin?s.credentials="omit":s.credentials="same-origin",s}function processPreload(e){if(e.ep)return;e.ep=!0;const s=getFetchOpts(e);fetch(e.href,s)}}();const Navbar=({onMenuClick:s})=>{const{theme:t,toggleTheme:a}=U(),{user:r,logout:l}=K();return e.jsx("nav",{className:"bg-white dark:bg-gray-800 shadow-sm border-b border-gray-200 dark:border-gray-700",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex justify-between h-16",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("button",{onClick:s,className:"lg:hidden p-2 rounded-md text-gray-400 hover:text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-blue-500",children:e.jsx("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})}),e.jsx("div",{className:"flex-shrink-0 flex items-center ml-4 lg:ml-0",children:e.jsx("h1",{className:"text-xl font-bold text-gradient",children:"StudyMaster"})})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("button",{onClick:a,className:"p-2 rounded-md text-gray-400 hover:text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-blue-500",children:"dark"===t?e.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"})}):e.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"})})}),e.jsx("div",{className:"relative",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-medium text-gray-700 dark:text-gray-200",children:r?.username}),e.jsxs("div",{className:"text-gray-500 dark:text-gray-400",children:["Level ",r?.level]})]}),e.jsx("button",{onClick:l,className:"p-2 rounded-md text-gray-400 hover:text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-blue-500",title:"Logout",children:e.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})})})]})})]})]})})})},Sidebar=({isOpen:t,onClose:a})=>{const{userStats:r}=z(),l=[{name:"Home",href:"/",icon:"ðŸ "},{name:"Study",href:"/study",icon:"ðŸ“š"},{name:"Decks",href:"/decks",icon:"ðŸ“‹"},{name:"Global Stats",href:"/stats",icon:"ðŸŒ"},{name:"Profile",href:"/profile",icon:"ðŸ‘¤"},{name:"Leaderboard",href:"/leaderboard",icon:"ðŸ†"},{name:"Challenges",href:"/challenges",icon:"ðŸŽ¯"},{name:"Storage",href:"/storage",icon:"ðŸ’¾"}],formatNumber=e=>e>=1e6?`${(e/1e6).toFixed(1)}M`:e>=1e3?`${(e/1e3).toFixed(1)}K`:e.toString(),n=1e3*r.level,d=1e3*(r.level+1),i=(r.xp-n)/(d-n)*100;return e.jsxs("div",{className:`fixed inset-y-0 left-0 z-50 w-64 bg-white dark:bg-gray-800 shadow-lg transform ${t?"translate-x-0":"-translate-x-full"} transition-transform duration-300 ease-in-out lg:translate-x-0`,children:[e.jsxs("div",{className:"flex items-center justify-between h-16 px-4 border-b border-gray-200 dark:border-gray-700",children:[e.jsx("h1",{className:"text-xl font-bold text-gradient",children:"StudyMaster"}),e.jsx("button",{onClick:a,className:"lg:hidden p-2 rounded-md text-gray-400 hover:text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-700",children:e.jsx("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsx("nav",{className:"flex-1 mt-8 overflow-y-auto",children:e.jsx("div",{className:"px-4 space-y-2",children:l.map(t=>e.jsxs(s,{to:t.href,onClick:a,className:({isActive:e})=>"flex items-center px-4 py-2 text-sm font-medium rounded-md transition-colors duration-200 "+(e?"bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-200":"text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 hover:text-gray-900 dark:hover:text-white"),children:[e.jsx("span",{className:"mr-3 text-lg",children:t.icon}),t.name]},t.name))})}),e.jsx("div",{className:"flex-shrink-0 p-4 border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-750",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"XP"}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:formatNumber(r.xp)})]}),e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Streak"}),e.jsxs("span",{className:"font-medium text-gray-900 dark:text-white",children:[r.currentStreak," ",1===r.currentStreak?"day":"days"]})]}),e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-600 rounded-full h-2",children:e.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-purple-600 h-2 rounded-full transition-all duration-300",style:{width:`${Math.min(100,Math.max(0,i))}%`}})}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 text-center",children:["Level ",r.level," â†’ Level ",r.level+1]}),e.jsxs("div",{className:"text-xs text-gray-400 dark:text-gray-500 text-center",children:[formatNumber(r.xp-n)," / ",formatNumber(d-n)," XP"]})]})})]})]})},me={};function readBool(e,s){try{const t=localStorage.getItem(e);return null===t?s:"true"===t}catch{return s}}function writeBool(e,s){try{localStorage.setItem(e,s?"true":"false")}catch{}}function isOnlineLeaderboardEnabled(){return readBool("sm.onlineLeaderboardEnabled",!1)}function setOnlineLeaderboardEnabled(e){writeBool("sm.onlineLeaderboardEnabled",e),window.__LEADERBOARD_ONLINE_ENABLED=e}function isRemoteAuthEnabled(){return!("true"!==String(me?.VITE_REMOTE_AUTH_ENABLED??"false"))&&readBool("sm.remoteAuthEnabled",!1)}!function bootstrapGlobals(){window.__LEADERBOARD_ONLINE_ENABLED=isOnlineLeaderboardEnabled(),window.__REMOTE_AUTH_ENABLED=isRemoteAuthEnabled()}();const AuthModal=({isOpen:s,onClose:a,mode:r,onModeChange:l})=>{const[n,d]=t.useState(""),[i,c]=t.useState(""),[o,x]=t.useState(""),{login:m,register:g,isLoading:h,error:u,clearError:b,isAuthenticated:y}=K(),[p,j]=t.useState(!1),f=isRemoteAuthEnabled();t.useEffect(()=>{s&&b()},[s,b]),t.useEffect(()=>{b()},[r,b]);const handleModeChange=e=>{b(),j(!1),l(e)},handleSubmit=async e=>{e.preventDefault(),"login"===r?await m(n,o):"register"===r?await g(n,i,o):"forgot-password"===r&&(alert("Password reset functionality will be implemented soon. Please use demo login or register a new account."),j(!0))};t.useEffect(()=>{console.log("[AUTH_MODAL]","Auth state changed:",{isAuthenticated:y,isOpen:s,timestamp:(new Date).toISOString()}),y&&s&&(console.log("[AUTH_MODAL]","Closing modal due to successful authentication"),a(),d(""),c(""),x(""))},[y,s,a]);const handleDemoLogin=async()=>{try{await m("demo",""),a()}catch(e){}};return s?e.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:e.jsxs("div",{className:"flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0",children:[e.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:a}),e.jsx("div",{className:"inline-block align-bottom bg-white dark:bg-gray-800 rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full",children:e.jsx("div",{className:"bg-white dark:bg-gray-800 px-4 pt-5 pb-4 sm:p-6 sm:pb-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-lg leading-6 font-medium text-gray-900 dark:text-white mb-4",children:"login"===r?"Sign In":"register"===r?"Create Account":"Reset Password"}),u&&e.jsx("div",{className:"mb-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded",children:u}),p&&"forgot-password"===r&&e.jsx("div",{className:"mb-4 p-3 bg-green-100 border border-green-400 text-green-700 rounded",children:"Password reset email sent! Check your inbox and follow the instructions to reset your password."}),!f&&e.jsx("div",{className:"mb-2 text-xs text-gray-500 dark:text-gray-400",children:"Local account: no server signup required. You can link an online account later in Profile â†’ Account & Online Services."}),e.jsxs("form",{onSubmit:handleSubmit,className:"space-y-4",children:[e.jsx("div",{children:e.jsx("input",{type:"email",placeholder:"Email",value:n,onChange:e=>d(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white",required:!0})}),"register"===r&&e.jsx("div",{children:e.jsx("input",{type:"text",placeholder:"Username",value:i,onChange:e=>c(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white",required:!0})}),"forgot-password"!==r&&f&&e.jsx("div",{children:e.jsx("input",{type:"password",placeholder:"Password",value:o,onChange:e=>x(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white",required:f})}),e.jsx("button",{type:"submit",disabled:h,className:"w-full btn btn-primary",children:h?"Loading...":"login"===r?f?"Sign In":"Sign In (Local)":"register"===r?f?"Create Account":"Create Local Profile":"Send Reset Email"})]}),e.jsx("div",{className:"mt-4",children:e.jsx("button",{onClick:handleDemoLogin,className:"w-full btn btn-secondary",disabled:h,children:"Demo Login"})}),e.jsx("div",{className:"mt-4 text-sm space-y-2",children:"login"===r?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["Don't have an account?"," ",e.jsx("button",{onClick:()=>handleModeChange("register"),className:"text-blue-600 hover:text-blue-500",children:f?"Create one":"Create local profile"})]}),f&&e.jsxs("div",{children:["Forgot your password?"," ",e.jsx("button",{onClick:()=>handleModeChange("forgot-password"),className:"text-blue-600 hover:text-blue-500",children:"Reset it"})]})]}):"register"===r?e.jsxs("div",{children:["Already have an account?"," ",e.jsx("button",{onClick:()=>handleModeChange("login"),className:"text-blue-600 hover:text-blue-500",children:f?"Sign in":"Sign in (Local)"})]}):e.jsxs("div",{children:[f?"Remember your password? ":"Password reset is unavailable in local mode. ",e.jsx("button",{onClick:()=>handleModeChange("login"),className:"text-blue-600 hover:text-blue-500",children:"Back to login"})]})})]})})})]})}):null},ge=t.memo(()=>{const[s,r]=t.useState(!1),[l,n]=t.useState(!1),[d,i]=t.useState("login"),{isAuthenticated:c,user:o}=K(),x=t.useCallback(()=>{r(!0)},[]),m=t.useCallback(()=>{r(!1)},[]),g=t.useCallback(()=>{i("login"),n(!0)},[]),h=t.useCallback(()=>{i("register"),n(!0)},[]),u=t.useCallback(()=>{n(!1)},[]),b=t.useCallback(e=>{i(e)},[]);return c?e.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:[s&&e.jsx("div",{className:"fixed inset-0 z-40 bg-black bg-opacity-50 lg:hidden",onClick:m}),e.jsx(Sidebar,{isOpen:s,onClose:m}),e.jsxs("div",{className:"lg:pl-64",children:[e.jsx(Navbar,{onMenuClick:x}),e.jsx("main",{className:"py-6",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsx(a,{})})})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-900",children:e.jsx("div",{className:"max-w-md w-full space-y-8 p-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-4xl font-bold text-gradient mb-4",children:"StudyMaster"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-8",children:"Master your learning with spaced repetition and gamification"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("button",{onClick:g,className:"btn btn-primary btn-lg w-full",children:"Sign In"}),e.jsx("button",{onClick:h,className:"btn btn-secondary btn-lg w-full",children:"Create Account"})]})]})})}),e.jsx(AuthModal,{isOpen:l,onClose:u,mode:d,onModeChange:b})]})});ge.displayName="Layout";const HomePage=()=>{const s=r(),{decks:t,getCards:a}=H(),{userStats:n,userAchievements:d,achievements:i}=z(),{user:c}=K(),getRecentAchievements=()=>d.map(e=>{const s=i.find(s=>s.id===e.achievementId);return s?{...s,earnedAt:e.earnedAt}:null}).filter(Boolean).sort((e,s)=>new Date(s.earnedAt).getTime()-new Date(e.earnedAt).getTime()).slice(0,3),formatNumber=e=>e>=1e6?`${(e/1e6).toFixed(1)}M`:e>=1e3?`${(e/1e3).toFixed(1)}K`:e.toString(),o=(()=>{const e=20;return t.map(s=>{const t=a(s.id).filter(e=>0===e.reviewCount||new Date(e.nextReview)<=new Date).length,r=Math.min(t,e);return{...s,dueCount:r,dueCountRaw:t}}).filter(e=>e.dueCount>0)})(),x=getRecentAchievements();return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-4xl font-bold text-gradient mb-4",children:"Welcome to StudyMaster"}),e.jsx("p",{className:"text-xl text-gray-600 dark:text-gray-400 mb-4",children:"Master your learning with spaced repetition and gamification"}),e.jsxs("div",{className:"flex items-center justify-center gap-2 text-sm text-gray-500 dark:text-gray-400",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),e.jsx("span",{children:"Live data â€¢ Real-time insights"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"card p-6 text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-primary-600 mb-2",children:formatNumber(n.xp)}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Total XP"})]}),e.jsxs("div",{className:"card p-6 text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-success-600 mb-2",children:n.currentStreak}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Day Streak"})]}),e.jsxs("div",{className:"card p-6 text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-warning-600 mb-2",children:n.gold}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Coins"})]}),e.jsxs("div",{className:"card p-6 text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-purple-600 mb-2",children:n.level}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Level"})]})]}),e.jsxs("div",{className:"card p-6",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"ðŸ“š Study Today"}),o.length>0?e.jsxs("div",{className:"space-y-4",children:[o.slice(0,3).map(t=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:t.title}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[t.dueCount," cards due"]})]}),e.jsx("button",{onClick:()=>s(`/study/${t.id}`),className:"btn btn-primary btn-sm",children:"Study Now"})]},t.id)),o.length>3&&e.jsx("div",{className:"text-center",children:e.jsxs("button",{onClick:()=>s("/decks"),className:"btn btn-secondary btn-sm",children:["View All Decks (",o.length-3," more)"]})})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸŽ‰"}),e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"All caught up!"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"No cards are due for review right now. Great job!"}),e.jsx("button",{onClick:()=>s("/decks"),className:"btn btn-primary",children:"Browse Your Decks"})]})]}),x.length>0&&e.jsxs("div",{className:"card p-6",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"ðŸ† Recent Achievements"}),e.jsx("div",{className:"space-y-3",children:x.map(s=>e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-success-100 dark:bg-success-900 rounded-full flex items-center justify-center",children:s.icon}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:s.name}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:s.description})]})]},s.id))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs(l,{to:"/decks",className:"card p-6 text-center hover:shadow-lg transition-shadow",children:[e.jsx("div",{className:"text-4xl mb-2",children:"ðŸ“š"}),e.jsx("h3",{className:"font-semibold",children:"My Decks"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Manage your study materials"})]}),e.jsxs(l,{to:"/global-stats",className:"card p-6 text-center hover:shadow-lg transition-shadow bg-gradient-to-br from-blue-50 to-purple-50 dark:from-blue-900/20 dark:to-purple-900/20 border-blue-200 dark:border-blue-800",children:[e.jsx("div",{className:"text-4xl mb-2",children:"ðŸŒ"}),e.jsx("h3",{className:"font-semibold",children:"Global Stats"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Real-time learning insights"})]}),e.jsxs(l,{to:"/challenges",className:"card p-6 text-center hover:shadow-lg transition-shadow",children:[e.jsx("div",{className:"text-4xl mb-2",children:"ðŸŽ¯"}),e.jsx("h3",{className:"font-semibold",children:"Challenges"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Join learning challenges"})]}),e.jsxs(l,{to:"/leaderboard",className:"card p-6 text-center hover:shadow-lg transition-shadow",children:[e.jsx("div",{className:"text-4xl mb-2",children:"ðŸ†"}),e.jsx("h3",{className:"font-semibold",children:"Leaderboard"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"See how you rank"})]})]}),e.jsxs("div",{className:"card p-6 bg-gradient-to-r from-blue-50 to-purple-50 dark:from-blue-900/20 dark:to-purple-900/20 border border-blue-200 dark:border-blue-800",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3 text-blue-800 dark:text-blue-200 flex items-center gap-2",children:"ðŸ’¡ Learning Insights"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:"87%"}),e.jsx("div",{className:"text-blue-700 dark:text-blue-300",children:"Spaced repetition effectiveness"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:"25min"}),e.jsx("div",{className:"text-green-700 dark:text-green-300",children:"Optimal study session"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600 dark:text-purple-400",children:"7-9PM"}),e.jsx("div",{className:"text-purple-700 dark:text-purple-300",children:"Peak learning hours"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600 dark:text-orange-400",children:"3x"}),e.jsx("div",{className:"text-orange-700 dark:text-orange-300",children:"Retention improvement"})]})]})]})]})},he={europe:["AD","LI","LU","MT","MC","SM","VA","CY","ME","MK","XK","SI","MD"],world:["AD","LI","LU","MT","MC","SM","VA","SG","BH","BN","QA","KW","BB","GD","LC","VC","AG","KN","DM","MV","NR","TV","PW","MH","FM","KI","TO","WS","VU","FJ"],africa:["DJ","GM","GW","GQ","CV","KM","MU","SC","ST"],"north-america":["BB","GD","LC","VC","AG","KN","DM","TT","JM"],us:["DE","RI","CT","NJ","NH","VT","MA","MD","HI"]},SvgMapCard=({options:s,showAnswer:a=!1,onAnswer:r,isStudyMode:l=!1})=>{const[o,x]=t.useState(""),[m,g]=t.useState(""),[h,u]=t.useState(!1),[b,y]=t.useState(1),[p,j]=t.useState(0),[f,v]=t.useState(0),[N,k]=t.useState(!1),[w,S]=t.useState({x:0,y:0}),[C,A]=t.useState(!1),M=t.useRef(null),D=t.useCallback(async()=>{try{const e=await fetch(s.svgPath),t=await e.text();x(t)}catch(e){console.error("Failed to load SVG:",e)}},[s.svgPath]);t.useEffect(()=>{D()},[D]),t.useEffect(()=>{g(""),u(!1),A(!1),j(0),v(0)},[s.countryId,s.countryName]);const L=t.useCallback((e,s)=>{try{const t=M.current?.getBoundingClientRect();if(!t)return 1;const a=e.getAttribute("viewBox");let r=1e3,l=600;if(a){const[,,e,s]=a.split(" ").map(Number);r=e,l=s}const n=t.width,d=t.height,i=n/r,c=d/l,o=.98*Math.min(i,c);if(!s){const e=Math.max(o,4);return Math.max(4,Math.min(e,6))}const x=s.getBBox();if(!x||0===x.width||0===x.height)return console.warn("Invalid bounding box for country element"),Math.max(.5,Math.min(o,3));const m=25,g=m/o,h=m/o,u=x.width<g?g/x.width:1,b=x.height<h?h/x.height:1;let y=Math.max(u,b);(x.width<10||x.height<10)&&(y=Math.max(y,12)),(x.width<3||x.height<3)&&(y=Math.max(y,25)),(x.width<1||x.height<1)&&(y=Math.max(y,40));const p=o*y,j=Math.max(4,o),f=Math.max(j,Math.min(p,50));return console.log("Zoom calculation details:",{containerSize:`${n}x${d}`,svgSize:`${r}x${l}`,baseZoom:o.toFixed(3),countryBBox:`${x.width.toFixed(1)}x${x.height.toFixed(1)} at (${x.x.toFixed(1)},${x.y.toFixed(1)})`,countryZoom:y.toFixed(3),finalZoom:f.toFixed(3)}),f}catch(t){console.warn("Error calculating initial zoom:",t);const e=M.current?.getBoundingClientRect();if(e){const s=.98*Math.min(e.width/1e3,e.height/600);return Math.max(4,Math.min(s,6))}return 4}},[]),T=t.useCallback(()=>{y(e=>Math.min(1.5*e,50))},[]),E=t.useCallback(()=>{y(e=>Math.max(e/1.5,.5))},[]),I=t.useCallback(()=>{A(!1),j(0),v(0)},[]),R=t.useCallback(e=>{b>1&&(k(!0),S({x:e.clientX-p,y:e.clientY-f}))},[b,p,f]),P=t.useCallback(e=>{N&&b>1&&(j(e.clientX-w.x),v(e.clientY-w.y))},[N,w,b]),F=t.useCallback(()=>{k(!1)},[]),$=t.useCallback(e=>{e.preventDefault();const s=e.deltaY>0?.9:1.1;y(e=>Math.max(.5,Math.min(50,e*s)))},[]),O=t.useCallback(e=>{if(1===e.touches.length&&b>1){const s=e.touches[0];k(!0),S({x:s.clientX-p,y:s.clientY-f})}},[b,p,f]),B=t.useCallback(e=>{if(N&&1===e.touches.length&&b>1){e.preventDefault();const s=e.touches[0];j(s.clientX-w.x),v(s.clientY-w.y)}},[N,w,b]),U=t.useCallback(()=>{k(!1)},[]),getMapType=e=>e.split("/").pop()?.replace(".svg","")||"",K=n.useMemo(()=>{if(!o)return"";const e=(new DOMParser).parseFromString(o,"image/svg+xml"),t=e.querySelector("svg");t&&(t.setAttribute("width","100%"),t.setAttribute("height","100%"),t.setAttribute("viewBox",t.getAttribute("viewBox")||"0 0 1000 600"),t.setAttribute("preserveAspectRatio","xMidYMid meet"),t.style.maxWidth="100%",t.style.maxHeight="100%");const a=getMapType(s.svgPath),r=e.querySelector(`[id="${s.countryId}"]`);(he[a]||[]).includes(s.countryId),r&&(r.setAttribute("fill","#ef4444"),r.setAttribute("stroke","#dc2626"),r.setAttribute("stroke-width","2"));return e.querySelectorAll("path[id], polygon[id], circle[id]").forEach(e=>{e.getAttribute("id")!==s.countryId&&(e.setAttribute("fill","#e5e7eb"),e.setAttribute("stroke","#9ca3af"),e.setAttribute("stroke-width","1"))}),(new XMLSerializer).serializeToString(e)},[o,s.countryId,s.svgPath]);t.useEffect(()=>{if(!K||C)return;const e=setTimeout(()=>{const e=M.current;if(!e)return;const t=e.querySelector("svg");if(!t)return;let a=t.querySelector(`[id="${s.countryId}"]`);a||(a=t.querySelector(`[id="${s.countryId.toLowerCase()}"]`)||t.querySelector(`[id="${s.countryId.toUpperCase()}"]`)||t.querySelector(`[class*="${s.countryId}"]`)||t.querySelector(`[data-id="${s.countryId}"]`)||t.querySelector(`[data-country="${s.countryId}"]`)||t.querySelector(`[name="${s.countryId}"]`));const r=L(t,a||void 0);y(r),A(!0),console.log("Setting initial zoom:",r,"for country:",s.countryId,"found element:",!!a)},100);return()=>clearTimeout(e)},[K,s.countryId,C,L]);const handleSubmitAnswer=()=>{const e=m.toLowerCase().trim()===s.countryName.toLowerCase().trim();u(!0),r&&r(e)},handleKeyPress=e=>{"Enter"===e.key&&m.trim()&&!h&&handleSubmitAnswer()};return o?e.jsxs("div",{className:"w-full mx-auto",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 mb-4 relative",children:[e.jsxs("div",{className:"absolute top-2 right-2 z-10 flex flex-col gap-1 bg-white dark:bg-gray-700 rounded-lg shadow-lg p-1",children:[e.jsx("button",{onClick:T,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-600 rounded transition-colors",title:"Zoom In",children:e.jsx(d,{size:16,className:"text-gray-700 dark:text-gray-300"})}),e.jsx("button",{onClick:E,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-600 rounded transition-colors",title:"Zoom Out",children:e.jsx(i,{size:16,className:"text-gray-700 dark:text-gray-300"})}),e.jsx("button",{onClick:I,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-600 rounded transition-colors",title:"Reset View",children:e.jsx(c,{size:16,className:"text-gray-700 dark:text-gray-300"})})]}),1!==b&&e.jsxs("div",{className:"absolute top-2 left-2 z-10 bg-black bg-opacity-75 text-white px-2 py-1 rounded text-sm",children:[Math.round(100*b),"%"]}),e.jsx("div",{ref:M,className:"w-full h-64 md:h-80 flex items-center justify-center overflow-hidden cursor-grab active:cursor-grabbing",style:{cursor:b>1?N?"grabbing":"grab":"default"},onMouseDown:R,onMouseMove:P,onMouseUp:F,onMouseLeave:F,onWheel:$,onTouchStart:O,onTouchMove:B,onTouchEnd:U,children:e.jsx("div",{className:"transition-transform duration-200 ease-out",style:{transform:`scale(${b}) translate(${p/b}px, ${f/b}px)`,transformOrigin:"center center"},dangerouslySetInnerHTML:{__html:K}})}),1===b&&e.jsx("div",{className:"absolute bottom-2 left-2 z-10 bg-black bg-opacity-75 text-white px-2 py-1 rounded text-xs",children:"Use controls or scroll to zoom â€¢ Drag to pan when zoomed"})]}),l&&!a&&e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 text-center",children:["What ",getMapType(s.svgPath).includes("us")?"state":getMapType(s.svgPath).includes("gb")||getMapType(s.svgPath).includes("fi")||getMapType(s.svgPath).includes("fr")||getMapType(s.svgPath).includes("no")||getMapType(s.svgPath).includes("se")||getMapType(s.svgPath).includes("vn")?"region":"country"," is highlighted in red?"]}),h?e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-semibold mb-2 "+(m.toLowerCase().trim()===s.countryName.toLowerCase().trim()?"text-green-600":"text-red-600"),children:m.toLowerCase().trim()===s.countryName.toLowerCase().trim()?"âœ“ Correct!":"âœ— Incorrect"}),e.jsxs("div",{className:"text-gray-700",children:["Your answer: ",e.jsx("span",{className:"font-medium",children:m})]}),e.jsxs("div",{className:"text-gray-700",children:["Correct answer: ",e.jsx("span",{className:"font-medium",children:s.countryName})]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("input",{type:"text",value:m,onChange:e=>g(e.target.value),onKeyPress:handleKeyPress,placeholder:"Enter country name...",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",autoFocus:!0}),e.jsx("button",{onClick:handleSubmitAnswer,disabled:!m.trim(),className:"w-full bg-blue-500 text-white py-2 px-4 rounded-lg hover:bg-blue-600 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors",children:"Submit Answer"})]})]}),a&&e.jsx("div",{className:"bg-white rounded-lg shadow-lg p-6 text-center",children:e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:s.countryName})})]}):e.jsx("div",{className:"flex items-center justify-center h-64 bg-gray-100 rounded-lg",children:e.jsx("div",{className:"text-gray-500",children:"Loading map..."})})},useAuth=()=>{const e=K(e=>e.user),s=K(e=>e.session),t=K(e=>e.isAuthenticated),a=K(e=>e.isLoading),r=K(e=>e.error),l=K(e=>e.login),n=K(e=>e.register),d=K(e=>e.logout),i=K(e=>e.updateUser),c=K(e=>e.clearError),o=K(e=>e.connectOnline),x=K(e=>e.disconnectOnline),m=K(e=>e.isOnlineLinked),g=K(e=>e.signIn),h=K(e=>e.signUp),u=K(e=>e.signOut),b=K(e=>e.resetPassword),y=K(e=>e.updatePassword),p=K(e=>e.updateProfile),j=K(e=>e.initializeAuth);return{user:e?s?{...e,token:s.token}:e:null,session:s,isAuthenticated:t,isLoading:a,error:r,login:l,register:n,logout:d,updateUser:i,clearError:c,connectOnline:o,disconnectOnline:x,isOnlineLinked:m,signIn:g,signUp:h,signOut:u,resetPassword:b,updatePassword:y,updateProfile:p,initializeAuth:j}},MediaHtmlRenderer=({html:s,deckId:a,className:r="",maxHeight:l})=>{const{user:n}=useAuth(),d=q(),[i,c]=t.useState(""),[o,x]=t.useState(!0),[m,g]=t.useState(null);return t.useEffect(()=>{(async()=>{if(!n?.id||!s)return console.log("[MediaHtmlRenderer] No user or html, using original content"),c(s),void x(!1);try{x(!0),g(null),console.log(`[MediaHtmlRenderer] Resolving media for deck ${a}, user ${n.id}`),console.log("[MediaHtmlRenderer] HTML snippet:",s.substring(0,200)),console.log("[MediaHtmlRenderer] Available mappings:",d.urlMappings.get(a)?.size||0);const e=await d.resolveMediaReferences(s,a,n.id);console.log("[MediaHtmlRenderer] Resolved HTML snippet:",e.substring(0,200)),c(e)}catch(e){console.error("[MediaHtmlRenderer] Failed to resolve media references:",e),c(s),g("Failed to load media")}finally{x(!1)}})()},[s,a,n?.id,d]),o?e.jsx("div",{className:`flex items-center justify-center p-4 ${r}`,children:e.jsx("div",{className:"text-gray-500",children:"Loading media..."})}):m?e.jsxs("div",{className:`p-4 bg-yellow-50 border border-yellow-200 rounded ${r}`,children:[e.jsx("div",{className:"text-yellow-800 text-sm",children:m}),e.jsx("div",{className:"mt-2 text-gray-900",dangerouslySetInnerHTML:{__html:i},style:l?{maxHeight:`${l}px`,overflow:"auto"}:void 0})]}):e.jsx("div",{className:r,dangerouslySetInnerHTML:{__html:i},style:l?{maxHeight:`${l}px`,overflow:"auto"}:void 0})},CardRenderer=({card:s,showAnswer:t,deckId:a,onAnswerSubmit:r})=>{if(!s)return null;if("svg_map"===s.cardType.type){const a=s.cardType.options;return e.jsx(SvgMapCard,{options:a,showAnswer:t,isStudyMode:!t,onAnswer:e=>{r&&r(e?"correct":"incorrect")}})}return e.jsx("div",{className:"text-center",children:e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-2",children:t?"Answer":"Question"}),e.jsx("div",{className:"text-2xl font-medium",children:e.jsx(MediaHtmlRenderer,{html:t?s.backContent:s.frontContent,deckId:a,className:"text-gray-900 dark:text-white"})})]})})},useKeyboardShortcuts=({shortcuts:e,enabled:s=!0,preventDefault:a=!0,stopPropagation:r=!0,debugMode:l=!1})=>{const n=t.useRef(e),d=t.useRef(s);t.useEffect(()=>{n.current=e,d.current=s},[e,s]);const i=t.useCallback(e=>{if(!d.current)return;const s=e.target;if("INPUT"===s.tagName||"TEXTAREA"===s.tagName||s.isContentEditable)return;const t=e.key.toLowerCase(),i=e.ctrlKey||e.metaKey,c=e.altKey,o=e.shiftKey;l&&console.log("[KeyboardShortcuts] Key pressed:",{key:t,ctrlKey:i,altKey:c,shiftKey:o,code:e.code});const x=n.current.find(e=>{if(e.disabled)return!1;const s=e.key.toLowerCase()===t,a=(e.ctrlKey||!1)===i,r=(e.altKey||!1)===c,l=(e.shiftKey||!1)===o;return s&&a&&r&&l});if(x){l&&console.log("[KeyboardShortcuts] Executing shortcut:",{key:x.key,description:x.description}),a&&e.preventDefault(),r&&e.stopPropagation();try{x.action()}catch(m){console.error("[KeyboardShortcuts] Error executing shortcut:",m)}}},[a,r,l]);return t.useEffect(()=>(s&&(document.addEventListener("keydown",i),l&&console.log("[KeyboardShortcuts] Registered shortcuts:",e.map(e=>({key:e.key,description:e.description,modifiers:{ctrl:e.ctrlKey,alt:e.altKey,shift:e.shiftKey}})))),()=>{document.removeEventListener("keydown",i),l&&console.log("[KeyboardShortcuts] Unregistered shortcuts")}),[i,s,l,e]),{shortcuts:n.current,enabled:d.current}},useStudyKeyboardShortcuts=({onFlipCard:e,onAnswerAgain:s,onAnswerHard:t,onAnswerGood:a,onAnswerEasy:r,onExitStudy:l,showAnswer:n,enabled:d=!0,debugMode:i=!1})=>useKeyboardShortcuts({shortcuts:[{key:" ",description:"Flip card / Show answer",action:e,disabled:n},{key:"enter",description:"Flip card / Show answer",action:e,disabled:n},{key:"1",description:"Answer: Again",action:s,disabled:!n},{key:"2",description:"Answer: Hard",action:t,disabled:!n},{key:"3",description:"Answer: Good",action:a,disabled:!n},{key:"4",description:"Answer: Easy",action:r,disabled:!n},{key:"a",description:"Answer: Again",action:s,disabled:!n},{key:"h",description:"Answer: Hard",action:t,disabled:!n},{key:"g",description:"Answer: Good",action:a,disabled:!n},{key:"e",description:"Answer: Easy",action:r,disabled:!n},{key:"escape",description:"Exit study session",action:l},{key:"q",description:"Exit study session",action:l}],enabled:d,debugMode:i}),KeyboardShortcutsHelp=({shortcuts:s,className:t="",title:a="Keyboard Shortcuts",compact:r=!1})=>{const formatKey=e=>{const s=[];e.ctrlKey&&s.push("Ctrl"),e.altKey&&s.push("Alt"),e.shiftKey&&s.push("Shift");let t=e.key;return" "===t&&(t="Space"),"enter"===t&&(t="Enter"),"escape"===t&&(t="Esc"),s.push(t.toUpperCase()),s.join(" + ")},l=s.filter(e=>!e.disabled);return 0===l.length?null:r?e.jsx("div",{className:`text-xs text-gray-500 dark:text-gray-400 ${t}`,children:l.slice(0,4).map((s,t)=>e.jsxs("span",{className:"mr-4",children:[e.jsx("kbd",{className:"px-1 py-0.5 bg-gray-200 dark:bg-gray-700 rounded text-xs",children:" "===s.key?"Space":s.key.toUpperCase()})," ",s.description]},t))}):e.jsxs("div",{className:`bg-gray-50 dark:bg-gray-800 rounded-lg p-4 ${t}`,children:[e.jsx("h3",{className:"font-semibold text-sm text-gray-700 dark:text-gray-300 mb-3",children:a}),e.jsx("div",{className:"space-y-2",children:l.map((s,t)=>e.jsxs("div",{className:"flex justify-between items-center text-xs",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:s.description}),e.jsx("kbd",{className:"px-2 py-1 bg-gray-200 dark:bg-gray-700 rounded text-gray-800 dark:text-gray-200 font-mono",children:formatKey(s)})]},t))})]})},StudyShortcutsHelp=({showAnswer:s,className:t="",compact:a=!1})=>{const r=[{key:"escape",description:"Exit study",action:()=>{},disabled:!1},{key:" ",description:"Show answer",action:()=>{},disabled:s},{key:"1",description:"Again",action:()=>{},disabled:!s},{key:"2",description:"Hard",action:()=>{},disabled:!s},{key:"3",description:"Good",action:()=>{},disabled:!s},{key:"4",description:"Easy",action:()=>{},disabled:!s}];return e.jsx(KeyboardShortcutsHelp,{shortcuts:r,className:t,title:"Study Shortcuts",compact:a})};function getCardStateDescription(e){switch(e.state){case"new":return"New - Never studied before";case"learning":return"Learning - Recently seen, still being learned";case"review":return`Review (${e.ivl<21?"Young":"Mature"}) - Finished learning, scheduled for review`;case"relearning":return"Relearning - Failed in review, being relearned";case"suspended":return"Suspended - Manually suspended from study";case"buried":return"Buried - Hidden until next day";default:return"Unknown state"}}function getCardStateColor(e){switch(e.state){case"new":return"#3b82f6";case"learning":return"#f59e0b";case"review":return e.ivl<21?"#10b981":"#059669";case"relearning":return"#ef4444";case"suspended":return"#6b7280";case"buried":return"#9ca3af";default:return"#374151"}}function getNextReviewDate(e){switch(e.state){case"new":case"suspended":case"buried":default:return null;case"learning":case"relearning":return new Date(Date.now()+60*e.left*1e3);case"review":return new Date(24*e.due*60*60*1e3)}}function getDaysOverdue(e,s=new Date){if("review"!==e.state)return 0;const t=Math.floor(s.getTime()/864e5);return Math.max(0,t-e.due)}const CardStateIndicator=({card:s,className:t="",showDescription:a=!1,compact:r=!1})=>{const l=getCardStateColor(s),n=getCardStateDescription(s),d=getNextReviewDate(s),i=getDaysOverdue(s),getStateIcon=()=>{switch(s.state){case"new":return"âœ¨";case"learning":return"ðŸ“š";case"review":return s.ivl<21?"ðŸŒ±":"ðŸŒ³";case"relearning":return"ðŸ”„";case"suspended":return"â¸ï¸";case"buried":return"ðŸ“¦";default:return"â“"}},getStateLabel=()=>{switch(s.state){case"new":return"New";case"learning":return"Learning";case"review":return s.ivl<21?"Young":"Mature";case"relearning":return"Relearning";case"suspended":return"Suspended";case"buried":return"Buried";default:return"Unknown"}},getAdditionalInfo=()=>{switch(s.state){case"learning":case"relearning":return`Step ${s.learningStep+1}, ${s.left}min left`;case"review":return i>0?`${i} days overdue`:`Interval: ${s.ivl} days`;case"new":return"Never studied";default:return""}};return r?e.jsxs("div",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium ${t}`,style:{backgroundColor:`${l}20`,color:l,border:`1px solid ${l}40`},children:[e.jsx("span",{children:getStateIcon()}),e.jsx("span",{children:getStateLabel()})]}):e.jsxs("div",{className:`bg-white rounded-lg border shadow-sm p-3 ${t}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:l}}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:getStateIcon()}),e.jsx("span",{className:"font-medium text-gray-900",children:getStateLabel()})]})]}),a&&e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:n}),e.jsxs("div",{className:"space-y-1 text-xs text-gray-500",children:[getAdditionalInfo()&&e.jsx("div",{children:getAdditionalInfo()}),"review"===s.state&&e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{children:["Ease: ",(s.factor/10).toFixed(0),"%"]}),e.jsxs("span",{children:["Reviews: ",s.reps]})]}),s.lapses>0&&e.jsxs("div",{className:"text-red-500",children:["Lapses: ",s.lapses]}),d&&"learning"!==s.state&&"relearning"!==s.state&&e.jsxs("div",{children:["Next: ",d.toLocaleDateString()]})]})]})},testStatsLogic=()=>{console.log("\nðŸ§ª TESTING STATS LOGIC - 10 CARD SIMULATION"),console.log("Pattern: Again, Hard, Again, Hard, etc.");let e={total:10,correct:0,incorrect:0};const s=["again","hard"];for(let t=0;t<10;t++){const a=s[t%2],r=t+1;console.log(`\n--- Card ${r} ---`),console.log(`Answer: ${a}`),console.log("Stats before:",e);e="again"===a?{...e,incorrect:e.incorrect+1}:{...e,correct:e.correct+1},console.log("Stats after:",e);const l=Math.floor((r+1)/2),n=Math.floor(r/2),d=e.correct===n,i=e.incorrect===l;if(console.log(`Expected: correct=${n}, incorrect=${l}`),console.log("âœ… Correct count: "+(d?"PASS":"FAIL")),console.log("âœ… Incorrect count: "+(i?"PASS":"FAIL")),!d||!i)return console.error(`âŒ TEST FAILED at card ${r}`),!1}return console.log("\nðŸŽ‰ ALL TESTS PASSED!"),console.log(`Final stats: correct=${e.correct}, incorrect=${e.incorrect}`),!0};console.log("Running stats logic test..."),testStatsLogic(),"undefined"!=typeof window&&(window.testStatsLogic=testStatsLogic);const StudyPage=()=>{const{deckId:s}=o(),a=r(),{getDeck:l,getCards:n,updateCard:d,decks:i,cards:c,startStudySession:m,updateStudySession:g,clearStudySession:h,currentStudySession:u,getStudySession:b}=H(),{awardStudyXP:y}=z(),[p,j]=t.useState(!1),[f,v]=t.useState(!1),[N,k]=t.useState(0),[w,S]=t.useState(!1),[C,A]=t.useState(!1),[M,D]=t.useState(0),[L,T]=t.useState({total:0,correct:0,incorrect:0}),E=u?.studyCards||[],I=s?l(s):null;t.useEffect(()=>{u?.sessionStats&&T(u.sessionStats)},[u?.sessionStats]),t.useEffect(()=>{if(s&&!w){if(u&&u.deckId===s)console.log("Restoring existing study session...");else{const e=n(s);if(e.length>0){console.log("Starting a new study session...");const t=e.filter(e=>0===e.reviewCount||new Date(e.nextReview)<=new Date),a=20,r=(t.length>0?t:e).slice(0,a);m(s,r)}}S(!0)}},[s,n,m,u,w]);const R=G();t.useMemo(()=>u?.sessionStats,[u]),useStudyKeyboardShortcuts({onFlipCard:()=>{!p&&R&&(j(!0),console.log("[Keyboard] Flipped card to show answer"))},onAnswerAgain:()=>{p&&R&&(console.log("[Keyboard] Answered: Again"),handleAnswer("again"))},onAnswerHard:()=>{p&&R&&(console.log("[Keyboard] Answered: Hard"),handleAnswer("hard"))},onAnswerGood:()=>{p&&R&&(console.log("[Keyboard] Answered: Good"),handleAnswer("good"))},onAnswerEasy:()=>{p&&R&&(console.log("[Keyboard] Answered: Easy"),handleAnswer("easy"))},onExitStudy:()=>{console.log("[Keyboard] Exiting study session"),goBackToDecks()},showAnswer:p,enabled:!f&&void 0!==R,debugMode:!0});const handleAnswer=async e=>{if(!R)return;console.log(`\n=== CARD ${M+1} ANSWER ===`),console.log(`Difficulty: ${e}`),console.log("Current stats BEFORE update:",L);const t="again"===e,a=t?{...L,incorrect:L.incorrect+1}:{...L,correct:L.correct+1};console.log(`Answer "${e}" is ${t?"INCORRECT":"CORRECT"}`),console.log("Calculated new stats:",a),console.log(`Expected: correct=${a.correct}, incorrect=${a.incorrect}`),x.flushSync(()=>{T(a),console.log("Stats updated to:",a)});const r=M>=E.length-1,l=M+1;r||x.flushSync(()=>{D(l),j(!1),console.log(`Card index: ${M} -> ${l}`)});const processCardUpdate=async()=>{const t=new Date;let n=R.intervalDays,i=R.easeFactor;const c=R.reviewCount+1;switch(e){case"again":n=1,i=Math.max(1.3,R.easeFactor-.2);break;case"hard":n=0===R.intervalDays?1:Math.max(1,Math.round(1.2*R.intervalDays)),i=Math.max(1.3,R.easeFactor-.15);break;case"good":n=0===R.intervalDays?1:Math.round(R.intervalDays*R.easeFactor);break;case"easy":n=0===R.intervalDays?4:Math.round(R.intervalDays*R.easeFactor*1.3),i=R.easeFactor+.15}const o=new Date(t.getTime()+24*n*60*60*1e3);await d(R.id,{intervalDays:n,easeFactor:i,reviewCount:c,nextReview:o.toISOString()}),s&&!r&&(console.log("Store update - Stats being sent to store:",a),console.log("Store update - Card index being sent:",l),g(l,a))};if(r){v(!0);const e=L.correct+L.incorrect+1,s=a.correct,t=e,r=s,l=10*Math.floor(s/10),n=t+r+l;console.log(`ðŸŽ“ Study session completed! Awarding XP for ${e} cards studied, ${s} correct answers`),console.log(`ðŸŽ‰ XP Breakdown: ${t} base + ${r} bonus + ${l} milestone = ${n} total`),k(n),y(e,s)}processCardUpdate().catch(e=>{console.error("Error processing card update:",e)})},resetSession=()=>{D(0),j(!1),v(!1),T({total:E.length,correct:0,incorrect:0}),k(0),s&&(h(),E.length>0&&m(s,E))},goBackToDecks=()=>{a("/decks")},clearSessionAndGoBack=()=>{s&&h(),a("/decks")};if(t.useEffect(()=>{if(!s&&i.length>0){let e=null,s=new Date("2099-12-31");for(const t of i){const a=c[t.id]||[];if(0===a.length)continue;const r=a.filter(e=>0===e.reviewCount||new Date(e.nextReview)<=new Date);if(r.length>0){const a=r.reduce((e,s)=>{const t=0===s.reviewCount?new Date(s.createdAt):new Date(s.nextReview);return t<e?t:e},new Date("2099-12-31"));a<s&&(s=a,e=t)}}if(e)return void a(`/study/${e.id}`,{replace:!0})}},[s,i,c,a]),!s)return 0===i.length?e.jsxs("div",{className:"max-w-4xl mx-auto text-center py-12",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸ“š"}),e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"No Decks Available"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:"You don't have any decks to study yet. Create your first deck to get started!"}),e.jsx("button",{onClick:goBackToDecks,className:"btn btn-primary",children:"Go to My Decks"})]}):e.jsxs("div",{className:"max-w-4xl mx-auto text-center py-12",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸ”"}),e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Finding Your Next Study Session"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:"Looking for the deck with the most urgent cards to review..."})]});if(!I||!E)return e.jsxs("div",{className:"max-w-4xl mx-auto text-center py-12",children:[e.jsx("div",{className:"text-6xl mb-4",children:"âŒ"}),e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Deck Not Found"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:"The deck you're trying to study doesn't exist."}),e.jsx("button",{onClick:goBackToDecks,className:"btn btn-primary",children:"Back to Decks"})]});if(0===E.length)return e.jsxs("div",{className:"max-w-4xl mx-auto text-center py-12",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸ“š"}),e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"No Cards to Study"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:"This deck doesn't have any cards to study right now."}),e.jsx("button",{onClick:goBackToDecks,className:"btn btn-primary",children:"Back to Decks"})]});if(f){const s=L.correct+L.incorrect,t=s>0?Math.round(L.correct/s*100):0;return e.jsxs("div",{className:"max-w-4xl mx-auto text-center py-12",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸŽ‰"}),e.jsx("h1",{className:"text-3xl font-bold mb-4",children:"Session Complete!"}),e.jsxs("p",{className:"text-gray-600 dark:text-gray-400 mb-8",children:["Great job studying ",e.jsx("strong",{children:I.title})]}),e.jsxs("div",{className:"card p-6 mb-8 max-w-md mx-auto",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Session Stats"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Cards Studied:"}),e.jsx("span",{className:"font-medium",children:s})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Correct:"}),e.jsx("span",{className:"font-medium text-green-600",children:L.correct})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Incorrect:"}),e.jsx("span",{className:"font-medium text-red-600",children:L.incorrect})]}),e.jsxs("div",{className:"flex justify-between border-t pt-2",children:[e.jsx("span",{children:"Accuracy:"}),e.jsxs("span",{className:"font-medium",children:[t,"%"]})]}),N>0&&e.jsxs("div",{className:"flex justify-between border-t pt-2 bg-yellow-50 dark:bg-yellow-900/20 -mx-2 px-2 py-2 rounded",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{children:"ðŸŽ‰"}),e.jsx("span",{className:"font-medium",children:"XP Earned:"})]}),e.jsxs("span",{className:"font-bold text-yellow-600 dark:text-yellow-400",children:["+",N," XP"]})]})]})]}),e.jsxs("div",{className:"flex flex-col gap-4 items-center",children:[e.jsxs("div",{className:"flex gap-4 justify-center",children:[e.jsx("button",{onClick:resetSession,className:"btn btn-primary",children:"Study Again"}),e.jsx("button",{onClick:goBackToDecks,className:"btn btn-secondary",children:"Back to Decks"})]}),e.jsx("button",{onClick:clearSessionAndGoBack,className:"btn btn-outline btn-sm text-gray-500 hover:text-gray-700",children:"Clear Progress & Start Fresh Next Time"})]})]})}return e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:I.title}),e.jsxs("p",{className:"text-gray-600 dark:text-gray-400 mb-2",children:["Card ",M+1," of ",E.length]}),R&&e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx(CardStateIndicator,{card:R,compact:!0,className:"shadow-sm"})}),s&&b(s)&&M>0&&e.jsxs("p",{className:"text-sm text-blue-600 dark:text-blue-400 mb-4 flex items-center justify-center gap-2",children:[e.jsx("span",{children:"ðŸ“"}),"Resumed from where you left off"]}),e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:(M+1)/E.length*100+"%"}})})]}),e.jsx("div",{className:"card p-8 mb-8 min-h-[300px] flex flex-col justify-center",children:R?e.jsxs(e.Fragment,{children:[e.jsx(CardRenderer,{card:R,showAnswer:p,deckId:s}),p?e.jsxs("div",{className:"space-y-4 mt-6",children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6 text-center",children:"How well did you know this?"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[e.jsxs("button",{onClick:()=>handleAnswer("again"),className:"btn bg-red-500 hover:bg-red-600 text-white py-3",children:[e.jsx("div",{className:"text-sm font-medium",children:"Again"}),e.jsx("div",{className:"text-xs opacity-80",children:"< 1 day"}),e.jsx("div",{className:"text-xs opacity-60 mt-1",children:"1 or A"})]}),e.jsxs("button",{onClick:()=>handleAnswer("hard"),className:"btn bg-orange-500 hover:bg-orange-600 text-white py-3",children:[e.jsx("div",{className:"text-sm font-medium",children:"Hard"}),e.jsx("div",{className:"text-xs opacity-80",children:"1-3 days"}),e.jsx("div",{className:"text-xs opacity-60 mt-1",children:"2 or H"})]}),e.jsxs("button",{onClick:()=>handleAnswer("good"),className:"btn bg-green-500 hover:bg-green-600 text-white py-3",children:[e.jsx("div",{className:"text-sm font-medium",children:"Good"}),e.jsx("div",{className:"text-xs opacity-80",children:"3-7 days"}),e.jsx("div",{className:"text-xs opacity-60 mt-1",children:"3 or G"})]}),e.jsxs("button",{onClick:()=>handleAnswer("easy"),className:"btn bg-blue-500 hover:bg-blue-600 text-white py-3",children:[e.jsx("div",{className:"text-sm font-medium",children:"Easy"}),e.jsx("div",{className:"text-xs opacity-80",children:"1+ weeks"}),e.jsx("div",{className:"text-xs opacity-60 mt-1",children:"4 or E"})]})]})]}):e.jsx("div",{className:"text-center mt-6",children:e.jsxs("button",{onClick:()=>j(!0),className:"btn btn-primary btn-lg",children:["Show Answer",e.jsx("span",{className:"ml-2 text-xs opacity-75",children:"(Space/Enter)"})]})})]}):e.jsx("div",{className:"text-center",children:e.jsx("p",{className:"text-gray-500",children:"Loading card..."})})}),e.jsx(StudyShortcutsHelp,{showAnswer:p,compact:!0,className:"mb-4"}),e.jsxs("div",{className:"flex justify-between items-center text-sm text-gray-600 dark:text-gray-400",children:[e.jsxs("div",{children:["Correct: ",e.jsx("span",{className:"text-green-600 font-medium",children:L.correct})," | Incorrect: ",e.jsx("span",{className:"text-red-600 font-medium",children:L.incorrect})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>A(!C),className:"btn btn-outline btn-sm",title:"Toggle keyboard shortcuts help",children:"âŒ¨ï¸"}),e.jsx("button",{onClick:goBackToDecks,className:"btn btn-secondary btn-sm",children:"Exit Study"})]})]}),C&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Keyboard Shortcuts"}),e.jsx("button",{onClick:()=>A(!1),className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",children:"âœ•"})]}),e.jsx(StudyShortcutsHelp,{showAnswer:p,compact:!1}),e.jsxs("div",{className:"mt-4 text-xs text-gray-500 dark:text-gray-400",children:[e.jsxs("p",{children:["ðŸ’¡ ",e.jsx("strong",{children:"Tip:"})," Use Space or Enter to flip cards, then 1-4 or A/H/G/E to answer!"]}),e.jsx("p",{children:"Press Esc or Q to exit the study session anytime."})]})]})})]})},CardManager=({deckId:s,onClose:a})=>{const{getCards:r,addCard:l,updateCard:n,deleteCard:d,getDeck:i}=H(),[c,o]=t.useState(!1),[x,m]=t.useState(null),[g,h]=t.useState(""),[u,b]=t.useState(""),y=i(s),p=r(s),handleAddCard=async e=>{if(e.preventDefault(),g.trim()&&u.trim())try{await l(s,W(g.trim(),u.trim(),{type:"basic"},[])),h(""),b(""),o(!1)}catch(t){console.error("Failed to add card:",t)}},handleEditCard=async e=>{if(e.preventDefault(),x&&g.trim()&&u.trim())try{await n(x.id,{frontContent:g.trim(),backContent:u.trim()}),m(null),h(""),b("")}catch(s){console.error("Failed to update card:",s)}},handleDeleteCard=async e=>{if(confirm("Are you sure you want to delete this card?"))try{await d(e)}catch(s){console.error("Failed to delete card:",s)}},startEdit=e=>{m(e),h(e.frontContent),b(e.backContent),o(!1)},cancelEdit=()=>{m(null),h(""),b(""),o(!1)};return y?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg w-full max-w-4xl max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"flex justify-between items-center p-6 border-b border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold text-gray-900 dark:text-white",children:y.title}),e.jsxs("p",{className:"text-gray-600 dark:text-gray-400",children:[p.length," cards"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>o(!0),className:"btn btn-primary",children:[e.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Add Card"]}),e.jsx("button",{onClick:a,className:"btn btn-secondary",children:"Close"})]})]}),(c||x)&&e.jsxs("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-700",children:[e.jsx("h3",{className:"text-lg font-medium mb-4 text-gray-900 dark:text-white",children:x?"Edit Card":"Add New Card"}),e.jsxs("form",{onSubmit:x?handleEditCard:handleAddCard,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Front"}),e.jsx("textarea",{value:g,onChange:e=>h(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-600 dark:border-gray-500 dark:text-white",rows:3,placeholder:"Enter the question or front side...",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Back"}),e.jsx("textarea",{value:u,onChange:e=>b(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-600 dark:border-gray-500 dark:text-white",rows:3,placeholder:"Enter the answer or back side...",required:!0})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn btn-primary",children:x?"Update Card":"Add Card"}),e.jsx("button",{type:"button",onClick:cancelEdit,className:"btn btn-secondary",children:"Cancel"})]})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:0===p.length?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-4xl mb-4",children:"ðŸ“"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"No cards yet"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"Add your first card to start studying"}),e.jsx("button",{onClick:()=>o(!0),className:"btn btn-primary",children:"Add First Card"})]}):e.jsx("div",{className:"space-y-4",children:p.map((t,a)=>e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-4 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Card #",a+1]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>startEdit(t),className:"p-1 text-gray-400 hover:text-blue-500 transition-colors",title:"Edit card",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),e.jsx("button",{onClick:()=>handleDeleteCard(t.id),className:"p-1 text-gray-400 hover:text-red-500 transition-colors",title:"Delete card",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Front"}),e.jsx("div",{className:"p-3 bg-gray-50 dark:bg-gray-600 rounded border min-h-[60px]",children:e.jsx(MediaHtmlRenderer,{html:t.frontContent,deckId:s,className:"text-gray-900 dark:text-white"})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Back"}),e.jsx("div",{className:"p-3 bg-gray-50 dark:bg-gray-600 rounded border min-h-[60px]",children:e.jsx(MediaHtmlRenderer,{html:t.backContent,deckId:s,className:"text-gray-900 dark:text-white"})})]})]}),e.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200 dark:border-gray-600",children:e.jsxs("div",{className:"flex justify-between text-xs text-gray-500 dark:text-gray-400",children:[e.jsxs("span",{children:["Reviews: ",t.reviewCount]}),e.jsxs("span",{children:["Ease: ",t.easeFactor.toFixed(1)]}),e.jsxs("span",{children:["Interval: ",t.intervalDays," days"]}),t.reviewCount>0&&e.jsxs("span",{children:["Next: ",new Date(t.nextReview).toLocaleDateString()]})]})})]},t.id))})})]})}):e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6",children:[e.jsx("p",{className:"text-red-600",children:"Deck not found"}),e.jsx("button",{onClick:a,className:"btn btn-secondary mt-4",children:"Close"})]})})},ProgressBar=({progress:s,label:t,showPercentage:a=!0,className:r=""})=>{const l=Math.min(Math.max(s,0),100);return e.jsxs("div",{className:`w-full ${r}`,children:[t&&e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:t}),a&&e.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:[Math.round(l),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2.5 dark:bg-gray-700",children:e.jsx("div",{className:"bg-blue-600 h-2.5 rounded-full transition-all duration-300 ease-out",style:{width:`${l}%`}})})]})},DecksPage=()=>{const s=r(),{getUserDecks:a,isLoading:l,error:n,importProgress:d,importStatus:i,createDeck:c,deleteDeck:o,loadExampleDecks:x,importAnkiDeck:m,importFromText:g,clearError:h,getCards:u,resetImportProgress:b,hydrateFromIndexedDB:y,hydrated:p,addCard:j}=H(),[f,v]=t.useState(""),[N,k]=t.useState("all"),[w,S]=t.useState(null),[C,A]=t.useState(!1);console.log("DecksPage: showCreateModal state initialized:",C);const[M,D]=t.useState(!1),[L,T]=t.useState(!1),[E,I]=t.useState(""),R=[{id:"world-countries",name:"World Countries",description:"Learn all countries of the world",emoji:"ðŸŒ",regions:["United States","Canada","Mexico","Brazil","Argentina","United Kingdom","France","Germany","Italy","Spain","Russia","China","Japan","India","Australia","South Africa","Egypt","Nigeria","Kenya","Morocco"]},{id:"us-states",name:"US States",description:"Learn all 50 US states",emoji:"ðŸ‡ºðŸ‡¸",regions:["Alabama","Alaska","Arizona","Arkansas","California","Colorado","Connecticut","Delaware","Florida","Georgia","Hawaii","Idaho","Illinois","Indiana","Iowa","Kansas","Kentucky","Louisiana","Maine","Maryland","Massachusetts","Michigan","Minnesota","Mississippi","Missouri","Montana","Nebraska","Nevada","New Hampshire","New Jersey","New Mexico","New York","North Carolina","North Dakota","Ohio","Oklahoma","Oregon","Pennsylvania","Rhode Island","South Carolina","South Dakota","Tennessee","Texas","Utah","Vermont","Virginia","Washington","West Virginia","Wisconsin","Wyoming"]},{id:"europe",name:"European Countries",description:"Learn countries in Europe",emoji:"ðŸ‡ªðŸ‡º",regions:["Albania","Andorra","Austria","Belarus","Belgium","Bosnia and Herzegovina","Bulgaria","Croatia","Cyprus","Czech Republic","Denmark","Estonia","Finland","France","Germany","Greece","Hungary","Iceland","Ireland","Italy","Latvia","Liechtenstein","Lithuania","Luxembourg","Malta","Moldova","Monaco","Montenegro","Netherlands","North Macedonia","Norway","Poland","Portugal","Romania","San Marino","Serbia","Slovakia","Slovenia","Spain","Sweden","Switzerland","Ukraine","United Kingdom","Vatican City"]}],[P,F]=t.useState(""),[$,O]=t.useState(""),[B,U]=t.useState(""),[z,G]=t.useState(""),[q,_]=t.useState("\t"),X=t.useRef(!1);t.useEffect(()=>{p||y()},[p,y]);const V=a();t.useEffect(()=>{const e=setTimeout(()=>{p&&0===V.length&&!X.current&&(X.current=!0,x())},100);return()=>clearTimeout(e)},[p,V,x]);const Y=V.filter(e=>{const s=e.title.toLowerCase().includes(f.toLowerCase())||e.description.toLowerCase().includes(f.toLowerCase()),t="all"===N||e.category===N;return s&&t}),Q=["all",...Array.from(new Set(V.map(e=>e.category).filter(Boolean)))],handleCreateDeck=async e=>{e.preventDefault();try{const{user:e}=K.getState(),s=e?.id||"local-user";await c({userId:s,title:P,description:$,cardCount:0,isPublic:!1,settings:{newCardsPerDay:20,maxReviewsPerDay:100,easyBonus:1.3,intervalModifier:1,maximumInterval:36500,minimumInterval:1},category:B||"general"}),A(!1),F(""),O(""),U("")}catch(s){console.error("Failed to create deck:",s)}},handleDeleteDeck=async e=>{if(confirm("Are you sure you want to delete this deck? This action cannot be undone."))try{await o(e)}catch(s){console.error("Failed to delete deck:",s)}},handleFileImport=async e=>{const s=e.target.files?.[0];if(s)try{if(s.name.endsWith(".apkg")||s.name.endsWith(".txt"))await m(s);else{const e=await s.text();await g(s.name.replace(/\.[^/.]+$/,""),e,q)}D(!1)}catch(t){console.error("Failed to import file:",t),b()}},handleTextImport=async e=>{e.preventDefault();try{const e=await g("Imported Deck",z,q);console.log("Successfully imported deck:",e),D(!1),G(""),h()}catch(s){console.error("Failed to import text:",s)}},getDeckStats=e=>{const s=u(e.id),t=s.filter(e=>0===e.reviewCount).length,a=s.filter(e=>e.reviewCount>0&&new Date(e.nextReview)<=new Date).length;return{total:s.length,new:t,review:a}},handleStudyDeck=e=>{s(`/study/${e}`)},handleCreateMapDeck=async()=>{const e=R.find(e=>e.id===E);if(e)try{const{user:s}=K.getState(),t=s?.id||"local-user",a=await c({userId:t,title:e.name,description:e.description,cardCount:e.regions.length,isPublic:!1,settings:{newCardsPerDay:20,maxReviewsPerDay:100,easyBonus:1.3,intervalModifier:1,maximumInterval:36500,minimumInterval:1},category:"geography"});for(const r of e.regions)await j(a.id,W(`What is this region? [Map: ${e.id}]`,r,{type:"basic"},[]));T(!1),I("")}catch(s){console.error("Failed to create map deck:",s)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"My Decks"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Manage your flashcard decks"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>{console.log("Create deck button clicked"),"function"==typeof A?A(!0):console.error("setShowCreateModal is not a function")},className:"btn btn-primary",children:[e.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Create Deck"]}),e.jsxs("button",{onClick:()=>D(!0),className:"btn btn-secondary",children:[e.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10"})}),"Import"]})]})]}),n&&e.jsxs("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative",children:[e.jsx("span",{className:"block sm:inline",children:n}),e.jsx("button",{onClick:h,className:"absolute top-0 bottom-0 right-0 px-4 py-3",children:e.jsx("svg",{className:"fill-current h-6 w-6 text-red-500",role:"button",viewBox:"0 0 20 20",children:e.jsx("path",{d:"M14.348 14.849a1.2 1.2 0 0 1-1.697 0L10 11.819l-2.651 3.029a1.2 1.2 0 1 1-1.697-1.697l2.758-3.15-2.759-3.152a1.2 1.2 0 1 1 1.697-1.697L10 8.183l2.651-3.031a1.2 1.2 0 1 1 1.697 1.697l-2.758 3.152 2.758 3.15a1.2 1.2 0 0 1 0 1.698z"})})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx("input",{type:"text",placeholder:"Search decks...",value:f,onChange:e=>v(e.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:border-gray-600 dark:text-white"})}),e.jsx("select",{value:N,onChange:e=>k(e.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:border-gray-600 dark:text-white",children:Q.map(s=>e.jsx("option",{value:s,children:"all"===s?"All Categories":(s||"").charAt(0).toUpperCase()+(s||"").slice(1)},s))})]}),l&&e.jsx("div",{className:"flex justify-center items-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}),!l&&e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:Y.map(s=>{const t=getDeckStats(s);return e.jsxs("div",{className:"card p-6 hover:shadow-lg transition-shadow",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-2",children:s.title}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm mb-3",children:s.description}),s.category&&e.jsx("span",{className:"inline-block bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full",children:s.category})]}),e.jsx("div",{className:"flex gap-1 ml-4",children:e.jsx("button",{onClick:()=>handleDeleteDeck(s.id),className:"p-2 text-gray-400 hover:text-red-500 transition-colors",title:"Delete deck",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Total Cards"}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:t.total})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"New"}),e.jsx("span",{className:"font-medium text-blue-600",children:t.new})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Due for Review"}),e.jsx("span",{className:"font-medium text-orange-600",children:t.review})]})]}),e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>handleStudyDeck(s.id),className:"btn btn-primary btn-sm flex-1",children:"Study Now"}),e.jsx("button",{onClick:()=>S(s.id),className:"btn btn-secondary btn-sm flex-1",children:"Manage Cards"})]})})]},s.id)})}),!l&&0===Y.length&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸ“š"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-2",children:f||"all"!==N?"No decks found":"No decks yet"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:f||"all"!==N?"Try adjusting your search or filter criteria":"Create your first deck or import existing flashcards to get started"}),!f&&"all"===N&&e.jsxs("div",{className:"flex justify-center gap-4",children:[e.jsx("button",{onClick:()=>A(!0),className:"btn btn-primary",children:"Create Your First Deck"}),e.jsx("button",{onClick:()=>D(!0),className:"btn btn-secondary",children:"Import Existing Deck"})]})]}),void 0!==C&&C&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 w-full max-w-md",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4 text-gray-900 dark:text-white",children:"Create New Deck"}),e.jsxs("form",{onSubmit:handleCreateDeck,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Title *"}),e.jsx("input",{type:"text",value:P,onChange:e=>F(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Description"}),e.jsx("textarea",{value:$,onChange:e=>O(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white",rows:3})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Category"}),e.jsx("input",{type:"text",value:B,onChange:e=>U(e.target.value),placeholder:"e.g., language, science, history",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white"})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>A(!1),className:"flex-1 btn btn-secondary",children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 btn btn-primary",children:"Create Deck"})]})]})]})}),M&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 w-full max-w-lg",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4 text-gray-900 dark:text-white",children:"Import Deck"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium mb-2 text-gray-900 dark:text-white",children:"Import from File"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-3",children:"Upload an Anki deck (.apkg) or text file (.txt)"}),e.jsx("input",{type:"file",accept:".apkg,.txt,.csv",onChange:handleFileImport,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white",disabled:l}),l&&d>0&&e.jsx("div",{className:"mt-4",children:e.jsx(ProgressBar,{progress:d,label:i||"Importing...",className:"mb-2"})})]}),e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-6",children:[e.jsx("h3",{className:"text-lg font-medium mb-2 text-gray-900 dark:text-white",children:"Import from Text"}),e.jsxs("form",{onSubmit:handleTextImport,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Separator"}),e.jsxs("select",{value:q,onChange:e=>_(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white",children:[e.jsx("option",{value:"\\t",children:"Tab"}),e.jsx("option",{value:",",children:"Comma"}),e.jsx("option",{value:";",children:"Semicolon"}),e.jsx("option",{value:"|",children:"Pipe"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Text (Front",q,"Back format)"]}),e.jsx("textarea",{value:z,onChange:e=>G(e.target.value),placeholder:`Example:\nHello${q}Hola\nGoodbye${q}AdiÃ³s`,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white",rows:6})]}),e.jsx("button",{type:"submit",disabled:!z.trim()||l,className:"w-full btn btn-primary disabled:opacity-50 disabled:cursor-not-allowed",children:l?"Importing...":"Import Text"}),l&&d>0&&e.jsx("div",{className:"mt-4",children:e.jsx(ProgressBar,{progress:d,label:i||"Importing...",className:"mb-2"})})]})]})]}),e.jsx("div",{className:"flex justify-end pt-6 border-t border-gray-200 dark:border-gray-700 mt-6",children:e.jsx("button",{onClick:()=>{D(!1),b()},disabled:l,className:"btn btn-secondary disabled:opacity-50 disabled:cursor-not-allowed",children:l?"Importing...":"Close"})})]})}),L&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 w-full max-w-lg",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4 text-gray-900 dark:text-white",children:"Create Geography Deck"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸ—ºï¸"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Interactive Geography Learning"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:"Choose a map type to create an interactive geography deck. Each card will show a highlighted region, and you'll need to identify its name."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"Select Map Type"}),e.jsx("div",{className:"grid grid-cols-1 gap-3 max-h-64 overflow-y-auto",children:R.map(s=>e.jsx("button",{onClick:()=>I(s.id),className:"p-4 text-left border rounded-lg transition-colors "+(E===s.id?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-300 dark:border-gray-600 hover:border-gray-400"),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white",children:s.name}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:s.description}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-500 mt-1",children:[s.regions.length," ",1===s.regions.length?"region":"regions"]})]}),e.jsx("div",{className:"text-2xl ml-4",children:s.emoji})]})},s.id))})]}),E&&e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-blue-900 dark:text-blue-100 mb-2",children:"What you'll get:"}),e.jsxs("ul",{className:"text-sm text-blue-800 dark:text-blue-200 space-y-1",children:[e.jsxs("li",{children:["â€¢ ",R.find(e=>e.id===E)?.regions.length," interactive map cards"]}),e.jsx("li",{children:"â€¢ Visual region highlighting"}),e.jsx("li",{children:"â€¢ Enhanced indicators for small regions"}),e.jsx("li",{children:"â€¢ Immediate feedback"}),e.jsx("li",{children:"â€¢ Spaced repetition learning"})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>{T(!1),I("")},className:"flex-1 btn btn-secondary",children:"Cancel"}),e.jsx("button",{onClick:handleCreateMapDeck,disabled:l||!E,className:"flex-1 btn btn-success disabled:opacity-50 disabled:cursor-not-allowed",children:l?"Creating...":`Create ${E?R.find(e=>e.id===E)?.name:""} Deck`})]})]})]})}),w&&e.jsx(CardManager,{deckId:w,onClose:()=>S(null)})]})},ConfirmationDialog=({isOpen:s,onClose:t,onConfirm:a,title:r,message:l,confirmText:n="Confirm",cancelText:d="Cancel",isDestructive:i=!1,isLoading:c=!1})=>s?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md w-full",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center mr-4 "+(i?"bg-red-100 dark:bg-red-900":"bg-blue-100 dark:bg-blue-900"),children:e.jsx("span",{className:"text-2xl",children:i?"âš ï¸":"â„¹ï¸"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:r})]}),e.jsx("div",{className:"mb-6",children:e.jsx("p",{className:"text-gray-600 dark:text-gray-400 leading-relaxed",children:l})}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{onClick:t,disabled:c,className:"px-4 py-2 text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:d}),e.jsxs("button",{onClick:a,disabled:c,className:"px-4 py-2 text-white rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2 "+(i?"bg-red-600 hover:bg-red-700":"bg-blue-600 hover:bg-blue-700"),children:[c&&e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),e.jsx("span",{children:n})]})]})]})})}):null,ProfilePage=()=>{const{user:s,updateUser:a,isLoading:r,initializeAuth:l,connectOnline:n,disconnectOnline:d,isOnlineLinked:i}=K(),[,c]=t.useState(null),[o,x]=t.useState([]),[m,g]=t.useState([]),[h,u]=t.useState([]),[b,y]=t.useState(!1),[p,j]=t.useState(null),[f,v]=t.useState(!1),[N,k]=t.useState(!1),[w,S]=t.useState(!1),[C,A]=t.useState(!1),[M,D]=t.useState(null),{resetAllStudyData:L}=H(),{resetAllUserData:T,userStats:E,isInitialized:I,userStreak:R,initializeUserData:P}=z();t.useEffect(()=>{s||r||l()},[s,r,l]);const F=t.useCallback(async()=>{if(s){y(!0),j(null);try{const t="demo@studymaster.com"===s.email||"demo"===s.tokenType;if(P(t),t)c(null),x([]),g([]),u([]);else{const t={...s,token:s.token,tokenType:s.tokenType};try{const[e,s,a,r]=await Promise.all([V.getUserStats(t),V.getUserActivity(t,30),V.getUserAchievements(t),V.getUserChallenges(t)]);c(e),x(s),g(a),u(r)}catch(e){console.warn("API data loading failed, using fallback:",e),c(null),x([]),g([]),u([])}}}catch(t){console.error("Failed to load user data:",t),j("Unable to load user statistics. Please try again later.")}finally{y(!1)}}},[s,P]);t.useEffect(()=>{F()},[F]);const[$,O]=t.useState({username:s?.username||"",email:s?.email||"",dailyGoal:s?.preferences.dailyGoal||50}),[B,U]=t.useState(isOnlineLeaderboardEnabled()),[G,W]=t.useState({serverUserId:"",accessToken:"",refreshToken:""}),[q,_]=t.useState(!1),[X,J]=t.useState(null),[Z,ee]=t.useState(null),[se,te]=t.useState(null),[le,ne]=t.useState(!1),[de,ie]=t.useState(!1),[ce,oe]=t.useState(null),[xe,me]=t.useState(null),[ge,he]=t.useState(null),[ue,be]=t.useState(null),ye=t.useRef(null);t.useEffect(()=>{let e=!1;return s&&(async()=>{try{const s=await i("studymaster");e||J(s)}catch{e||J(!1)}})(),()=>{e=!0}},[s,i]);const handleToggleOnline=()=>{const e=!B;U(e),setOnlineLeaderboardEnabled(e)},handleConnectOnline=async()=>{_(!0),ee(null),te(null);try{await n("studymaster",{serverUserId:G.serverUserId.trim(),accessToken:G.accessToken.trim(),refreshToken:G.refreshToken?.trim()||void 0,scopes:["leaderboard:read","leaderboard:write"]}),J(!0),W({serverUserId:"",accessToken:"",refreshToken:""}),te("Online account linked successfully.")}catch(e){ee(e instanceof Error?e.message:"Failed to link account")}finally{_(!1)}},handleDisconnectOnline=async()=>{_(!0),ee(null),te(null);try{await d("studymaster"),J(!1),te("Online account disconnected.")}catch(e){ee(e instanceof Error?e.message:"Failed to disconnect account")}finally{_(!1)}},handleSaveProfile=()=>{s&&a({username:$.username,email:$.email,preferences:{...s.preferences,dailyGoal:$.dailyGoal}}),v(!1)},handleResetAllData=async()=>{if(s){S(!0),D(null);try{if(!("demo@studymaster.com"===s.email||"demo"===s.tokenType)){const t={...s,token:s.token,tokenType:s.tokenType};try{await V.resetAllUserData(t)}catch(e){console.warn("API reset failed, proceeding with local reset:",e)}}T(),L(),c(null),x([]),g([]),u([]),j(null),A(!0),k(!1),setTimeout(async()=>{A(!1);const e="demo@studymaster.com"===s.email||"demo"===s.tokenType;P(e),await F()},1500)}catch(t){console.error("Failed to reset user data:",t),D("Failed to reset data. Please try again.")}finally{S(!1)}}};if(r)return e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl text-gray-900 dark:text-white",children:"Loading profile..."})]})});if(!s)return e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx("div",{className:"text-center",children:e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-4",children:"Please log in to view your profile"})})});const handleExportData=async()=>{ne(!0),me(null),oe(null);try{await Y(),oe("Export downloaded.")}catch(e){me(e instanceof Error?e.message:"Export failed")}finally{ne(!1)}},handleImportClick=()=>{ye.current?.click()},handleImportFileChange=async e=>{const s=e.target.files?.[0];if(s){ie(!0),be(null),he(null);try{const e=await Q(s,{includeEphemeral:!1,overwriteSettings:!0}),t=[];e.counts?.decks&&t.push(`${e.counts.decks} decks`),e.counts?.cards&&t.push(`${e.counts.cards} cards`),e.counts?.reviews&&t.push(`${e.counts.reviews} reviews`),he(`Imported successfully${t.length?` (${t.join(", ")})`:""}.`)}catch(t){be(t instanceof Error?t.message:"Import failed")}finally{ie(!1),e.target.value=""}}};return e.jsxs("div",{className:"max-w-6xl mx-auto p-6 space-y-8",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h1",{className:"text-4xl font-bold text-gray-900 dark:text-white mb-2",children:"Profile"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Track your progress and achievements"})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 border border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white text-2xl font-bold",children:s.username.charAt(0).toUpperCase()}),e.jsx("div",{children:f?e.jsxs("div",{className:"space-y-2",children:[e.jsx("input",{type:"text",value:$.username,onChange:e=>O({...$,username:e.target.value}),className:"text-2xl font-bold bg-transparent border-b border-gray-300 dark:border-gray-600 focus:outline-none focus:border-blue-500 text-gray-900 dark:text-white"}),e.jsx("input",{type:"email",value:$.email,onChange:e=>O({...$,email:e.target.value}),className:"text-gray-600 dark:text-gray-400 bg-transparent border-b border-gray-300 dark:border-gray-600 focus:outline-none focus:border-blue-500"})]}):e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:s.username}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:s.email})]})})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"flex items-center space-x-2 text-yellow-600 dark:text-yellow-400",children:[e.jsx("span",{className:"text-lg",children:"ðŸ’°"}),e.jsx("span",{className:"font-bold",children:E.gold})]}),e.jsxs("div",{className:"flex items-center space-x-2 text-purple-600 dark:text-purple-400",children:[e.jsx("span",{className:"text-lg",children:"ðŸ’Ž"}),e.jsx("span",{className:"font-bold",children:E.diamonds})]})]}),f?e.jsxs("div",{className:"space-x-2",children:[e.jsx("button",{onClick:handleSaveProfile,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Save"}),e.jsx("button",{onClick:()=>v(!1),className:"px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors",children:"Cancel"})]}):e.jsx("button",{onClick:()=>v(!0),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Edit Profile"})]})]}),e.jsx(ae,{currentXP:E.xp,level:E.level,className:"mb-4"}),b?e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mt-6",children:[...Array(4)].map((s,t)=>e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-pulse bg-gray-300 dark:bg-gray-600 h-8 w-16 mx-auto rounded mb-2"}),e.jsx("div",{className:"animate-pulse bg-gray-300 dark:bg-gray-600 h-4 w-20 mx-auto rounded"})]},t))}):I?e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mt-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:E.totalCards.toLocaleString()}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Cards Studied"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:[Math.floor(E.totalStudyTime/60),"h ",E.totalStudyTime%60,"m"]}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Study Time"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-purple-600 dark:text-purple-400",children:[E.averageAccuracy.toFixed(1),"%"]}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Accuracy"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600 dark:text-orange-400",children:E.currentStreak}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Day Streak"})]})]}):e.jsx("div",{className:"text-center py-4 text-gray-500 dark:text-gray-400",children:p||"Unable to load stats"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-8",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 border border-gray-200 dark:border-gray-700",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Recent Activity"}),b?e.jsx("div",{className:"animate-pulse space-y-4",children:[...Array(5)].map((s,t)=>e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:"bg-gray-300 dark:bg-gray-600 h-4 w-20 rounded"}),e.jsx("div",{className:"bg-gray-300 dark:bg-gray-600 h-4 w-16 rounded"}),e.jsx("div",{className:"bg-gray-300 dark:bg-gray-600 h-4 w-12 rounded"})]},t))}):o.length>0?e.jsx("div",{className:"space-y-3",children:o.slice(0,10).map((s,t)=>e.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-gray-100 dark:border-gray-700 last:border-b-0",children:[e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:new Date(s.date).toLocaleDateString()}),e.jsxs("div",{className:"flex space-x-4 text-sm",children:[e.jsxs("span",{className:"text-blue-600 dark:text-blue-400",children:[s.cardsStudied," cards"]}),e.jsxs("span",{className:"text-green-600 dark:text-green-400",children:[s.studyTime,"m"]}),e.jsxs("span",{className:"text-purple-600 dark:text-purple-400",children:[s.accuracy,"%"]})]})]},t))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-4xl mb-4",children:"ðŸ“Š"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"No activity data available yet. Start studying to see your progress!"})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 border border-gray-200 dark:border-gray-700",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Active Challenges"}),b?e.jsx("div",{className:"animate-pulse space-y-4",children:[...Array(2)].map((s,t)=>e.jsxs("div",{className:"border border-gray-200 dark:border-gray-600 rounded-lg p-4",children:[e.jsx("div",{className:"bg-gray-300 dark:bg-gray-600 h-6 w-3/4 rounded mb-2"}),e.jsx("div",{className:"bg-gray-300 dark:bg-gray-600 h-4 w-full rounded mb-3"}),e.jsx("div",{className:"bg-gray-300 dark:bg-gray-600 h-2 w-full rounded"})]},t))}):h.length>0?e.jsx("div",{className:"space-y-4",children:h.map(s=>{const t=Math.min(s.current/s.target*100,100);return e.jsxs("div",{className:"border border-gray-200 dark:border-gray-600 rounded-lg p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-900 dark:text-white",children:s.name}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:s.description})]}),e.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium "+(s.completedAt?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200"),children:s.completedAt?"Completed":s.type})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Progress"}),e.jsxs("span",{className:"font-medium text-gray-900 dark:text-white",children:[s.current," / ",s.target]})]}),e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-500",style:{width:`${t}%`}})})]}),e.jsxs("div",{className:"flex items-center space-x-4 mt-3 text-sm text-gray-600 dark:text-gray-400",children:[e.jsxs("span",{children:["+",s.reward.xp," XP"]}),e.jsxs("span",{children:["+",s.reward.coins," coins"]}),s.reward.gems&&e.jsxs("span",{children:["+",s.reward.gems," gems"]})]})]},s.id)})}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-4xl mb-4",children:"ðŸŽ¯"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"No active challenges. Check the Challenges page to join some!"})]})]})]}),e.jsxs("div",{className:"space-y-8",children:[e.jsx(re,{currentStreak:E.currentStreak,longestStreak:E.longestStreak,lastStudyDate:R?.lastStudyDate||(new Date).toISOString()}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 border border-gray-200 dark:border-gray-700",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:["Achievements (",m.length,")"]}),b?e.jsx("div",{className:"animate-pulse grid grid-cols-4 gap-3",children:[...Array(8)].map((s,t)=>e.jsx("div",{className:"bg-gray-300 dark:bg-gray-600 h-16 w-16 rounded-lg"},t))}):m.length>0?e.jsx("div",{className:"grid grid-cols-4 gap-3",children:m.map(s=>e.jsxs("div",{className:"bg-gradient-to-br from-yellow-400 to-orange-500 rounded-lg p-3 text-center text-white shadow-lg",title:`${s.name}: ${s.description}`,children:[e.jsx("div",{className:"text-2xl mb-1",children:s.icon}),e.jsx("div",{className:"text-xs font-medium truncate",children:s.name})]},s.id))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-4xl mb-4",children:"ðŸ†"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"No achievements yet. Keep studying to unlock them!"})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 border border-gray-200 dark:border-gray-700",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Account & Online Services"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Enable online leaderboards (optional)"}),e.jsx("div",{role:"switch","aria-checked":B,tabIndex:0,onClick:handleToggleOnline,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||handleToggleOnline()},className:"w-12 h-6 rounded-full cursor-pointer transition-colors "+(B?"bg-blue-600":"bg-gray-300 dark:bg-gray-600"),title:"Toggle online leaderboard",children:e.jsx("div",{className:`w-5 h-5 bg-white rounded-full shadow-md transform transition-transform ${B?"translate-x-6":"translate-x-0.5"} mt-0.5`})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-sm",children:e.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium "+(X?"bg-emerald-100 text-emerald-800 dark:bg-emerald-900/40 dark:text-emerald-200":"bg-gray-200 text-gray-800 dark:bg-gray-700 dark:text-gray-200"),children:X?"Linked to StudyMaster Online":"Not linked"})}),X&&e.jsx("button",{onClick:handleDisconnectOnline,disabled:q,className:"px-3 py-1 rounded bg-red-600 text-white text-sm hover:bg-red-700 disabled:opacity-50",children:q?"Disconnectingâ€¦":"Disconnect"})]}),B&&!1===X&&e.jsxs("div",{className:"space-y-3",children:[Z&&e.jsx("div",{className:"text-sm text-red-600 dark:text-red-400",children:Z}),se&&e.jsx("div",{className:"text-sm text-emerald-600 dark:text-emerald-400",children:se}),e.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[e.jsx("input",{type:"text",value:G.serverUserId,onChange:e=>W({...G,serverUserId:e.target.value}),placeholder:"Server User ID",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white"}),e.jsx("input",{type:"password",value:G.accessToken,onChange:e=>W({...G,accessToken:e.target.value}),placeholder:"Access Token",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white"}),e.jsx("input",{type:"password",value:G.refreshToken,onChange:e=>W({...G,refreshToken:e.target.value}),placeholder:"Refresh Token (optional)",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white"})]}),e.jsx("div",{className:"flex items-center justify-end",children:e.jsx("button",{onClick:handleConnectOnline,disabled:q||!G.serverUserId.trim()||!G.accessToken.trim(),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:q?"Connectingâ€¦":"Connect"})})]}),e.jsx("div",{className:"mt-2 text-xs text-gray-500 dark:text-gray-400",children:"Online features are optional. Your study data and media are stored locally in your browser (IndexedDB/OPFS). Nothing is uploaded unless you explicitly enable online features and link your account. Tokens are stored securely in local storage (IndexedDB) and are never written to localStorage or cookies."})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 border border-gray-200 dark:border-gray-700",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Study Settings"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Daily Goal"}),f?e.jsx("input",{type:"number",value:$.dailyGoal,onChange:e=>O({...$,dailyGoal:parseInt(e.target.value)||50}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white",min:"1",max:"500"}):e.jsxs("div",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:[s.preferences.dailyGoal," cards"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Notifications"}),e.jsx("div",{className:"w-12 h-6 rounded-full transition-colors "+(s.preferences.notifications?"bg-blue-600":"bg-gray-300 dark:bg-gray-600"),children:e.jsx("div",{className:`w-5 h-5 bg-white rounded-full shadow-md transform transition-transform ${s.preferences.notifications?"translate-x-6":"translate-x-0.5"} mt-0.5`})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Sound Effects"}),e.jsx("div",{className:"w-12 h-6 rounded-full transition-colors "+(s.preferences.soundEffects?"bg-blue-600":"bg-gray-300 dark:bg-gray-600"),children:e.jsx("div",{className:`w-5 h-5 bg-white rounded-full shadow-md transform transition-transform ${s.preferences.soundEffects?"translate-x-6":"translate-x-0.5"} mt-0.5`})})]})]}),e.jsxs("div",{className:"mt-8 pt-6 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("h4",{className:"text-md font-semibold text-gray-900 dark:text-white mb-3",children:"Backup & Restore"}),e.jsxs("div",{className:"space-y-1 mb-2",children:[xe&&e.jsx("div",{className:"text-sm text-red-600 dark:text-red-400",children:xe}),ce&&e.jsx("div",{className:"text-sm text-emerald-600 dark:text-emerald-400",children:ce}),ue&&e.jsx("div",{className:"text-sm text-red-600 dark:text-red-400",children:ue}),ge&&e.jsx("div",{className:"text-sm text-emerald-600 dark:text-emerald-400",children:ge})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:handleExportData,disabled:le,className:"px-4 py-2 bg-gray-700 text-white rounded-lg hover:bg-gray-800 disabled:opacity-50",children:le?"Exportingâ€¦":"Export JSON"}),e.jsx("button",{onClick:handleImportClick,disabled:de,className:"px-4 py-2 bg-gray-700 text-white rounded-lg hover:bg-gray-800 disabled:opacity-50",children:de?"Importingâ€¦":"Import JSON"}),e.jsx("input",{ref:ye,type:"file",accept:"application/json",className:"hidden",onChange:handleImportFileChange})]}),e.jsx("p",{className:"mt-2 text-xs text-gray-500 dark:text-gray-400",children:"Export excludes media blobs (manifest only). Import upserts data into your local IndexedDB. No data leaves your device unless you enable optional online features."})]}),e.jsxs("div",{className:"mt-8 pt-6 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("h4",{className:"text-md font-semibold text-gray-900 dark:text-white mb-3",children:"Data Management"}),e.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("span",{className:"text-red-500 text-xl",children:"âš ï¸"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h5",{className:"text-sm font-medium text-red-800 dark:text-red-200 mb-1",children:"Reset All Statistics"}),e.jsx("p",{className:"text-sm text-red-700 dark:text-red-300 mb-3",children:"This will permanently delete all your study progress, achievements, streaks, and performance data. This action cannot be undone."}),e.jsxs("button",{onClick:()=>k(!0),disabled:w,className:"px-4 py-2 bg-red-600 text-white text-sm rounded-lg hover:bg-red-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2",children:[w&&e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),e.jsx("span",{children:"Reset All Data"})]})]})]})})]})]})]})]}),C&&e.jsxs("div",{className:"fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50 flex items-center space-x-2",children:[e.jsx("span",{className:"text-lg",children:"âœ…"}),e.jsx("span",{children:"All statistics have been reset successfully!"})]}),M&&e.jsxs("div",{className:"fixed top-4 right-4 bg-red-500 text-white px-6 py-3 rounded-lg shadow-lg z-50 flex items-center space-x-2",children:[e.jsx("span",{className:"text-lg",children:"âŒ"}),e.jsx("span",{children:M}),e.jsx("button",{onClick:()=>D(null),className:"ml-2 text-white hover:text-gray-200",children:"Ã—"})]}),e.jsx(ConfirmationDialog,{isOpen:N,onClose:()=>k(!1),onConfirm:handleResetAllData,title:"Reset All Statistics",message:"Are you absolutely sure you want to reset all your statistics? This will permanently delete all your study progress, achievements, streaks, challenge progress, and performance data. This action cannot be undone and you will lose all your current progress.",confirmText:"Yes, Reset Everything",cancelText:"Cancel",isDestructive:!0,isLoading:w})]})},ChallengesPage=()=>{const{user:s}=K(),[a,r]=t.useState([]),[l,n]=t.useState(!1),[d,i]=t.useState(null),[c,o]=t.useState("all"),[x,m]=t.useState("expiresAt");t.useEffect(()=>{(async()=>{if(s){n(!0),i(null);try{const e={...s,token:s.token,tokenType:s.tokenType},t=await V.getUserChallenges(e);r(t)}catch(e){console.error("Failed to load challenge data:",e),i("Failed to load challenge data")}finally{n(!1)}}})()},[s]);const getFilterCount=e=>{switch(e){case"active":return a.filter(e=>!e.completedAt&&new Date(e.expiresAt)>new Date).length;case"completed":return a.filter(e=>e.completedAt).length;case"available":return a.filter(e=>!e.completedAt).length;default:return a.length}},getProgressPercentage=e=>Math.min(e.current/e.target*100,100),isExpired=e=>new Date(e.expiresAt)<new Date,getTimeRemaining=e=>{const s=new Date,t=new Date(e.expiresAt).getTime()-s.getTime();if(t<=0)return"Expired";const a=Math.floor(t/864e5),r=Math.floor(t%864e5/36e5);return a>0?`${a}d ${r}h`:`${r}h`},g=(()=>{let e=a;switch(c){case"active":e=a.filter(e=>!e.completedAt&&new Date(e.expiresAt)>new Date);break;case"completed":e=a.filter(e=>e.completedAt);break;case"available":e=a.filter(e=>!e.completedAt)}return e.sort((e,s)=>{switch(x){case"expiresAt":return new Date(e.expiresAt).getTime()-new Date(s.expiresAt).getTime();case"reward":{const t=e.reward.xp+e.reward.coins+10*(e.reward.gems||0);return s.reward.xp+s.reward.coins+10*(s.reward.gems||0)-t}case"progress":{const t=e.current/e.target*100;return s.current/s.target*100-t}default:return 0}})})();return e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 py-8",children:e.jsxs("div",{className:"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-2",children:"ðŸ† Challenges"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Complete challenges to earn XP, achievements, and compete with other learners"})]}),l?e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-8",children:[...Array(4)].map((s,t)=>e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 border border-gray-200 dark:border-gray-700",children:[e.jsx("div",{className:"animate-pulse bg-gray-300 dark:bg-gray-600 h-8 w-12 rounded mb-2"}),e.jsx("div",{className:"animate-pulse bg-gray-300 dark:bg-gray-600 h-4 w-16 rounded"})]},t))}):e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-8",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 border border-gray-200 dark:border-gray-700",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:a.length}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Total"})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 border border-gray-200 dark:border-gray-700",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:a.filter(e=>e.completedAt).length}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Completed"})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 border border-gray-200 dark:border-gray-700",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600 dark:text-orange-400",children:a.filter(e=>!e.completedAt&&new Date(e.expiresAt)>new Date).length}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Active"})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 border border-gray-200 dark:border-gray-700",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600 dark:text-purple-400",children:a.filter(e=>new Date(e.expiresAt)<new Date).length}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Expired"})]})]}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 mb-6 border border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between space-y-4 sm:space-y-0",children:[e.jsx("div",{className:"flex space-x-1 bg-gray-100 dark:bg-gray-700 rounded-lg p-1",children:["all","active","completed","available"].map(s=>e.jsxs("button",{onClick:()=>o(s),className:"px-3 py-2 rounded-md text-sm font-medium transition-colors "+(c===s?"bg-white dark:bg-gray-600 text-gray-900 dark:text-white shadow-sm":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white"),children:[s.charAt(0).toUpperCase()+s.slice(1)," (",getFilterCount(s),")"]},s))}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Sort by:"}),e.jsxs("select",{value:x,onChange:e=>m(e.target.value),className:"bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md px-3 py-2 text-sm text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"expiresAt",children:"Time Remaining"}),e.jsx("option",{value:"reward",children:"Reward Value"}),e.jsx("option",{value:"progress",children:"Progress"})]})]})]})}),l?e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6",children:[...Array(6)].map((s,t)=>e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 border border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"bg-gray-300 dark:bg-gray-600 h-6 w-3/4 rounded"}),e.jsx("div",{className:"bg-gray-300 dark:bg-gray-600 h-4 w-full rounded"}),e.jsx("div",{className:"bg-gray-300 dark:bg-gray-600 h-2 w-full rounded"}),e.jsx("div",{className:"bg-gray-300 dark:bg-gray-600 h-8 w-1/2 rounded"})]})},t))}):0===g.length?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸŽ¯"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-2",children:d?"Unable to Load Challenges":"No challenges found"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:d||("all"===c?"No challenges are currently available.":`No ${c} challenges found. Try a different filter.`)})]}):e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6",children:g.map(s=>{const t=getProgressPercentage(s),a=isExpired(s);return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 border transition-all duration-200 hover:shadow-lg "+(s.completedAt?"border-green-200 dark:border-green-800 bg-green-50 dark:bg-green-900/20":a?"border-red-200 dark:border-red-800 bg-red-50 dark:bg-red-900/20":"border-gray-200 dark:border-gray-700 hover:border-blue-300 dark:hover:border-blue-600"),children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-1",children:s.name}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:s.description})]}),e.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium ml-2 "+(s.completedAt?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":a?"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200":"daily"===s.type?"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200":"weekly"===s.type?"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200":"bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200"),children:s.completedAt?"Completed":a?"Expired":s.type})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between text-sm mb-2",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Progress"}),e.jsxs("span",{className:"font-medium text-gray-900 dark:text-white",children:[s.current," / ",s.target]})]}),e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:e.jsx("div",{className:"h-2 rounded-full transition-all duration-500 "+(s.completedAt?"bg-green-600":a?"bg-red-600":"bg-blue-600"),style:{width:`${t}%`}})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400 mb-2",children:"Rewards"}),e.jsxs("div",{className:"flex items-center space-x-4 text-sm",children:[e.jsxs("span",{className:"text-blue-600 dark:text-blue-400",children:["+",s.reward.xp," XP"]}),e.jsxs("span",{className:"text-yellow-600 dark:text-yellow-400",children:["+",s.reward.coins," coins"]}),s.reward.gems&&e.jsxs("span",{className:"text-purple-600 dark:text-purple-400",children:["+",s.reward.gems," gems"]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:a?"Expired":"Time remaining: "}),e.jsx("span",{className:"font-medium "+(a?"text-red-600 dark:text-red-400":"text-gray-900 dark:text-white"),children:a?"":getTimeRemaining(s)})]}),s.completedAt&&e.jsx("div",{className:"text-green-600 dark:text-green-400 text-2xl",children:"âœ…"})]})]},s.id)})}),e.jsxs("div",{className:"mt-12",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-6",children:"ðŸŒŸ Monthly Challenge"}),e.jsx(le,{challenge:{id:"monthly-2025-01",title:"January Learning Marathon",description:"Master new knowledge throughout January with progressive challenges",type:"monthly",requirements:[],rewards:[],startDate:"2025-01-01T00:00:00Z",endDate:"2025-01-31T23:59:59Z",isActive:!0,participantCount:47892,difficulty:"intermediate",storyArc:{id:"winter-learning-saga",title:"Winter Learning Saga",description:"Embark on a month-long journey of discovery",theme:"winter",chapters:[],totalWeeks:4,currentWeek:2}}})]}),e.jsxs("div",{className:"mt-12",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-6",children:"ðŸ† Community Leaderboard"}),e.jsx(ne,{challengeId:"monthly-2025-01",challengeName:"January Learning Marathon"})]}),e.jsxs("div",{className:"mt-12 bg-blue-50 dark:bg-blue-900/20 rounded-lg p-6 border border-blue-200 dark:border-blue-800",children:[e.jsx("h3",{className:"text-lg font-semibold text-blue-900 dark:text-blue-100 mb-3",children:"ðŸ’¡ How Challenges Work"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-blue-800 dark:text-blue-200",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"ðŸŽ¯ Challenge Types"}),e.jsxs("ul",{className:"space-y-1",children:[e.jsxs("li",{children:["â€¢ ",e.jsx("strong",{children:"Daily:"})," Reset every 24 hours"]}),e.jsxs("li",{children:["â€¢ ",e.jsx("strong",{children:"Weekly:"})," Reset every Monday"]}),e.jsxs("li",{children:["â€¢ ",e.jsx("strong",{children:"Monthly:"})," Reset on the 1st"]}),e.jsxs("li",{children:["â€¢ ",e.jsx("strong",{children:"Special:"})," Limited-time events"]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"ðŸ† Rewards"}),e.jsxs("ul",{className:"space-y-1",children:[e.jsxs("li",{children:["â€¢ ",e.jsx("strong",{children:"XP:"})," Experience points for leveling up"]}),e.jsxs("li",{children:["â€¢ ",e.jsx("strong",{children:"Coins:"})," In-app currency"]}),e.jsxs("li",{children:["â€¢ ",e.jsx("strong",{children:"Gems:"})," Premium currency"]}),e.jsxs("li",{children:["â€¢ ",e.jsx("strong",{children:"Achievements:"})," Unlock special badges"]})]})]})]})]})]})})},LeaderboardPage=()=>{const{user:s}=K(),[a,r]=t.useState(null),[l,n]=t.useState(!1),[d,i]=t.useState(null),[c,o]=t.useState(null),[x,m]=t.useState(0),[g,h]=t.useState(0),[u,b]=t.useState(null),[y,p]=t.useState("global"),[j,f]=t.useState(isOnlineLeaderboardEnabled()),[v,N]=t.useState(null);t.useEffect(()=>{let e=!1;const{isOnlineLinked:s}=K.getState(),run=async()=>{try{const t=await s("studymaster");e||N(t)}catch{e||N(!1)}};f(isOnlineLeaderboardEnabled()),K.getState().user?run():N(!1);const onStorage=e=>{"sm.onlineLeaderboardEnabled"===e.key&&f("true"===e.newValue)};return window.addEventListener("storage",onStorage),()=>{e=!0,window.removeEventListener("storage",onStorage)}},[]),t.useEffect(()=>{(async()=>{if(s&&j&&v){n(!0),i(null);try{const e={...s,token:s.token,tokenType:s.tokenType},t=J(),a=await t.fetchAll(e);r(a),o(Date.now())}catch(e){console.error("Failed to load leaderboard data:",e),i("Failed to load leaderboard data")}finally{n(!1)}}})()},[s,x,j,v]),t.useEffect(()=>{let e=!0;const toScopeKey=e=>"friends"===e?"friends:global":`${e}:global`;return(async()=>{try{const s=await _.leaderboardCache.get(toScopeKey(y),{ignoreTTL:!0});if(!e)return;if(!s)return void b(null);const t=Date.now()-s.fetchedAt,a=Math.max(0,Math.floor(t/1e3)),r=Math.max(0,Math.floor((s.ttlMs??0)/1e3));b({ageSec:a,ttlSec:r,expired:r>0&&a>r})}catch{if(!e)return;b(null)}})(),()=>{e=!1}},[y,x]),t.useEffect(()=>{let e,s=!0;const updateQueued=async()=>{try{const e=(await _.syncQueue.list(200)).filter(e=>"leaderboard:submit"===e.opType).length;s&&h(e)}catch{}};updateQueued(),e=window.setInterval(()=>{updateQueued()},1e4);const onOnline=()=>{updateQueued()};return window.addEventListener("online",onOnline),()=>{s=!1,e&&window.clearInterval(e),window.removeEventListener("online",onOnline)}},[]);const k=[{value:"global",label:"Global Rankings",icon:"ðŸŒ",description:"Compete with all users worldwide"},{value:"friends",label:"Friends",icon:"ðŸ‘¥",description:"Compare with your friends"},{value:"weekly",label:"This Week",icon:"ðŸ“…",description:"Weekly performance rankings"},{value:"monthly",label:"This Month",icon:"ðŸ“Š",description:"Monthly achievement rankings"}],w=(()=>a&&a[y]||[])(),getRankIcon=e=>{switch(e){case 1:return"ðŸ¥‡";case 2:return"ðŸ¥ˆ";case 3:return"ðŸ¥‰";default:return`#${e}`}},getRankColor=e=>{switch(e){case 1:return"text-yellow-600 dark:text-yellow-400";case 2:return"text-gray-600 dark:text-gray-400";case 3:return"text-orange-600 dark:text-orange-400";default:return"text-gray-700 dark:text-gray-300"}},getChangeIcon=e=>e>0?"ðŸ“ˆ":e<0?"ðŸ“‰":"âž–",getChangeColor=e=>e>0?"text-green-600 dark:text-green-400":e<0?"text-red-600 dark:text-red-400":"text-gray-500 dark:text-gray-400",formatScore=e=>e.toLocaleString()+" XP",S=w.find(e=>e.userId===s?.id);return j&&null===v?e.jsx("div",{className:"max-w-4xl mx-auto p-6",children:e.jsx("div",{className:"text-center text-gray-600 dark:text-gray-400",children:"Checking online account linkâ€¦"})}):j&&!1!==v?e.jsxs("div",{className:"max-w-4xl mx-auto p-6 space-y-8",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h1",{className:"text-4xl font-bold text-gray-900 dark:text-white mb-2",children:"ðŸ† Leaderboard"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Compete with other learners and climb the ranks!"})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 border border-gray-200 dark:border-gray-700",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Leaderboard Category"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:k.map(s=>e.jsxs("button",{onClick:()=>p(s.value),className:"p-4 rounded-lg border-2 transition-all duration-200 text-left "+(y===s.value?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-200 dark:border-gray-600 hover:border-gray-300 dark:hover:border-gray-500"),children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx("span",{className:"text-2xl",children:s.icon}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:s.label})]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:s.description})]},s.value))})]}),S&&e.jsxs("div",{className:"bg-gradient-to-r from-blue-500 to-purple-600 rounded-lg shadow-lg p-6 text-white",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Your Position"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"w-12 h-12 bg-white/20 rounded-full flex items-center justify-center text-2xl font-bold",children:S.username.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-lg",children:S.username}),e.jsx("div",{className:"text-blue-100",children:formatScore(S.score)})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-3xl font-bold",children:getRankIcon(S.rank)}),e.jsxs("div",{className:"text-sm text-blue-100 flex items-center space-x-1",children:[e.jsx("span",{children:getChangeIcon(S.change)}),e.jsx("span",{children:0===S.change?"No change":`${Math.abs(S.change)} ${S.change>0?"up":"down"}`})]})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 overflow-hidden",children:[e.jsx("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:k.find(e=>e.value===y)?.label}),e.jsxs("div",{className:"flex items-center space-x-3",children:[!l&&a&&e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:c?`Updated ${Math.max(1,Math.floor((Date.now()-c)/1e3))}s ago`:"â€”"}),u&&e.jsxs("div",{title:"Cache age and TTL",className:"text-xs px-2 py-1 rounded-full border "+(u.expired?"bg-red-100 text-red-800 dark:bg-red-900/40 dark:text-red-200 border-red-300 dark:border-red-800":"bg-emerald-100 text-emerald-800 dark:bg-emerald-900/40 dark:text-emerald-200 border-emerald-300 dark:border-emerald-800"),children:[u.ageSec??"â€”","s / TTL ",u.ttlSec??"â€”","s ",u.expired?"(expired)":""]}),g>0&&e.jsxs("div",{className:"text-xs px-2 py-1 rounded-full bg-amber-100 text-amber-800 dark:bg-amber-900/40 dark:text-amber-200 border border-amber-300 dark:border-amber-800",children:[g," queued"]}),e.jsx("button",{onClick:()=>m(e=>e+1),className:"text-sm px-3 py-1 rounded border border-gray-300 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-200",children:"Refresh"})]})]})}),l?e.jsx("div",{className:"p-8",children:e.jsx("div",{className:"space-y-4",children:[...Array(10)].map((s,t)=>e.jsxs("div",{className:"flex items-center justify-between p-4",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"animate-pulse bg-gray-300 dark:bg-gray-600 h-8 w-8 rounded"}),e.jsx("div",{className:"animate-pulse bg-gray-300 dark:bg-gray-600 h-10 w-10 rounded-full"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"animate-pulse bg-gray-300 dark:bg-gray-600 h-4 w-24 rounded"}),e.jsx("div",{className:"animate-pulse bg-gray-300 dark:bg-gray-600 h-3 w-16 rounded"})]})]}),e.jsx("div",{className:"animate-pulse bg-gray-300 dark:bg-gray-600 h-4 w-8 rounded"})]},t))})}):w.length>0?e.jsx("div",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:w.map(t=>e.jsx("div",{className:"p-4 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors "+(t.userId===s?.id?"bg-blue-50 dark:bg-blue-900/20":""),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:`text-2xl font-bold ${getRankColor(t.rank)} min-w-[3rem] text-center`,children:getRankIcon(t.rank)}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white font-bold",children:t.username.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-semibold text-gray-900 dark:text-white",children:[t.username,t.userId===s?.id&&e.jsx("span",{className:"ml-2 text-xs bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 px-2 py-1 rounded-full",children:"You"})]}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:formatScore(t.score)})]})]})]}),e.jsxs("div",{className:`text-sm font-medium ${getChangeColor(t.change)} flex items-center space-x-1`,children:[e.jsx("span",{className:"text-lg",children:getChangeIcon(t.change)}),e.jsx("span",{children:0===t.change?"â€”":`${Math.abs(t.change)}`})]})]})},t.userId))}):e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"text-4xl mb-4",children:"ðŸ“Š"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:d?"Unable to Load Data":"No Data Available"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:d||"Leaderboard data for this category is not available yet."})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 border border-gray-200 dark:border-gray-700",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"How Rankings Work"}),e.jsxs("div",{className:"space-y-3 text-sm text-gray-600 dark:text-gray-400",children:[e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx("span",{className:"text-blue-500 mt-1",children:"â€¢"}),e.jsx("span",{children:"Rankings update regularly based on your study activity"})]}),e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx("span",{className:"text-blue-500 mt-1",children:"â€¢"}),e.jsx("span",{children:"XP is earned through studying, accuracy bonuses, and streaks"})]}),e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx("span",{className:"text-blue-500 mt-1",children:"â€¢"}),e.jsx("span",{children:"Global rankings include all StudyMaster users"})]}),e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx("span",{className:"text-blue-500 mt-1",children:"â€¢"}),e.jsx("span",{children:"Weekly and monthly rankings reset at the start of each period"})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 border border-gray-200 dark:border-gray-700",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Climb the Ranks"}),e.jsxs("div",{className:"space-y-3 text-sm text-gray-600 dark:text-gray-400",children:[e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx("span",{className:"text-green-500 mt-1",children:"â€¢"}),e.jsx("span",{children:"Study consistently to maintain and improve your streak"})]}),e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx("span",{className:"text-green-500 mt-1",children:"â€¢"}),e.jsx("span",{children:"Focus on accuracy to maximize your XP gains"})]}),e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx("span",{className:"text-green-500 mt-1",children:"â€¢"}),e.jsx("span",{children:"Complete challenges for bonus XP and achievements"})]}),e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx("span",{className:"text-green-500 mt-1",children:"â€¢"}),e.jsx("span",{children:"Invite friends to compete in the friends leaderboard"})]})]})]})]})]}):e.jsxs("div",{className:"max-w-4xl mx-auto p-6 space-y-8",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h1",{className:"text-4xl font-bold text-gray-900 dark:text-white mb-2",children:"ðŸ† Leaderboard"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Compete with other learners and climb the ranks!"})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 border border-gray-200 dark:border-gray-700",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-3",children:"Online leaderboards are disabled"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:"Enable online features and link your account to participate in global rankings."}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("a",{href:"/profile",className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Go to Account Settings"}),e.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Status: ",j?"Online enabled":"Online disabled"," â€¢ ",v?"Linked":"Not linked"]})]}),e.jsx("div",{className:"mt-3 text-xs text-gray-500 dark:text-gray-400",children:"Note: Study data and media are stored locally. Nothing is uploaded unless you enable online features."})]})]})},GlobalStatsPage=()=>{const{globalStats:s,liveMetrics:t,isLoading:a,error:r,lastUpdated:l,refresh:n,formatNumber:d,formatTime:i,getTimeSinceUpdate:c}=de();return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-4xl font-bold text-gradient mb-4",children:"ðŸŒ Global Learning Statistics"}),e.jsx("p",{className:"text-xl text-gray-600 dark:text-gray-400 mb-4",children:"Real-time insights from the global learning community"}),e.jsxs("div",{className:"flex items-center justify-center gap-4 text-sm text-gray-500 dark:text-gray-400",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),e.jsx("span",{children:"Live data"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{children:["Last updated: ",l?c():"Loading..."]}),e.jsx("button",{onClick:n,className:"text-blue-600 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300 transition-colors",disabled:a,title:"Refresh all data",children:e.jsx("span",{className:a?"animate-spin":"",children:"ðŸ”„"})})]})]})]}),r&&e.jsx("div",{className:"card p-6 border-red-200 dark:border-red-800 bg-red-50 dark:bg-red-900/20",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"text-2xl",children:"âš ï¸"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-red-800 dark:text-red-200",children:"Connection Issue"}),e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:r})]})]}),e.jsx("button",{onClick:n,className:"btn btn-sm bg-red-600 hover:bg-red-700 text-white",children:"Retry"})]})}),s&&t&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"card p-6 text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-blue-600 mb-2",children:d(s.totalLearners)}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Total Learners"}),e.jsxs("div",{className:"text-xs text-green-600 dark:text-green-400 mt-1",children:["+",Math.floor(1e3*Math.random())," today"]})]}),e.jsxs("div",{className:"card p-6 text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-green-600 mb-2",children:d(s.cardsStudiedToday)}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Cards Studied Today"}),e.jsxs("div",{className:"text-xs text-blue-600 dark:text-blue-400 mt-1",children:[i(s.studyTimeToday)," total time"]})]}),e.jsxs("div",{className:"card p-6 text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-orange-600 mb-2",children:d(t.onlineUsers)}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Online Now"}),e.jsxs("div",{className:"text-xs text-purple-600 dark:text-purple-400 mt-1",children:[d(t.studyingSessions)," studying"]})]}),e.jsxs("div",{className:"card p-6 text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-purple-600 mb-2",children:s.languagesBeingLearned}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Languages"}),e.jsxs("div",{className:"text-xs text-orange-600 dark:text-orange-400 mt-1",children:[t.averageAccuracy.toFixed(1),"% avg accuracy"]})]})]}),s&&e.jsxs("div",{className:"card p-6",children:[e.jsxs("h2",{className:"text-2xl font-bold mb-4 flex items-center gap-2",children:["ðŸ† Most Popular Subjects Worldwide",e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:s.topSubjects.map((s,t)=>e.jsxs("div",{className:"text-center p-4 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[e.jsxs("div",{className:"text-2xl font-bold text-gray-800 dark:text-gray-200 mb-1",children:["#",t+1]}),e.jsx("div",{className:"font-semibold text-lg mb-2",children:s.name}),e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:[d(s.learners)," learners"]}),e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-600 rounded-full h-2 mt-2",children:e.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-purple-600 h-2 rounded-full transition-all duration-300",style:{width:`${Math.max(20,100-15*t)}%`}})})]},s.name))})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx(ie,{title:"Live Activity Monitor",icon:"ðŸ“Š",className:"lg:col-span-1",showRefreshButton:!0}),t&&e.jsxs("div",{className:"card p-6 lg:col-span-2",children:[e.jsxs("h2",{className:"text-2xl font-bold mb-4 flex items-center gap-2",children:["ðŸŒŸ Top Performers Today",e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:t.topPerformers.map((s,t)=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center text-white font-bold "+(0===t?"bg-gradient-to-r from-yellow-400 to-orange-500":1===t?"bg-gradient-to-r from-gray-400 to-gray-600":2===t?"bg-gradient-to-r from-orange-400 to-red-500":"bg-gradient-to-r from-blue-400 to-purple-500"),children:t+1}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:s.username}),e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400 flex items-center gap-1",children:["ðŸŒ ",s.country]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"font-bold text-blue-600 dark:text-blue-400",children:d(s.score)}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:"XP"})]})]},s.username))})]})]}),e.jsx(ce,{maxItems:8,showGrowth:!0}),e.jsx(oe,{maxSkills:8,maxIndustries:6,showCertifications:!0}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"card p-6",children:[e.jsx("h3",{className:"text-xl font-semibold mb-4 flex items-center gap-2",children:"ðŸ“ˆ Learning Velocity"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{children:"Cards per minute (global)"}),e.jsx("span",{className:"font-bold text-blue-600",children:s?Math.floor(s.cardsStudiedToday/(s.studyTimeToday||1)).toLocaleString():"0"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{children:"Peak learning hour"}),e.jsx("span",{className:"font-bold text-green-600",children:"7-9 PM UTC"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{children:"Most active timezone"}),e.jsx("span",{className:"font-bold text-purple-600",children:"UTC+8 (Asia)"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{children:"Weekend vs Weekday"}),e.jsx("span",{className:"font-bold text-orange-600",children:"+23% weekdays"})]})]})]}),e.jsxs("div",{className:"card p-6",children:[e.jsx("h3",{className:"text-xl font-semibold mb-4 flex items-center gap-2",children:"ðŸŽ¯ Learning Effectiveness"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{children:"Global retention rate"}),e.jsxs("span",{className:"font-bold text-green-600",children:[t?t.averageAccuracy.toFixed(1):"0","%"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{children:"Optimal session length"}),e.jsx("span",{className:"font-bold text-blue-600",children:"25 minutes"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{children:"Spaced repetition usage"}),e.jsx("span",{className:"font-bold text-purple-600",children:"78% of users"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{children:"Mobile vs Desktop"}),e.jsx("span",{className:"font-bold text-orange-600",children:"65% mobile"})]})]})]})]}),e.jsxs("div",{className:"card p-6 bg-gradient-to-r from-blue-50 to-purple-50 dark:from-blue-900/20 dark:to-purple-900/20 border border-blue-200 dark:border-blue-800",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("h2",{className:"text-2xl font-bold text-blue-800 dark:text-blue-200 flex items-center gap-2",children:["ðŸŒ Global Learning Community",e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:s?d(s.totalLearners):"2.8M+"}),e.jsx("div",{className:"text-sm text-blue-700 dark:text-blue-300",children:"Global Learners"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:s?d(s.cardsStudiedToday):"15M+"}),e.jsx("div",{className:"text-sm text-green-700 dark:text-green-300",children:"Cards Studied Today"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600 dark:text-purple-400",children:t?d(t.studyingSessions):"23K+"}),e.jsx("div",{className:"text-sm text-purple-700 dark:text-purple-300",children:"Active Sessions"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600 dark:text-orange-400",children:s?s.languagesBeingLearned:"127"}),e.jsx("div",{className:"text-sm text-orange-700 dark:text-orange-300",children:"Languages"})]})]})]}),e.jsxs("div",{className:"card p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsx("h2",{className:"text-2xl font-bold mb-0",children:"ðŸ’¼ Skills in Demand"})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-6 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg text-center",children:[e.jsx("div",{className:"text-lg font-bold text-red-600 dark:text-red-400",children:"ðŸš€ AI/ML"}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"+156% growth"})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg text-center",children:[e.jsx("div",{className:"text-lg font-bold text-blue-600 dark:text-blue-400",children:"â˜ï¸ Cloud"}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"+134% growth"})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg text-center",children:[e.jsx("div",{className:"text-lg font-bold text-green-600 dark:text-green-400",children:"ðŸ”’ Security"}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"+129% growth"})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg text-center",children:[e.jsx("div",{className:"text-lg font-bold text-purple-600 dark:text-purple-400",children:"ðŸ“Š Data Science"}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"+118% growth"})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg text-center",children:[e.jsx("div",{className:"text-lg font-bold text-indigo-600 dark:text-indigo-400",children:"ðŸŒ DevOps"}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"+112% growth"})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg text-center",children:[e.jsx("div",{className:"text-lg font-bold text-pink-600 dark:text-pink-400",children:"ðŸŽ¨ UX/UI"}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"+98% growth"})]})]})]}),e.jsxs("div",{className:"card p-6 bg-gradient-to-r from-gray-50 to-blue-50 dark:from-gray-800 dark:to-blue-900/20 border border-gray-200 dark:border-gray-700",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3 text-gray-800 dark:text-gray-200 flex items-center gap-2",children:"ðŸ“¡ Data Sources & Methodology"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 text-sm text-gray-600 dark:text-gray-400",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-gray-800 dark:text-gray-200 mb-1",children:"Learning Platforms"}),e.jsx("div",{children:"â€¢ Educational APIs"}),e.jsx("div",{children:"â€¢ Learning Management Systems"}),e.jsx("div",{children:"â€¢ Online Course Providers"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-gray-800 dark:text-gray-200 mb-1",children:"Market Data"}),e.jsx("div",{children:"â€¢ Job Market APIs"}),e.jsx("div",{children:"â€¢ Skills Demand Analytics"}),e.jsx("div",{children:"â€¢ Industry Reports"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-gray-800 dark:text-gray-200 mb-1",children:"Real-time Metrics"}),e.jsx("div",{children:"â€¢ User Activity Streams"}),e.jsx("div",{children:"â€¢ Performance Analytics"}),e.jsx("div",{children:"â€¢ Engagement Tracking"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-gray-800 dark:text-gray-200 mb-1",children:"Update Frequency"}),e.jsx("div",{children:"â€¢ Live metrics: 10s"}),e.jsx("div",{children:"â€¢ Global stats: 30s"}),e.jsx("div",{children:"â€¢ Market data: 5m"})]})]})]})]})},AnalyticsDashboard=({userId:s,timeRange:a})=>{const[r,l]=t.useState([]),[n,d]=t.useState([]),[i,c]=t.useState([]),[o,x]=t.useState([]),[m,g]=t.useState(null),[h,u]=t.useState(!0),[b,y]=t.useState("momentum");t.useEffect(()=>{loadAnalyticsData()},[s,a]);const loadAnalyticsData=async()=>{u(!0);try{l(generateSampleDSRData()),d(generateSampleSessionData()),c(generateSampleLearningPatterns()),x(generateSampleEnvironmentalData()),g(generateSamplePersonalizationData())}catch(e){console.error("Failed to load analytics data:",e)}finally{u(!1)}},p=t.useMemo(()=>{if(!n.length)return null;return{avgMomentum:n.reduce((e,s)=>e+s.momentum,0)/n.length,avgAccuracy:n.reduce((e,s)=>e+s.accuracy,0)/n.length,totalCardsReviewed:n.reduce((e,s)=>e+s.cardsPerSession,0),avgFlowTime:n.reduce((e,s)=>e+s.flowTime,0)/n.length,improvementTrend:n.length>1?n[n.length-1].momentum-n[0].momentum>0?"improving":"declining":"stable"}},[n]);return h?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading advanced analytics..."})]})}):e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white shadow-sm border-b",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"UAMS v3.0 Analytics"}),e.jsx("p",{className:"mt-1 text-sm text-gray-600",children:"Advanced Learning Intelligence Dashboard"})]}),e.jsx("div",{className:"flex space-x-4",children:e.jsxs("select",{value:a,onChange:e=>{},className:"px-4 py-2 border border-gray-300 rounded-md bg-white",children:[e.jsx("option",{value:"7d",children:"Last 7 days"}),e.jsx("option",{value:"30d",children:"Last 30 days"}),e.jsx("option",{value:"90d",children:"Last 90 days"}),e.jsx("option",{value:"1y",children:"Last year"})]})})]})})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[p&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[e.jsx(InsightCard,{title:"Average Momentum",value:`${(100*p.avgMomentum).toFixed(1)}%`,trend:p.improvementTrend,color:"blue"}),e.jsx(InsightCard,{title:"Accuracy Rate",value:`${(100*p.avgAccuracy).toFixed(1)}%`,trend:"stable",color:"green"}),e.jsx(InsightCard,{title:"Cards Reviewed",value:p.totalCardsReviewed.toString(),trend:"stable",color:"purple"}),e.jsx(InsightCard,{title:"Avg Flow Time",value:`${p.avgFlowTime.toFixed(0)}min`,trend:"stable",color:"orange"})]}),e.jsxs("section",{className:"mb-12",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-6",children:"Memory Metrics (DSR)"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-8",children:[e.jsx(DSRTrendsChart,{data:r}),e.jsx(StabilityDistribution,{data:r}),e.jsx(RetrievabilityPrediction,{data:r})]})]}),e.jsxs("section",{className:"mb-12",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-6",children:"Session Performance"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8",children:[e.jsx(MomentumTrendsChart,{data:n}),e.jsx(FlowStateAnalysis,{data:n})]}),e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-8",children:[e.jsx(CognitiveLoadPatterns,{data:n}),e.jsx(SessionQualityMatrix,{data:n})]})]}),e.jsxs("section",{className:"mb-12",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-6",children:"Personal Learning Patterns"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-8",children:[e.jsx(OptimalStudyTimes,{data:i}),e.jsx(EnvironmentalPreferences,{data:o}),e.jsx(PersonalizedInsights,{data:m})]})]}),e.jsxs("section",{className:"mb-12",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-6",children:"AI-Powered Insights"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsx(LearningRecommendations,{insights:p,patterns:i}),e.jsx(ParameterOptimizationStatus,{data:m})]})]})]})]})},InsightCard=({title:s,value:t,trend:a,color:r})=>{const l={blue:"bg-blue-50 text-blue-600 border-blue-200",green:"bg-green-50 text-green-600 border-green-200",purple:"bg-purple-50 text-purple-600 border-purple-200",orange:"bg-orange-50 text-orange-600 border-orange-200"},n={improving:"ðŸ“ˆ",declining:"ðŸ“‰",stable:"âž¡ï¸"};return e.jsxs("div",{className:`${l[r]} p-6 rounded-lg border`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-medium",children:s}),e.jsx("span",{className:"text-lg",children:n[a]})]}),e.jsx("div",{className:"mt-2",children:e.jsx("div",{className:"text-2xl font-bold",children:t})})]})},DSRTrendsChart=({data:s})=>e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"DSR Trends Over Time"}),e.jsx(m,{width:"100%",height:300,children:e.jsxs(g,{data:s,children:[e.jsx(h,{strokeDasharray:"3 3"}),e.jsx(u,{dataKey:"date"}),e.jsx(b,{domain:[0,10]}),e.jsx(y,{}),e.jsx(p,{}),e.jsx(j,{type:"monotone",dataKey:"averageDifficulty",stroke:"#8884d8",name:"Difficulty",strokeWidth:2}),e.jsx(j,{type:"monotone",dataKey:"averageStability",stroke:"#82ca9d",name:"Stability",strokeWidth:2}),e.jsx(j,{type:"monotone",dataKey:"averageRetrievability",stroke:"#ffc658",name:"Retrievability",strokeWidth:2})]})})]}),StabilityDistribution=({data:s})=>{const t=[{range:"0-1 days",count:12,fill:"#ff6b6b"},{range:"1-7 days",count:28,fill:"#4ecdc4"},{range:"7-30 days",count:45,fill:"#45b7d1"},{range:"30+ days",count:23,fill:"#96ceb4"}];return e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Memory Stability Distribution"}),e.jsx(m,{width:"100%",height:300,children:e.jsxs(f,{children:[e.jsx(v,{data:t,cx:"50%",cy:"50%",outerRadius:80,dataKey:"count",label:({range:e,percent:s})=>`${e}: ${(100*s).toFixed(0)}%`,children:t.map((s,t)=>e.jsx(N,{fill:s.fill},`cell-${t}`))}),e.jsx(y,{})]})})]})},RetrievabilityPrediction=({data:s})=>e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Retrievability Forecast"}),e.jsx(m,{width:"100%",height:300,children:e.jsxs(k,{data:s,children:[e.jsx(h,{strokeDasharray:"3 3"}),e.jsx(u,{dataKey:"date"}),e.jsx(b,{domain:[0,1]}),e.jsx(y,{formatter:e=>`${(100*Number(e)).toFixed(1)}%`}),e.jsx(w,{type:"monotone",dataKey:"averageRetrievability",stroke:"#8884d8",fill:"#8884d8",fillOpacity:.3})]})})]}),MomentumTrendsChart=({data:s})=>e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Momentum & Flow Trends"}),e.jsx(m,{width:"100%",height:350,children:e.jsxs(g,{data:s,children:[e.jsx(h,{strokeDasharray:"3 3"}),e.jsx(u,{dataKey:"date"}),e.jsx(b,{domain:[0,1]}),e.jsx(y,{formatter:e=>`${(100*Number(e)).toFixed(1)}%`}),e.jsx(p,{}),e.jsx(j,{type:"monotone",dataKey:"momentum",stroke:"#8884d8",name:"Session Momentum",strokeWidth:2}),e.jsx(j,{type:"monotone",dataKey:"satisfaction",stroke:"#82ca9d",name:"Satisfaction",strokeWidth:2})]})})]}),FlowStateAnalysis=({data:s})=>e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Flow State Analysis"}),e.jsx(m,{width:"100%",height:350,children:e.jsxs(S,{data:s,children:[e.jsx(h,{strokeDasharray:"3 3"}),e.jsx(u,{dataKey:"cognitiveLoad",name:"Cognitive Load"}),e.jsx(b,{dataKey:"momentum",name:"Momentum"}),e.jsx(y,{cursor:{strokeDasharray:"3 3"}}),e.jsx(C,{dataKey:"flowTime",fill:"#8884d8",name:"Flow Time (size indicates duration)"})]})})]}),CognitiveLoadPatterns=({data:s})=>e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Cognitive Load vs Fatigue"}),e.jsx(m,{width:"100%",height:300,children:e.jsxs(A,{data:s,children:[e.jsx(h,{strokeDasharray:"3 3"}),e.jsx(u,{dataKey:"date"}),e.jsx(b,{domain:[0,1]}),e.jsx(y,{formatter:e=>`${(100*Number(e)).toFixed(1)}%`}),e.jsx(M,{dataKey:"cognitiveLoad",fill:"#8884d8",name:"Cognitive Load"}),e.jsx(M,{dataKey:"fatigue",fill:"#82ca9d",name:"Fatigue"})]})})]}),SessionQualityMatrix=({data:s})=>{const t=[{subject:"Momentum",value:.8,fullMark:1},{subject:"Flow Time",value:.7,fullMark:1},{subject:"Accuracy",value:.9,fullMark:1},{subject:"Satisfaction",value:.85,fullMark:1},{subject:"Efficiency",value:.75,fullMark:1}];return e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Session Quality Matrix"}),e.jsx(m,{width:"100%",height:300,children:e.jsxs(D,{data:t,children:[e.jsx(L,{}),e.jsx(T,{dataKey:"subject"}),e.jsx(E,{domain:[0,1]}),e.jsx(I,{name:"Performance",dataKey:"value",stroke:"#8884d8",fill:"#8884d8",fillOpacity:.3})]})})]})},OptimalStudyTimes=({data:s})=>e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Optimal Study Times"}),e.jsx(m,{width:"100%",height:300,children:e.jsxs(A,{data:s,children:[e.jsx(h,{strokeDasharray:"3 3"}),e.jsx(u,{dataKey:"timeOfDay"}),e.jsx(b,{}),e.jsx(y,{}),e.jsx(M,{dataKey:"performance",fill:"#8884d8",name:"Performance Score"})]})})]}),EnvironmentalPreferences=({data:s})=>e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Environmental Performance"}),e.jsx("div",{className:"space-y-4",children:s.map((s,t)=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:s.condition}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-24 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-500 h-2 rounded-full",style:{width:100*s.averagePerformance+"%"}})}),e.jsxs("span",{className:"text-sm text-gray-600",children:[(100*s.averagePerformance).toFixed(0),"%"]})]})]},t))})]}),PersonalizedInsights=({data:s})=>s?e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"AI Personalization Profile"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Optimal Difficulty"}),e.jsxs("span",{className:"font-medium",children:[s.optimalDifficulty.toFixed(1),"/10"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Optimal Session Length"}),e.jsxs("span",{className:"font-medium",children:[s.optimalSessionLength,"min"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Cognitive Capacity"}),e.jsxs("span",{className:"font-medium",children:[(100*s.cognitiveLoadProfile.baseCapacity).toFixed(0),"%"]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("span",{className:"text-sm text-gray-600 block mb-2",children:"Best Study Times"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:s.bestPerformanceTimes.map((s,t)=>e.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 rounded text-xs",children:s},t))})]})]})]}):null,LearningRecommendations=({insights:s,patterns:t})=>{const a=["Your momentum peaks around 2-4 PM. Schedule challenging reviews during this window.","Consider shorter sessions (20-25 min) to maintain optimal cognitive load.","Desktop sessions show 15% better performance than mobile - use for difficult cards.","Quiet environments improve your accuracy by 12%. Find a distraction-free space.","Your FSRS parameters are 85% optimized. Continue current study pattern for best results."];return e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"AI Recommendations"}),e.jsx("div",{className:"space-y-3",children:a.map((s,t)=>e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("span",{className:"flex-shrink-0 w-6 h-6 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-sm font-medium",children:t+1}),e.jsx("p",{className:"text-sm text-gray-700",children:s})]},t))})]})},ParameterOptimizationStatus=({data:s})=>s?e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"FSRS Parameter Optimization"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Optimization Progress"}),e.jsx("span",{className:"font-medium text-green-600",children:"87% Complete"})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-green-500 h-2 rounded-full",style:{width:"87%"}})}),e.jsxs("div",{className:"text-xs text-gray-500 space-y-1",children:[e.jsx("div",{children:"â€¢ Parameters updated based on 1,247 reviews"}),e.jsx("div",{children:"â€¢ Accuracy improved by 12% since last optimization"}),e.jsx("div",{children:"â€¢ Next optimization: 150 more reviews needed"})]})]})]}):null,generateSampleDSRData=()=>Array.from({length:30},(e,s)=>({date:new Date(Date.now()-24*(29-s)*60*60*1e3).toLocaleDateString(),averageDifficulty:4.5+1.5*Math.sin(s/5),averageStability:8+3*Math.cos(s/7),averageRetrievability:.7+.2*Math.sin(s/3),cardsReviewed:15+Math.floor(20*Math.random())})),generateSampleSessionData=()=>Array.from({length:30},(e,s)=>({date:new Date(Date.now()-24*(29-s)*60*60*1e3).toLocaleDateString(),momentum:.6+.3*Math.sin(s/4),fatigue:.3+.4*Math.random(),flowTime:15+20*Math.random(),cognitiveLoad:.5+.3*Math.random(),satisfaction:.7+.2*Math.sin(s/6),cardsPerSession:20+Math.floor(15*Math.random()),accuracy:.75+.2*Math.random()})),generateSampleLearningPatterns=()=>Array.from({length:24},(e,s)=>s).map(e=>({timeOfDay:`${e}:00`,performance:.3+.35*(Math.sin((e-6)*Math.PI/12)+1),confidence:.5+.3*Math.random(),responseTime:3e3+4e3*Math.random(),sessions:Math.floor(10*Math.random())})),generateSampleEnvironmentalData=()=>[{condition:"Desktop + Quiet",averagePerformance:.89,sessionCount:45,preferenceScore:.9},{condition:"Desktop + Moderate Noise",averagePerformance:.82,sessionCount:32,preferenceScore:.7},{condition:"Mobile + Quiet",averagePerformance:.76,sessionCount:28,preferenceScore:.6},{condition:"Mobile + Noisy",averagePerformance:.68,sessionCount:15,preferenceScore:.4},{condition:"Tablet + Optimal Light",averagePerformance:.84,sessionCount:20,preferenceScore:.8}],generateSamplePersonalizationData=()=>({optimalDifficulty:6.2,optimalSessionLength:25,bestPerformanceTimes:["9:00-11:00","14:00-16:00"],cognitiveLoadProfile:{baseCapacity:.85,fatigueRate:.02,recoveryRate:.05},fsrsParameters:Array.from({length:21},()=>5*Math.random())}),ue={again:{label:"Again",color:"bg-red-500",description:"I need to review this again"},hard:{label:"Hard",color:"bg-orange-500",description:"It was difficult but I got it"},good:{label:"Good",color:"bg-green-500",description:"Good, normal effort"},easy:{label:"Easy",color:"bg-blue-500",description:"Easy, no effort required"}},EnhancedReviewPage=({deckId:s,userId:a})=>{const[r,l]=t.useState(null),[n,d]=t.useState(null),[i,c]=t.useState(0),[o,x]=t.useState({cardsReviewed:0,accuracy:0,averageResponseTime:0,sessionDuration:0}),[m,g]=t.useState(!1),[h,u]=t.useState(!1),[b,y]=t.useState(!0),[p,j]=t.useState(null),[f,v]=t.useState(!0),[N,k]=t.useState(!1),[w,S]=t.useState(null),[C,A]=t.useState(null),M=t.useRef(new Z),D=t.useRef(new ee),L=t.useRef(),T=M.current,E=D.current;t.useEffect(()=>((async()=>{try{y(!0),console.log("Initializing UAMS v3.0 session...");const e=await T.initializeSession(a,s);l(e);const t=await T.getNextCard(e);d(t),c(Date.now()),await startEnvironmentalMonitoring(),console.log("Session initialized successfully")}catch(e){console.error("Failed to initialize session:",e),j(e instanceof Error?e.message:"Failed to initialize session")}finally{y(!1)}})(),()=>{L.current&&clearInterval(L.current)}),[a,s]);const startEnvironmentalMonitoring=async()=>{try{const e=await E.getCurrentContext(),s=E.getEnvironmentalAdaptations(e);A(s),L.current=setInterval(async()=>{await E.trackContextChanges()},3e4),E.onContextChange=(e,s)=>{console.log("Environmental context changed:",{current:e,previous:s});const t=E.getEnvironmentalAdaptations(e);A(t)}}catch(e){console.warn("Environmental monitoring setup failed:",e)}},I=t.useCallback(async e=>{if(r&&n)try{const s=Date.now()-i,t=await E.getCurrentContext(),a={timestamp:(new Date).toISOString(),rating:e,responseTime:s,contextualFactors:{sessionTime:Date.now()-new Date(r.sessionStartTime).getTime(),timeOfDay:(new Date).toISOString(),sessionFatigueIndex:r.sessionFatigueIndex,cognitiveLoadAtTime:r.cognitiveLoadCapacity,environmentalFactors:t},momentumImpact:calculateMomentumImpact(e,r),confidenceChange:calculateConfidenceChange(e,n.card),previousCardSimilarity:0,clusteringContext:"general"};console.log("Processing response:",{rating:e,responseTime:s,cardId:n.card.id});const o=await T.processCardResponse(r,n.card.id,a);l(o),updateSessionMetrics(e,s);const x=await T.getNextCard(o);d(x),c(Date.now()),u(!1)}catch(s){console.error("Error processing response:",s),j("Failed to process your response. Please try again.")}},[r,n,i]),updateSessionMetrics=(e,s)=>{x(t=>{const a="again"!==e,l=t.cardsReviewed+1;return{cardsReviewed:l,accuracy:(a?t.accuracy*t.cardsReviewed+1:t.accuracy*t.cardsReviewed)/l,averageResponseTime:(t.averageResponseTime*t.cardsReviewed+s)/l,sessionDuration:r?Date.now()-new Date(r.sessionStartTime).getTime():0}})},handleShowAnswer=()=>{u(!0)};return t.useEffect(()=>{const handleKeyPress=e=>{if(h)switch(e.key){case"1":e.preventDefault(),I("again");break;case"2":e.preventDefault(),I("hard");break;case"3":e.preventDefault(),I("good");break;case"4":e.preventDefault(),I("easy")}else"Space"!==e.code&&"Enter"!==e.code||(e.preventDefault(),handleShowAnswer())};return window.addEventListener("keydown",handleKeyPress),()=>window.removeEventListener("keydown",handleKeyPress)},[h,I]),b?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Initializing UAMS v3.0 session..."})]})}):p?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-red-50 to-red-100 flex items-center justify-center",children:e.jsxs("div",{className:"text-center p-8 bg-white rounded-lg shadow-lg max-w-md",children:[e.jsx("div",{className:"text-red-500 text-5xl mb-4",children:"âš ï¸"}),e.jsx("h2",{className:"text-xl font-semibold text-red-700 mb-2",children:"Session Error"}),e.jsx("p",{className:"text-red-600 mb-4",children:p}),e.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700",children:"Retry"})]})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100",children:[f&&e.jsx(SessionMetricsHeader,{sessionState:r,sessionMetrics:o,environmentalAdaptations:C,onToggleCognitiveDetail:()=>k(!N)}),N&&w&&e.jsx(CognitiveLoadDetailPanel,{analysis:w}),e.jsxs("div",{className:"container mx-auto px-4 py-8 max-w-4xl",children:[e.jsx("div",{className:"bg-white rounded-xl shadow-lg p-8 mb-6",children:n&&e.jsx(CardDisplay,{card:n.card,showAnswer:h,onShowAnswer:handleShowAnswer})}),h&&n&&e.jsx(ResponseButtons,{onResponse:I,disabled:!h}),m&&n&&e.jsx(ExplanationPanel,{explanation:n.explanation,reasoning:n.reasoning,confidence:n.confidence,sessionState:r}),e.jsx(FlowStateIndicator,{sessionState:r}),e.jsx(SessionControls,{sessionState:r,showMetricsPanel:f,showExplanation:m,onToggleMetrics:()=>v(!f),onToggleExplanation:()=>g(!m),onEndSession:()=>{}})]})]})},SessionMetricsHeader=({sessionState:s,sessionMetrics:t,environmentalAdaptations:a,onToggleCognitiveDetail:r})=>{if(!s)return null;const formatDuration=e=>`${Math.floor(e/6e4)}:${Math.floor(e%6e4/1e3).toString().padStart(2,"0")}`;return e.jsx("div",{className:"bg-white border-b border-gray-200 px-6 py-4",children:e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-500 rounded-full"}),e.jsx("span",{className:"font-medium",children:"Momentum"}),e.jsx("div",{className:"flex-1 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-500 h-2 rounded-full transition-all duration-300",style:{width:100*s.sessionMomentumScore+"%"}})}),e.jsxs("span",{className:"text-xs font-mono",children:[(100*s.sessionMomentumScore).toFixed(0),"%"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full"}),e.jsx("span",{className:"font-medium",children:"Energy"}),e.jsx("div",{className:"flex-1 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-green-500 h-2 rounded-full transition-all duration-300",style:{width:100*(1-s.sessionFatigueIndex)+"%"}})}),e.jsxs("span",{className:"text-xs font-mono",children:[(100*(1-s.sessionFatigueIndex)).toFixed(0),"%"]})]}),e.jsxs("button",{onClick:r,className:"flex items-center space-x-2 hover:bg-gray-50 rounded px-2 py-1",children:[e.jsx("div",{className:"w-3 h-3 bg-purple-500 rounded-full"}),e.jsx("span",{className:"font-medium",children:"Cognitive"}),e.jsx("div",{className:"flex-1 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-purple-500 h-2 rounded-full transition-all duration-300",style:{width:100*s.cognitiveLoadCapacity+"%"}})}),e.jsxs("span",{className:"text-xs font-mono",children:[(100*s.cognitiveLoadCapacity).toFixed(0),"%"]})]}),e.jsxs("div",{className:"flex items-center space-x-4 text-xs",children:[e.jsxs("span",{children:[e.jsx("strong",{children:t.cardsReviewed})," cards"]}),e.jsxs("span",{children:[e.jsxs("strong",{children:[(100*t.accuracy).toFixed(0),"%"]})," accuracy"]})]}),e.jsxs("div",{className:"flex items-center space-x-2 text-xs",children:[e.jsx("span",{className:"font-medium",children:"Duration:"}),e.jsx("span",{className:"font-mono",children:formatDuration(t.sessionDuration)})]})]}),e.jsxs("div",{className:"mt-3 flex items-center justify-between",children:[e.jsx(FlowStateIndicator,{sessionState:s}),a&&e.jsx(EnvironmentalIndicator,{adaptations:a})]})]})})},CardDisplay=({card:s,showAnswer:t,onShowAnswer:a})=>e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mb-8",children:e.jsx("div",{className:"prose prose-lg mx-auto",children:e.jsx("div",{dangerouslySetInnerHTML:{__html:s.frontContent}})})}),t?e.jsx("div",{className:"border-t pt-8",children:e.jsx("div",{className:"prose prose-lg mx-auto",children:e.jsx("div",{dangerouslySetInnerHTML:{__html:s.backContent}})})}):e.jsx("button",{onClick:a,className:"px-8 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors text-lg font-medium",children:"Show Answer"}),e.jsxs("div",{className:"mt-4 text-sm text-gray-500 space-x-4",children:[e.jsxs("span",{children:["Difficulty: ",s.difficulty?.toFixed(1)||"N/A"]}),e.jsx("span",{children:"â€¢"}),e.jsxs("span",{children:["Success Rate: ",(100*(s.retrievability||.5)).toFixed(0),"%"]}),e.jsx("span",{children:"â€¢"}),e.jsxs("span",{children:["Confidence: ",s.confidenceLevel||"Unknown"]})]})]}),ResponseButtons=({onResponse:s,disabled:t})=>e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:Object.entries(ue).map(([a,r])=>e.jsxs("button",{onClick:()=>s(a),disabled:t,className:`\n            p-4 rounded-lg text-white font-medium transition-all duration-200\n            ${r.color} hover:scale-105 hover:shadow-lg\n            disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100\n          `,children:[e.jsx("div",{className:"text-lg mb-1",children:r.label}),e.jsx("div",{className:"text-xs opacity-90",children:r.description}),e.jsxs("div",{className:"text-xs mt-2 opacity-75",children:["Press ",Object.keys(ue).indexOf(a)+1]})]},a))}),FlowStateIndicator=({sessionState:s})=>{if(!s)return null;const{challengeSkillBalance:t,engagementLevel:a,momentumMaintenance:r}=s.flowStateMetrics,l=(e=>e<.3?{zone:"Bored",color:"text-yellow-600"}:e>.7?{zone:"Anxious",color:"text-red-600"}:{zone:"Flow Zone",color:"text-green-600"})(t);return e.jsxs("div",{className:"flex items-center space-x-4 text-sm",children:[e.jsx("div",{className:`font-medium ${l.color}`,children:l.zone}),e.jsxs("div",{className:"text-gray-600",children:["Engagement: ",(100*a).toFixed(0),"%"]}),r&&e.jsx("div",{className:"text-green-600",children:"âœ“ Optimal Learning"})]})},EnvironmentalIndicator=({adaptations:s})=>s?e.jsxs("div",{className:"flex items-center space-x-2 text-xs text-gray-600",children:[0!==s.difficultyAdjustment&&e.jsxs("span",{className:"px-2 py-1 rounded "+(s.difficultyAdjustment>0?"bg-orange-100 text-orange-700":"bg-blue-100 text-blue-700"),children:["Difficulty ",s.difficultyAdjustment>0?"+":"",s.difficultyAdjustment.toFixed(1)]}),"auto"!==s.visualOptimizations.colorScheme&&e.jsxs("span",{className:"px-2 py-1 bg-gray-100 text-gray-700 rounded",children:[s.visualOptimizations.colorScheme," mode"]})]}):null,ExplanationPanel=({explanation:s,reasoning:t,confidence:a,sessionState:r})=>e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-6 mb-6",children:[e.jsx("h4",{className:"text-lg font-semibold text-blue-900 mb-3",children:"Why this card?"}),e.jsx("p",{className:"text-blue-800 mb-4",children:s}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex space-x-4",children:[e.jsx("span",{className:"px-3 py-1 bg-blue-200 text-blue-800 rounded-full",children:t.replace("_"," ")}),e.jsxs("span",{className:"text-blue-700",children:["Confidence: ",(100*a).toFixed(0),"%"]})]}),r&&e.jsxs("div",{className:"text-blue-600 text-xs",children:["Queue: ",r.lookaheadBuffer.length," cards ahead"]})]})]}),CognitiveLoadDetailPanel=({analysis:s})=>e.jsx("div",{className:"bg-purple-50 border-b border-purple-200 px-6 py-4",children:e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsx("h3",{className:"text-lg font-semibold text-purple-900 mb-3",children:"Cognitive Load Analysis"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 text-sm",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-purple-800 mb-2",children:"Current Status"}),e.jsxs("div",{className:"space-y-1 text-purple-700",children:[e.jsxs("div",{children:["Load: ",(100*s.currentLoad).toFixed(0),"%"]}),e.jsxs("div",{children:["Capacity: ",(100*s.capacity).toFixed(0),"%"]}),e.jsxs("div",{children:["Utilization: ",(100*s.utilizationRate).toFixed(0),"%"]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-purple-800 mb-2",children:"Predictions"}),e.jsxs("div",{className:"space-y-1 text-purple-700",children:[e.jsxs("div",{children:["Attention Remaining: ",s.attentionRemainingMinutes.toFixed(0),"min"]}),e.jsxs("div",{children:["Sustainability: ",(100*s.sustainabilityScore).toFixed(0),"%"]}),e.jsxs("div",{className:"font-medium "+("red"===s.alertLevel?"text-red-600":"orange"===s.alertLevel?"text-orange-600":"yellow"===s.alertLevel?"text-yellow-600":"text-green-600"),children:["Status: ",s.alertLevel.toUpperCase()]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-purple-800 mb-2",children:"Recommendations"}),e.jsx("div",{className:"text-xs text-purple-600 space-y-1",children:s.recommendations.slice(0,3).map((s,t)=>e.jsxs("div",{children:["â€¢ ",s]},t))})]})]})]})}),SessionControls=({sessionState:s,showMetricsPanel:t,showExplanation:a,onToggleMetrics:r,onToggleExplanation:l,onEndSession:n})=>e.jsxs("div",{className:"fixed bottom-6 right-6 flex flex-col space-y-2",children:[e.jsxs("button",{onClick:r,className:"px-4 py-2 bg-white rounded-full shadow-lg hover:shadow-xl transition-shadow text-sm font-medium",children:[t?"Hide":"Show"," Metrics"]}),e.jsxs("button",{onClick:l,className:"px-4 py-2 bg-white rounded-full shadow-lg hover:shadow-xl transition-shadow text-sm font-medium",children:[a?"Hide":"Show"," AI Reasoning"]}),e.jsx("button",{onClick:n,className:"px-4 py-2 bg-red-500 text-white rounded-full shadow-lg hover:shadow-xl transition-shadow text-sm font-medium",children:"End Session"})]}),calculateMomentumImpact=(e,s)=>({again:-.2,hard:-.05,good:.1,easy:.15}[e]||0),calculateConfidenceChange=(e,s)=>({again:-.1,hard:-.02,good:.05,easy:.08}[e]||0);function ResetPasswordPage(){const s=r();return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-900 py-12 px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"max-w-md w-full space-y-8",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"mt-6 text-center text-3xl font-extrabold text-gray-900 dark:text-white",children:"Password Reset"}),e.jsx("p",{className:"mt-2 text-center text-sm text-gray-600 dark:text-gray-400",children:"Password reset functionality will be implemented with PocketBase integration."})]}),e.jsx("div",{className:"rounded-md shadow-sm space-y-4",children:e.jsx("button",{onClick:()=>s("/"),className:"group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Back to Home"})})]})})}function formatBytes(e){if(!e&&0!==e)return"N/A";const s=["B","KB","MB","GB","TB"];if(0===e)return"0 B";const t=Math.floor(Math.log(e)/Math.log(1024)),a=e/Math.pow(1024,t);return`${a.toFixed(a>=100?0:a>=10?1:2)} ${s[t]}`}const StoragePage=()=>{const[s,a]=t.useState(null),[r,l]=t.useState(!1),[n,d]=t.useState(null),[i,c]=t.useState(!1),[o,x]=t.useState(null),[m,g]=t.useState(null),reload=async()=>{l(!0),g(null);try{const e=await se.getUsage();a(e)}catch(e){g(e instanceof Error?e.message:String(e))}finally{l(!1)}};t.useEffect(()=>{reload()},[]);const onPurgeUnused=async()=>{d("unused"),g(null),x(null);try{const e=await se.purgeUnusedMedia();x(`Removed ${e.removedCount} items, freed ${formatBytes(e.removedBytes)}. Kept ${e.keptCount}.`),await reload()}catch(e){g(e instanceof Error?e.message:String(e))}finally{d(null)}},onPurgeAll=async()=>{if(confirm("This will remove ALL locally stored media. Cards may not render media until re-imported. Continue?")){d("all"),g(null),x(null);try{const e=await se.purgeAllMedia();x(`Removed ${e.removedCount} items, freed ${formatBytes(e.removedBytes)}.`),await reload()}catch(e){g(e instanceof Error?e.message:String(e))}finally{d(null)}}},onClearAllData=async()=>{if(confirm("âš ï¸ WARNING: This will delete ALL data including decks, cards, reviews, achievements, and media. This action CANNOT be undone. Are you sure?")&&confirm("This is your last chance. Click OK to permanently delete all data.")){c(!0),g(null),x(null);try{await X.transaction("rw",X.decks,X.cards,X.reviews,X.media,X.achievements,X.leaderboardCache,X.syncQueue,X.mediaAnalytics,X.userOnlineLinks,async()=>{await X.decks.clear(),await X.cards.clear(),await X.reviews.clear(),await X.media.clear(),await X.achievements.clear(),await X.leaderboardCache.clear(),await X.syncQueue.clear(),await X.mediaAnalytics.clear(),await X.userOnlineLinks.clear()}),localStorage.clear(),x("All data cleared successfully. Reloading app..."),setTimeout(()=>{window.location.href="/"},1500)}catch(e){g(e instanceof Error?e.message:String(e)),c(!1)}}},h=s?.estimate,u=t.useMemo(()=>h?.quota&&h?.usage?Math.min(100,Math.round(h.usage/h.quota*100)):null,[h?.quota,h?.usage]);return e.jsxs("div",{className:"p-4 md:p-6 lg:p-8",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-900 dark:text-gray-100",children:"Storage Management"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Manage local storage (IndexedDB/OPFS). Media is stored on-device; server is optional."})]}),m&&e.jsx("div",{className:"mb-4 rounded-md border border-red-300 bg-red-50 p-3 text-red-800 dark:border-red-700 dark:bg-red-900/30 dark:text-red-200",children:m}),o&&e.jsx("div",{className:"mb-4 rounded-md border border-green-300 bg-green-50 p-3 text-green-800 dark:border-green-700 dark:bg-green-900/30 dark:text-green-200",children:o}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs("div",{className:"rounded-lg border border-gray-200 bg-white p-4 shadow-sm dark:border-gray-700 dark:bg-gray-800",children:[e.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900 dark:text-gray-100",children:"Media Storage"}),e.jsx("button",{onClick:reload,disabled:r,className:"rounded-md border border-gray-300 px-3 py-1.5 text-sm text-gray-700 hover:bg-gray-50 dark:border-gray-600 dark:text-gray-200 dark:hover:bg-gray-700",children:r?"Refreshingâ€¦":"Refresh"})]}),e.jsxs("dl",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{className:"text-gray-600 dark:text-gray-400",children:"Media bytes"}),e.jsx("dd",{className:"text-gray-900 dark:text-gray-100",children:formatBytes(s?.mediaBytes)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{className:"text-gray-600 dark:text-gray-400",children:"Media items"}),e.jsx("dd",{className:"text-gray-900 dark:text-gray-100",children:s?.mediaCount??"â€”"})]})]}),e.jsxs("div",{className:"mt-4 flex gap-3",children:[e.jsx("button",{onClick:onPurgeUnused,disabled:null!==n,className:"rounded-md bg-blue-600 px-4 py-2 text-sm font-medium text-white hover:bg-blue-700 disabled:opacity-50",children:"unused"===n?"Purging unusedâ€¦":"Purge Unused Media"}),e.jsx("button",{onClick:onPurgeAll,disabled:null!==n,className:"rounded-md bg-red-600 px-4 py-2 text-sm font-medium text-white hover:bg-red-700 disabled:opacity-50",children:"all"===n?"Purging allâ€¦":"Purge ALL Media"})]})]}),e.jsxs("div",{className:"rounded-lg border border-gray-200 bg-white p-4 shadow-sm dark:border-gray-700 dark:bg-gray-800",children:[e.jsx("h2",{className:"mb-3 text-lg font-medium text-gray-900 dark:text-gray-100",children:"Database Overview"}),e.jsxs("dl",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{className:"text-gray-600 dark:text-gray-400",children:"Decks"}),e.jsx("dd",{className:"text-gray-900 dark:text-gray-100",children:s?.decksCount??"â€”"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{className:"text-gray-600 dark:text-gray-400",children:"Cards"}),e.jsx("dd",{className:"text-gray-900 dark:text-gray-100",children:s?.cardsCount??"â€”"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{className:"text-gray-600 dark:text-gray-400",children:"Reviews"}),e.jsx("dd",{className:"text-gray-900 dark:text-gray-100",children:s?.reviewsCount??"â€”"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{className:"text-gray-600 dark:text-gray-400",children:"Achievements"}),e.jsx("dd",{className:"text-gray-900 dark:text-gray-100",children:s?.achievementsCount??"â€”"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{className:"text-gray-600 dark:text-gray-400",children:"Challenges"}),e.jsx("dd",{className:"text-gray-900 dark:text-gray-100",children:s?.challengesCount??"â€”"})]})]})]})]}),e.jsxs("div",{className:"mt-6 rounded-lg border border-gray-200 bg-white p-4 shadow-sm dark:border-gray-700 dark:bg-gray-800",children:[e.jsx("h2",{className:"mb-3 text-lg font-medium text-gray-900 dark:text-gray-100",children:"Browser Storage Estimate"}),e.jsxs("dl",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{className:"text-gray-600 dark:text-gray-400",children:"Quota"}),e.jsx("dd",{className:"text-gray-900 dark:text-gray-100",children:formatBytes(h?.quota)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{className:"text-gray-600 dark:text-gray-400",children:"Usage"}),e.jsx("dd",{className:"text-gray-900 dark:text-gray-100",children:formatBytes(h?.usage)})]}),null!=u&&e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"h-2 w-full rounded bg-gray-200 dark:bg-gray-700",children:e.jsx("div",{className:"h-2 rounded bg-gradient-to-r from-blue-500 to-purple-600",style:{width:`${u}%`}})}),e.jsxs("div",{className:"mt-1 text-right text-xs text-gray-500 dark:text-gray-400",children:[u,"% of quota used"]})]})]})]}),e.jsxs("div",{className:"mt-6 rounded-lg border border-red-300 bg-red-50 p-4 shadow-sm dark:border-red-700 dark:bg-red-900/20",children:[e.jsx("h2",{className:"mb-3 text-lg font-medium text-red-900 dark:text-red-100",children:"âš ï¸ Danger Zone"}),e.jsx("p",{className:"mb-4 text-sm text-red-800 dark:text-red-200",children:"This action will permanently delete all your data including decks, cards, study progress, achievements, and media files. This is useful for testing or if you want to start fresh."}),e.jsx("button",{onClick:onClearAllData,disabled:i||null!==n,className:"rounded-md bg-red-600 px-4 py-2 text-sm font-medium text-white hover:bg-red-700 disabled:opacity-50",children:i?"Clearing all data...":"Clear All Data"})]})]})},be=!1;function EnhancedReviewRoute(){const{deckId:s}=o(),{user:t}=K(),a=t?.id??"local-user";return e.jsx(EnhancedReviewPage,{deckId:s,userId:a})}function AnalyticsRoute(){const{user:s}=K(),t=s?.id??"local-user";return e.jsx(AnalyticsDashboard,{userId:t,timeRange:"30d"})}function App(){const{isAuthenticated:s,initializeAuth:a}=K();return t.useEffect(()=>{a()},[a]),e.jsx(R,{children:e.jsxs(P,{path:"/",element:e.jsx(ge,{}),children:[e.jsx(P,{index:!0,element:e.jsx(HomePage,{})}),e.jsx(P,{path:"/study/:deckId",element:s?e.jsx(StudyPage,{}):e.jsx(F,{to:"/",replace:!0})}),e.jsx(P,{path:"/enhanced-review/:deckId",element:s?e.jsx(EnhancedReviewRoute,{}):e.jsx(F,{to:"/",replace:!0})}),e.jsx(P,{path:"/decks",element:s?e.jsx(DecksPage,{}):e.jsx(F,{to:"/",replace:!0})}),e.jsx(P,{path:"/profile",element:s?e.jsx(ProfilePage,{}):e.jsx(F,{to:"/",replace:!0})}),e.jsx(P,{path:"/challenges",element:s?e.jsx(ChallengesPage,{}):e.jsx(F,{to:"/",replace:!0})}),e.jsx(P,{path:"/leaderboard",element:e.jsx(LeaderboardPage,{})}),e.jsx(P,{path:"/stats",element:e.jsx(GlobalStatsPage,{})}),e.jsx(P,{path:"/analytics",element:s?e.jsx(AnalyticsRoute,{}):e.jsx(F,{to:"/",replace:!0})}),e.jsx(P,{path:"/reset-password",element:e.jsx(ResetPasswordPage,{})}),e.jsx(P,{path:"/storage",element:e.jsx(StoragePage,{})}),be,e.jsx(P,{path:"*",element:e.jsx(F,{to:"/",replace:!0})})]})})}const ye=new xe({defaultOptions:{queries:{staleTime:3e5,cacheTime:18e5,retry:2,refetchOnWindowFocus:!1}}});te(),$.createRoot(document.getElementById("root")).render(e.jsx(n.StrictMode,{children:e.jsx(O,{client:ye,children:e.jsx(B,{children:e.jsx(App,{})})})}));
//# sourceMappingURL=index-i4RifavR.js.map
