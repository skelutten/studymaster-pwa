import{d as g,p as k}from"./data-vendor-DvmbASBZ.js";import{f as b}from"./vendor-CfVaRPIS.js";const M={totalXP:2500,level:5,currentLevelXP:100,nextLevelXP:500,cardsStudied:1250,studyTime:2400,accuracy:87.5,currentStreak:15,longestStreak:28,coins:150,gems:10,lastStudyDate:new Date().toISOString(),joinDate:new Date(Date.now()-720*60*60*1e3).toISOString()},w=[{id:"first_study",name:"First Steps",description:"Complete your first study session",icon:"ðŸŽ¯",unlockedAt:new Date(Date.now()-600*60*60*1e3).toISOString(),category:"study"},{id:"week_streak",name:"Week Warrior",description:"Study for 7 days in a row",icon:"ðŸ”¥",unlockedAt:new Date(Date.now()-14400*60*1e3).toISOString(),category:"streak"}],A=[{id:"monthly_mastery",name:"Monthly Mastery Challenge",description:"Complete an intensive month-long study challenge with progressive difficulty",type:"monthly",target:1e3,current:245,reward:{xp:1500,coins:500,gems:50},expiresAt:new Date(Date.now()+720*60*60*1e3).toISOString()},{id:"knowledge_seeker",name:"Knowledge Seeker",description:"Explore diverse subjects and maintain high accuracy throughout the month",type:"monthly",target:800,current:156,reward:{xp:1200,coins:400,gems:30},expiresAt:new Date(Date.now()+600*60*60*1e3).toISOString()}],v=[{id:"daily_grind",name:"Daily Grind",description:"Study 25 cards today",type:"daily",target:25,current:18,reward:{xp:50,coins:10},expiresAt:new Date(Date.now()+1440*60*1e3).toISOString()},{id:"weekly_warrior",name:"Weekly Warrior",description:"Study 200 cards this week",type:"weekly",target:200,current:145,reward:{xp:200,coins:50,gems:5},expiresAt:new Date(Date.now()+4320*60*1e3).toISOString()},...A],S={global:[{userId:"demo1",username:"StudyMaster",score:5420,rank:1,change:0},{userId:"demo2",username:"FlashcardPro",score:4890,rank:2,change:1},{userId:"demo3",username:"MemoryWiz",score:4650,rank:3,change:-1},{userId:"demo4",username:"QuizKing",score:4200,rank:4,change:2},{userId:"demo_user",username:"Demo User",score:2500,rank:15,change:3}],friends:[{userId:"friend1",username:"StudyBuddy",score:3200,rank:1,change:0},{userId:"demo_user",username:"Demo User",score:2500,rank:2,change:1},{userId:"friend2",username:"LearningPal",score:2100,rank:3,change:-1}],weekly:[{userId:"demo1",username:"StudyMaster",score:890,rank:1,change:2},{userId:"demo_user",username:"Demo User",score:420,rank:8,change:5}],monthly:[{userId:"demo1",username:"StudyMaster",score:3200,rank:1,change:0},{userId:"demo_user",username:"Demo User",score:1800,rank:12,change:-2}]};class D{baseUrl="/api";isDemoUser(e){return e.tokenType==="demo"||e.email==="demo@studymaster.app"}async getUserStats(e){if(g.log("[USER_DATA_SERVICE]","START - getUserStats",{userId:e.id,isDemoUser:this.isDemoUser(e)}),this.isDemoUser(e))return g.log("[USER_DATA_SERVICE]","Returning demo user stats"),M;try{g.log("[USER_DATA_SERVICE]","Attempting to fetch user stats from PocketBase");const t=await k.collection("users").getOne(e.id,{fields:"level,total_xp,coins,gems,last_active,created,preferences"});return g.log("[USER_DATA_SERVICE]","PocketBase user stats fetched successfully"),{totalXP:t.total_xp||0,level:t.level||1,currentLevelXP:(t.total_xp||0)%200,nextLevelXP:200,cardsStudied:0,studyTime:0,accuracy:85,currentStreak:0,longestStreak:0,coins:t.coins||100,gems:t.gems||10,lastStudyDate:t.last_active||new Date().toISOString(),joinDate:t.created||new Date().toISOString()}}catch(t){g.warn("[USER_DATA_SERVICE]","PocketBase fetch failed, trying REST API fallback",{error:t});try{const r=await fetch(`${this.baseUrl}/users/${e.id}/stats`,{headers:{Authorization:`Bearer ${e.token}`,"Content-Type":"application/json"}});if(!r.ok)throw new Error("Failed to fetch user stats from REST API");const a=await r.json();return g.log("[USER_DATA_SERVICE]","REST API user stats fetched successfully"),a}catch(r){return g.warn("[USER_DATA_SERVICE]","Both PocketBase and REST API failed, using mock data",{pocketbaseError:t,apiError:r}),this.generatePersonalizedMockStats(e)}}}async getUserActivity(e,t=30){if(this.isDemoUser(e))return this.generateDemoActivity(t);try{const r=await fetch(`${this.baseUrl}/users/${e.id}/activity?days=${t}`,{headers:{Authorization:`Bearer ${e.token}`,"Content-Type":"application/json"}});if(!r.ok)throw new Error("Failed to fetch user activity");return await r.json()}catch(r){return console.warn("Failed to fetch real user activity, using mock data:",r),this.generatePersonalizedActivity(e,t)}}async getUserAchievements(e){if(this.isDemoUser(e))return w;try{const t=await fetch(`${this.baseUrl}/users/${e.id}/achievements`,{headers:{Authorization:`Bearer ${e.token}`,"Content-Type":"application/json"}});if(!t.ok)throw new Error("Failed to fetch user achievements");return await t.json()}catch(t){return console.warn("Failed to fetch real user achievements, using mock data:",t),this.generatePersonalizedAchievements(e)}}async getUserChallenges(e){if(this.isDemoUser(e))return v;try{const t=await fetch(`${this.baseUrl}/users/${e.id}/challenges`,{headers:{Authorization:`Bearer ${e.token}`,"Content-Type":"application/json"}});if(!t.ok)throw new Error("Failed to fetch user challenges");return await t.json()}catch(t){return console.warn("Failed to fetch real user challenges, using mock data:",t),this.generatePersonalizedChallenges(e)}}async getLeaderboardData(e){if(this.isDemoUser(e))return S;try{const t=await fetch(`${this.baseUrl}/leaderboard`,{headers:{Authorization:`Bearer ${e.token}`,"Content-Type":"application/json"}});if(!t.ok)throw new Error("Failed to fetch leaderboard data");return await t.json()}catch(t){return console.warn("Failed to fetch real leaderboard data, using mock data:",t),this.generatePersonalizedLeaderboard(e)}}async getPerformanceMetrics(e){if(this.isDemoUser(e))return this.generateDemoPerformanceMetrics();try{const t=await fetch(`${this.baseUrl}/users/${e.id}/performance`,{headers:{Authorization:`Bearer ${e.token}`,"Content-Type":"application/json"}});if(!t.ok)throw new Error("Failed to fetch performance metrics");return await t.json()}catch(t){return console.warn("Failed to fetch real performance metrics, using mock data:",t),this.generatePersonalizedPerformanceMetrics(e)}}async getCompleteUserProfile(e){const[t,r,a,n,s]=await Promise.all([this.getUserStats(e),this.getUserActivity(e,30),this.getUserAchievements(e),this.getUserChallenges(e),this.getPerformanceMetrics(e)]);return{stats:t,activity:r,achievements:a,challenges:n,performance:s}}async resetAllUserData(e){if(!this.isDemoUser(e))try{if(!(await fetch(`${this.baseUrl}/users/${e.id}/reset`,{method:"POST",headers:{Authorization:`Bearer ${e.token}`,"Content-Type":"application/json"}})).ok)throw new Error("Failed to reset user data")}catch(t){console.warn("Failed to reset real user data via API:",t)}}generatePersonalizedMockStats(e){const t=this.hashString(e.email),r=Math.floor(t%60)+1;return{totalXP:Math.floor(t%1e3)+100,level:Math.floor(t%1e3/200)+1,currentLevelXP:t%200,nextLevelXP:200,cardsStudied:Math.floor(t%500)+50,studyTime:Math.floor(t%1200)+60,accuracy:75+t%20,currentStreak:Math.floor(t%15)+1,longestStreak:Math.floor(t%30)+5,coins:Math.floor(t%200)+50,gems:Math.floor(t%20)+5,lastStudyDate:new Date().toISOString(),joinDate:new Date(Date.now()-r*24*60*60*1e3).toISOString()}}generatePersonalizedActivity(e,t){const r=[];for(let a=0;a<t;a++){const n=new Date(Date.now()-a*24*60*60*1e3),s=this.hashString(e.email+n.toDateString());s%4!==0&&r.push({date:n.toISOString().split("T")[0],cardsStudied:Math.floor(s%50)+5,studyTime:Math.floor(s%120)+10,accuracy:70+s%25,xpGained:Math.floor(s%100)+20})}return r.reverse()}generatePersonalizedAchievements(e){const t=this.hashString(e.email),r=[...w];return t%3===0&&r.push({id:"accuracy_master",name:"Accuracy Master",description:"Achieve 90% accuracy in a session",icon:"ðŸŽ¯",unlockedAt:new Date(Date.now()-7200*60*1e3).toISOString(),category:"accuracy"}),r}generatePersonalizedChallenges(e){const t=[...v];return t.forEach(r=>{const a=this.hashString(e.email+r.id);r.current=Math.floor(a%80/100*r.target)}),t}generatePersonalizedLeaderboard(e){const t=this.hashString(e.email),r=Math.floor(t%1e3)+100,a=Math.floor(t%50)+5,n={...S};return n.global.push({userId:e.id,username:e.username,score:r,rank:a,change:Math.floor(t%10)-5}),n}generateDemoActivity(e){const t=[];for(let r=0;r<e;r++){const a=new Date(Date.now()-r*24*60*60*1e3);r%3!==0&&t.push({date:a.toISOString().split("T")[0],cardsStudied:Math.floor(Math.random()*40)+10,studyTime:Math.floor(Math.random()*90)+15,accuracy:80+Math.floor(Math.random()*15),xpGained:Math.floor(Math.random()*80)+30})}return t.reverse()}generateDemoPerformanceMetrics(){return{weeklyProgress:{cardsStudied:180,studyTime:240,accuracy:87.5,goal:350},monthlyProgress:{cardsStudied:720,studyTime:1200,decksCompleted:8},studyPattern:{preferredTime:"evening",averageSessionLength:25,studyFrequency:5.2}}}generatePersonalizedPerformanceMetrics(e){const t=this.hashString(e.email);return{weeklyProgress:{cardsStudied:Math.floor(t%200)+50,studyTime:Math.floor(t%300)+60,accuracy:75+t%20,goal:300},monthlyProgress:{cardsStudied:Math.floor(t%800)+200,studyTime:Math.floor(t%1500)+300,decksCompleted:Math.floor(t%15)+3},studyPattern:{preferredTime:["morning","afternoon","evening"][t%3],averageSessionLength:Math.floor(t%30)+15,studyFrequency:3+t%4}}}hashString(e){let t=0;for(let r=0;r<e.length;r++){const a=e.charCodeAt(r);t=(t<<5)-t+a,t=t&t}return Math.abs(t)}}const T=new D;class C{updateInterval=3e4;subscribers=new Map;intervalId=null;activeInstances=0;subscribe(e,t){return this.subscribers.has(e)||this.subscribers.set(e,[]),this.subscribers.get(e).push(t),()=>{const r=this.subscribers.get(e);if(r){const a=r.indexOf(t);a>-1&&r.splice(a,1)}}}notify(e,t){const r=this.subscribers.get(e);r&&r.forEach(a=>a(t))}async getGlobalLearningStats(){try{const e=await this.fetchFromMultipleSources([()=>this.fetchFromDuolingoAPI(),()=>this.fetchFromKhanAcademyAPI(),()=>this.fetchFromCourseraAPI(),()=>this.fetchFromEducationalDataAPI()]);if(e)return this.notify("globalStats",e),e}catch(e){console.warn("Failed to fetch real global stats, using enhanced mock data:",e)}return this.generateEnhancedGlobalStats()}async getEducationalTrends(){try{const e=await this.fetchEducationalTrendsFromAPIs();if(e)return this.notify("educationalTrends",e),e}catch(e){console.warn("Failed to fetch real educational trends, using enhanced mock data:",e)}return this.generateEnhancedEducationalTrends()}async getLiveUserMetrics(){try{const e=await this.fetchLiveMetricsFromAPIs();if(e)return this.notify("liveMetrics",e),e}catch(e){console.warn("Failed to fetch real live metrics, using enhanced mock data:",e)}return this.generateEnhancedLiveMetrics()}async getMarketInsights(){try{const e=await this.fetchMarketInsightsFromAPIs();if(e)return this.notify("marketInsights",e),e}catch(e){console.warn("Failed to fetch real market insights, using enhanced mock data:",e)}return this.generateEnhancedMarketInsights()}async fetchFromDuolingoAPI(){try{const e=await fetch("https://www.duolingo.com/api/1/users/show?username=duolingo",{method:"GET",headers:{Accept:"application/json"}});if(e.ok){const t=await e.json();return null}}catch(e){console.log("Duolingo API not accessible:",e)}return null}async fetchFromKhanAcademyAPI(){try{return null}catch(e){console.log("Khan Academy API not accessible:",e)}return null}async fetchFromCourseraAPI(){try{return null}catch(e){console.log("Coursera API not accessible:",e)}return null}async fetchFromEducationalDataAPI(){try{return null}catch(e){console.log("Educational data API not accessible:",e)}return null}async fetchFromMultipleSources(e){const r=(await Promise.allSettled(e.map(a=>a()))).filter(a=>a.status==="fulfilled"&&a.value).map(a=>a.value);return r.length>0?this.mergeDataSources(r):null}mergeDataSources(e){return e[0]}generateEnhancedGlobalStats(){const e=new Date,t=e.getHours(),r=e.getDay(),a=this.getTimeBasedMultiplier(t,r);return{totalLearners:Math.floor(2847392+(Math.random()*1e3-500)),cardsStudiedToday:Math.floor(15847293*a+(Math.random()*1e4-5e3)),activeStudySessions:Math.floor(23847*a+(Math.random()*1e3-500)),languagesBeingLearned:127+Math.floor(Math.random()*5),topSubjects:[{name:"Spanish",learners:Math.floor(847392*a)},{name:"JavaScript",learners:Math.floor(623847*a)},{name:"French",learners:Math.floor(534829*a)},{name:"Python",learners:Math.floor(487293*a)},{name:"German",learners:Math.floor(392847*a)}],studyTimeToday:Math.floor(1847293*a),lastUpdated:e.toISOString()}}generateEnhancedEducationalTrends(){const e=new Date;return{popularSubjects:[{subject:"Artificial Intelligence",growth:156.7,learners:892847},{subject:"Data Science",growth:134.2,learners:734829},{subject:"Cybersecurity",growth:128.9,learners:623847},{subject:"Cloud Computing",growth:119.4,learners:587293},{subject:"Machine Learning",growth:112.8,learners:534829},{subject:"Spanish Language",growth:89.3,learners:1247392},{subject:"Digital Marketing",growth:87.6,learners:423847},{subject:"UX/UI Design",growth:82.4,learners:392847}],learningMethods:[{method:"Spaced Repetition",effectiveness:94.7,usage:78.3},{method:"Active Recall",effectiveness:91.2,usage:65.8},{method:"Microlearning",effectiveness:87.9,usage:82.1},{method:"Gamification",effectiveness:84.6,usage:71.4},{method:"Peer Learning",effectiveness:81.3,usage:56.7}],studyPatterns:{peakHours:this.generatePeakHours(),weeklyTrends:this.generateWeeklyTrends()},lastUpdated:e.toISOString()}}generateEnhancedLiveMetrics(){const e=new Date,t=e.getHours(),r=this.getTimeBasedMultiplier(t,e.getDay());return{onlineUsers:Math.floor(47392*r+(Math.random()*1e3-500)),studyingSessions:Math.floor(23847*r+(Math.random()*500-250)),completedToday:Math.floor(184729+(Math.random()*1e3-500)),averageAccuracy:87.3+(Math.random()*4-2),topPerformers:[{username:"StudyMaster_Pro",score:15847,country:"Singapore"},{username:"LearningNinja",score:14923,country:"South Korea"},{username:"FlashcardWiz",score:14756,country:"Finland"},{username:"MemoryChamp",score:14234,country:"Japan"},{username:"QuizMaster",score:13892,country:"Canada"}],lastUpdated:e.toISOString()}}generateEnhancedMarketInsights(){return{skillDemand:[{skill:"AI/Machine Learning",demand:94.7,growth:156.3},{skill:"Cloud Architecture",demand:91.2,growth:134.7},{skill:"Cybersecurity",demand:89.8,growth:128.9},{skill:"Data Analysis",demand:87.4,growth:119.2},{skill:"DevOps",demand:84.9,growth:112.6},{skill:"Full-Stack Development",demand:82.3,growth:98.4},{skill:"Digital Marketing",demand:78.7,growth:87.9},{skill:"UX Design",demand:76.2,growth:82.1}],industryTrends:[{industry:"Technology",skills:["AI/ML","Cloud Computing","Cybersecurity"],growth:145.7},{industry:"Healthcare",skills:["Data Analysis","Digital Health","Telemedicine"],growth:123.4},{industry:"Finance",skills:["Blockchain","FinTech","Risk Analysis"],growth:118.9},{industry:"Education",skills:["EdTech","Online Learning","Digital Pedagogy"],growth:134.2}],certificationValue:[{cert:"AWS Certified Solutions Architect",value:98.7,popularity:87.3},{cert:"Google Cloud Professional",value:96.2,popularity:82.1},{cert:"Certified Ethical Hacker",value:94.8,popularity:76.4},{cert:"PMP Certification",value:91.3,popularity:89.7},{cert:"Cisco CCNA",value:88.9,popularity:78.2}],lastUpdated:new Date().toISOString()}}getTimeBasedMultiplier(e,t){let r=.7;return e>=9&&e<=11||e>=14&&e<=16||e>=19&&e<=21?r=1.2:e>=6&&e<=23&&(r=1),r*(t===0||t===6?.8:1)}generatePeakHours(){const e=[];for(let t=0;t<24;t++){let r=30;t>=9&&t<=11?r=85+Math.random()*10:t>=14&&t<=16?r=90+Math.random()*10:t>=19&&t<=21?r=95+Math.random()*10:t>=6&&t<=23?r=60+Math.random()*20:r=20+Math.random()*15,e.push({hour:t,activity:Math.floor(r)})}return e}generateWeeklyTrends(){const e=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],t=[8500,9200,9800,9500,8900,7200,6800];return e.map((r,a)=>({day:r,sessions:Math.floor(t[a]+(Math.random()*1e3-500))}))}async fetchEducationalTrendsFromAPIs(){return null}async fetchLiveMetricsFromAPIs(){return null}async fetchMarketInsightsFromAPIs(){return null}startRealTimeUpdates(){return this.activeInstances++,this.activeInstances===1&&!this.intervalId&&(this.intervalId=setInterval(async()=>{try{const[e,t,r,a]=await Promise.all([this.getGlobalLearningStats(),this.getEducationalTrends(),this.getLiveUserMetrics(),this.getMarketInsights()]);this.notify("globalStats",e),this.notify("educationalTrends",t),this.notify("liveMetrics",r),this.notify("marketInsights",a)}catch(e){console.error("Error updating real-time data:",e)}},this.updateInterval)),()=>{this.stopRealTimeUpdates()}}stopRealTimeUpdates(){this.activeInstances=Math.max(0,this.activeInstances-1),this.activeInstances===0&&this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null)}forceStopRealTimeUpdates(){this.activeInstances=0,this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null),this.subscribers.clear()}}const P=new C,y=b.create({baseURL:"https://server-gxanj3vc3-daniel-perssons-projects-c35d58f6.vercel.app",withCredentials:!0}),p={async initializeSession(l,e){return(await y.post("/uams/session/initialize",{userId:l,deckId:e})).data},async getNextCard(l){return(await y.post("/uams/session/next-card",{sessionState:l})).data},async processCardResponse(l,e,t){return(await y.post("/uams/session/response",{sessionState:l,cardId:e,response:t})).data}};class L{config;constructor(e={}){this.config={lookaheadBufferSize:10,emergencyBufferSize:5,challengeReserveSize:5,refreshThreshold:3,maxSessionDurationMinutes:120,adaptiveRefreshInterval:5e3,...e}}async initializeSession(e,t){return p.initializeSession(e,t)}async getNextCard(e){return p.getNextCard(e)}async processCardResponse(e,t,r){return p.processCardResponse(e,t,r)}}class x{contextHistory=[];performanceCache=new Map;async getCurrentContext(){const e={device:this.detectDevice(),networkQuality:await this.assessNetworkQuality()};let t=.9;if(e.device==="mobile")try{e.batteryLevel=await this.getBatteryLevel(),e.batteryLevel!==void 0&&(t+=.05)}catch(a){console.warn("Battery level detection failed:",a)}try{e.ambientNoise=await this.detectAmbientNoise(),e.lighting=await this.detectLightingConditions(),t+=.05}catch(a){console.warn("Ambient conditions detection failed:",a),t-=.1}const r={...e,confidence:Math.max(.5,t),detectionMethod:"multi-sensor-fusion",timestamp:new Date().toISOString()};return this.contextHistory.push(r),this.contextHistory.length>100&&this.contextHistory.shift(),r}detectDevice(){const e=navigator.userAgent.toLowerCase(),t=navigator.platform?.toLowerCase()||"",a=["mobile","android","iphone","ipod","blackberry","windows phone"].some(c=>e.includes(c)),s=["ipad","tablet","kindle","playbook","silk"].some(c=>e.includes(c)),d=window.screen.width,o=window.screen.height,h=Math.max(d,o),i=Math.min(d,o),u="ontouchstart"in window||navigator.maxTouchPoints>0;return s||u&&i>=768&&h>=1024?"tablet":a||u&&h<=736?"mobile":t.includes("win")||t.includes("mac")||t.includes("linux")||!u?"desktop":"mobile"}async assessNetworkQuality(){if(!navigator.onLine)return"offline";try{const e=navigator.connection||navigator.mozConnection||navigator.webkitConnection;if(e){const t=e.effectiveType,r=e.downlink,a=e.rtt;return t==="4g"&&r>10&&a<100?"excellent":(t==="4g"||t==="3g")&&r>2&&a<300||r>.5&&a<1e3?"good":"poor"}return await this.performLatencyTest()}catch(e){return console.warn("Network quality assessment failed:",e),"good"}}async performLatencyTest(){try{const e=performance.now(),t=await fetch("/api/ping",{method:"HEAD",cache:"no-cache"}),a=performance.now()-e;return t.ok?a<100?"excellent":a<300?"good":"poor":"poor"}catch(e){return console.warn("Latency test failed:",e),"poor"}}async getBatteryLevel(){try{const e=await navigator.getBattery?.();if(e&&typeof e.level=="number")return e.level;const t=navigator.battery||navigator.mozBattery||navigator.webkitBattery;return t&&typeof t.level=="number"?t.level:void 0}catch(e){console.warn("Battery level detection failed:",e);return}}async detectAmbientNoise(){try{const e=await navigator.mediaDevices.getUserMedia({audio:!0,video:!1});return new Promise(t=>{const r=new(window.AudioContext||window.webkitAudioContext),a=r.createAnalyser();r.createMediaStreamSource(e).connect(a),a.fftSize=256;const s=a.frequencyBinCount,d=new Uint8Array(s);let o=0,h=0;const i=30,u=()=>{a.getByteFrequencyData(d);const f=d.reduce((c,m)=>c+m,0)/s;if(h+=f,o++,o<i)setTimeout(u,33);else{e.getTracks().forEach(m=>m.stop()),r.close();const c=h/o;c<20?t("quiet"):c<60?t("moderate"):t("noisy")}};u()})}catch(e){console.warn("Ambient noise detection failed:",e);return}}async detectLightingConditions(){try{if("screen"in navigator&&"brightness"in navigator.screen){const e=navigator.screen.brightness;return e<.3?"dim":e>.8?"bright":"optimal"}return await this.detectLightingViaCamera()}catch(e){console.warn("Lighting detection failed:",e);return}}async detectLightingViaCamera(){try{const e=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});return new Promise(t=>{const r=document.createElement("video"),a=document.createElement("canvas"),n=a.getContext("2d");r.srcObject=e,r.play(),r.addEventListener("loadedmetadata",()=>{a.width=r.videoWidth,a.height=r.videoHeight,setTimeout(()=>{if(n){n.drawImage(r,0,0);const s=n.getImageData(0,0,a.width,a.height);let d=0;const o=s.data;for(let i=0;i<o.length;i+=4){const u=o[i],f=o[i+1],c=o[i+2],m=.299*u+.587*f+.114*c;d+=m}const h=d/(o.length/4);e.getTracks().forEach(i=>i.stop()),h<50?t("dim"):h>200?t("bright"):t("optimal")}},500)})})}catch(e){console.warn("Camera-based lighting detection failed:",e);return}}analyzeContextualInsights(e){const t=this.groupPerformanceByContext(e),r=this.findOptimalConditions(t),a=this.contextHistory[this.contextHistory.length-1],n=this.scoreCurrentConditions(a,r),s=this.generateImprovementSuggestions(a,r);return{optimalStudyConditions:r,currentConditionScore:n,improvementSuggestions:s,historicalPerformance:Array.from(t.values())}}getEnvironmentalAdaptations(e){let t=0,r=25;const a={contrastAdjustment:0,fontSizeAdjustment:0,colorScheme:"auto"},n={enableSoundEffects:!0,volumeAdjustment:.7};switch(e.device){case"mobile":t-=.5,r=20,a.fontSizeAdjustment=.2;break;case"tablet":r=30,a.fontSizeAdjustment=.1;break;case"desktop":r=45;break}switch(e.networkQuality){case"poor":case"offline":t-=1,n.enableSoundEffects=!1;break;case"good":t-=.2;break}switch(e.batteryLevel!==void 0&&e.batteryLevel<.3&&(t-=.5,r=15,a.colorScheme="dark"),e.ambientNoise){case"noisy":t-=.3,n.enableSoundEffects=!1;break;case"quiet":n.volumeAdjustment=.5;break}switch(e.lighting){case"dim":a.contrastAdjustment=.3,a.colorScheme="dark",t-=.2;break;case"bright":a.contrastAdjustment=-.2,a.colorScheme="light";break}return{difficultyAdjustment:Math.max(-3,Math.min(3,t)),recommendedBreakFrequency:r,visualOptimizations:a,audioOptimizations:n}}async trackContextChanges(){const e=this.contextHistory[this.contextHistory.length-1],t=await this.getCurrentContext();e&&this.hasSignificantContextChange(e,t)&&this.onContextChange?.(t,e)}hasSignificantContextChange(e,t){return!!(e.device!==t.device||e.networkQuality!==t.networkQuality||e.batteryLevel&&t.batteryLevel&&Math.abs(e.batteryLevel-t.batteryLevel)>.2||e.ambientNoise!==t.ambientNoise||e.lighting!==t.lighting)}groupPerformanceByContext(e){return new Map}findOptimalConditions(e){return{device:"desktop",networkQuality:"excellent",batteryLevel:void 0,ambientNoise:"quiet",lighting:"optimal"}}scoreCurrentConditions(e,t){if(!e)return .5;let r=1;return e.device!==t.device&&(r-=.1),e.networkQuality!==t.networkQuality&&(r-=e.networkQuality==="poor"?.3:.1),e.ambientNoise!==t.ambientNoise&&(r-=.15),e.lighting!==t.lighting&&(r-=.1),e.device==="mobile"&&e.batteryLevel&&e.batteryLevel<.3&&(r-=.2),Math.max(0,r)}generateImprovementSuggestions(e,t){const r=[];return e&&(e.networkQuality==="poor"&&r.push("Consider switching to a better network connection for optimal performance"),e.ambientNoise==="noisy"&&r.push("Find a quieter environment or use noise-canceling headphones"),e.lighting==="dim"?r.push("Improve lighting conditions for better visual clarity"):e.lighting==="bright"&&r.push("Reduce screen glare or move to a less bright environment"),e.device==="mobile"&&e.batteryLevel&&e.batteryLevel<.3&&r.push("Charge your device or switch to a desktop for longer study sessions")),r}onContextChange}export{x as E,L as U,P as r,T as u};
//# sourceMappingURL=services-N5Td_jpn.js.map
