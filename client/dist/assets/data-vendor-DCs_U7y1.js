import{R as e}from"./react-vendor-eg3oBJxg.js";import{u as t}from"./vendor-Dom_ThS-.js";const s=e=>{let t;const s=new Set,n=(e,n)=>{const i="function"==typeof e?e(t):e;if(!Object.is(i,t)){const e=t;t=(null!=n?n:"object"!=typeof i||null===i)?i:Object.assign({},t,i),s.forEach(s=>s(t,e))}},i=()=>t,r={setState:n,getState:i,getInitialState:()=>o,subscribe:e=>(s.add(e),()=>s.delete(e)),destroy:()=>{s.clear()}},o=t=e(n,i,r);return r},n={},{useDebugValue:i}=e,{useSyncExternalStoreWithSelector:r}=t;let o=!1;const a=e=>e;const c=e=>{const t="function"==typeof e?(e=>e?s(e):s)(e):e,c=(e,s)=>function(e,t=a,s){"production"!==(n?"production":void 0)&&s&&!o&&(o=!0);const c=r(e.subscribe,e.getState,e.getServerState||e.getInitialState,t,s);return i(c),c}(t,e,s);return Object.assign(c,t),c},l=e=>c;class h extends Error{constructor(e){super("ClientResponseError"),this.url="",this.status=0,this.response={},this.isAbort=!1,this.originalError=null,Object.setPrototypeOf(this,h.prototype),null!==e&&"object"==typeof e&&(this.url="string"==typeof e.url?e.url:"",this.status="number"==typeof e.status?e.status:0,this.isAbort=!!e.isAbort,this.originalError=e.originalError,null!==e.response&&"object"==typeof e.response?this.response=e.response:null!==e.data&&"object"==typeof e.data?this.response=e.data:this.response={}),this.originalError||e instanceof h||(this.originalError=e),"undefined"!=typeof DOMException&&e instanceof DOMException&&(this.isAbort=!0),this.name="ClientResponseError "+this.status,this.message=this.response?.message,this.message||(this.isAbort?this.message="The request was autocancelled. You can find more info in https://github.com/pocketbase/js-sdk#auto-cancellation.":this.originalError?.cause?.message?.includes("ECONNREFUSED ::1")?this.message="Failed to connect to the PocketBase server. Try changing the SDK URL from localhost to 127.0.0.1 (https://github.com/pocketbase/js-sdk/issues/21).":this.message="Something went wrong while processing your request.")}get data(){return this.response}toJSON(){return{...this}}}const u=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/;function d(e,t,s){const n=Object.assign({},s||{}),i=n.encode||g;if(!u.test(e))throw new TypeError("argument name is invalid");const r=i(t);if(r&&!u.test(r))throw new TypeError("argument val is invalid");let o=e+"="+r;if(null!=n.maxAge){const e=n.maxAge-0;if(isNaN(e)||!isFinite(e))throw new TypeError("option maxAge is invalid");o+="; Max-Age="+Math.floor(e)}if(n.domain){if(!u.test(n.domain))throw new TypeError("option domain is invalid");o+="; Domain="+n.domain}if(n.path){if(!u.test(n.path))throw new TypeError("option path is invalid");o+="; Path="+n.path}if(n.expires){if(!function(e){return"[object Date]"===Object.prototype.toString.call(e)||e instanceof Date}(n.expires)||isNaN(n.expires.valueOf()))throw new TypeError("option expires is invalid");o+="; Expires="+n.expires.toUTCString()}if(n.httpOnly&&(o+="; HttpOnly"),n.secure&&(o+="; Secure"),n.priority)switch("string"==typeof n.priority?n.priority.toLowerCase():n.priority){case"low":o+="; Priority=Low";break;case"medium":o+="; Priority=Medium";break;case"high":o+="; Priority=High";break;default:throw new TypeError("option priority is invalid")}if(n.sameSite)switch("string"==typeof n.sameSite?n.sameSite.toLowerCase():n.sameSite){case!0:o+="; SameSite=Strict";break;case"lax":o+="; SameSite=Lax";break;case"strict":o+="; SameSite=Strict";break;case"none":o+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}return o}function p(e){return-1!==e.indexOf("%")?decodeURIComponent(e):e}function g(e){return encodeURIComponent(e)}const m="undefined"!=typeof navigator&&"ReactNative"===navigator.product||"undefined"!=typeof global&&global.HermesInternal;let f;function b(e){if(e)try{const t=decodeURIComponent(f(e.split(".")[1]).split("").map(function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)}).join(""));return JSON.parse(t)||{}}catch(e){}return{}}function y(e,t=0){let s=b(e);return!(Object.keys(s).length>0&&(!s.exp||s.exp-t>Date.now()/1e3))}f="function"!=typeof atob||m?e=>{let t=String(e).replace(/=+$/,"");if(t.length%4==1)throw new Error("'atob' failed: The string to be decoded is not correctly encoded.");for(var s,n,i=0,r=0,o="";n=t.charAt(r++);~n&&(s=i%4?64*s+n:n,i++%4)?o+=String.fromCharCode(255&s>>(-2*i&6)):0)n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(n);return o}:atob;const S="pb_auth";class w{constructor(){this.baseToken="",this.baseModel=null,this._onChangeCallbacks=[]}get token(){return this.baseToken}get model(){return this.baseModel}get isValid(){return!y(this.token)}get isAdmin(){return"admin"===b(this.token).type}get isAuthRecord(){return"authRecord"===b(this.token).type}save(e,t){this.baseToken=e||"",this.baseModel=t||null,this.triggerChange()}clear(){this.baseToken="",this.baseModel=null,this.triggerChange()}loadFromCookie(e,t=S){const s=function(e){const t={};if("string"!=typeof e)return t;const s=Object.assign({},{}).decode||p;let n=0;for(;n<e.length;){const i=e.indexOf("=",n);if(-1===i)break;let r=e.indexOf(";",n);if(-1===r)r=e.length;else if(r<i){n=e.lastIndexOf(";",i-1)+1;continue}const o=e.slice(n,i).trim();if(void 0===t[o]){let n=e.slice(i+1,r).trim();34===n.charCodeAt(0)&&(n=n.slice(1,-1));try{t[o]=s(n)}catch(e){t[o]=n}}n=r+1}return t}(e||"")[t]||"";let n={};try{n=JSON.parse(s),(null===typeof n||"object"!=typeof n||Array.isArray(n))&&(n={})}catch(e){}this.save(n.token||"",n.model||null)}exportToCookie(e,t=S){const s={secure:!0,sameSite:!0,httpOnly:!0,path:"/"},n=b(this.token);s.expires=n?.exp?new Date(1e3*n.exp):new Date("1970-01-01"),e=Object.assign({},s,e);const i={token:this.token,model:this.model?JSON.parse(JSON.stringify(this.model)):null};let r=d(t,JSON.stringify(i),e);const o="undefined"!=typeof Blob?new Blob([r]).size:r.length;if(i.model&&o>4096){i.model={id:i?.model?.id,email:i?.model?.email};const s=["collectionId","username","verified"];for(const e in this.model)s.includes(e)&&(i.model[e]=this.model[e]);r=d(t,JSON.stringify(i),e)}return r}onChange(e,t=!1){return this._onChangeCallbacks.push(e),t&&e(this.token,this.model),()=>{for(let t=this._onChangeCallbacks.length-1;t>=0;t--)if(this._onChangeCallbacks[t]==e)return delete this._onChangeCallbacks[t],void this._onChangeCallbacks.splice(t,1)}}triggerChange(){for(const e of this._onChangeCallbacks)e&&e(this.token,this.model)}}class C extends w{constructor(e="pocketbase_auth"){super(),this.storageFallback={},this.storageKey=e,this._bindStorageEvent()}get token(){return(this._storageGet(this.storageKey)||{}).token||""}get model(){return(this._storageGet(this.storageKey)||{}).model||null}save(e,t){this._storageSet(this.storageKey,{token:e,model:t}),super.save(e,t)}clear(){this._storageRemove(this.storageKey),super.clear()}_storageGet(e){if("undefined"!=typeof window&&window?.localStorage){const t=window.localStorage.getItem(e)||"";try{return JSON.parse(t)}catch(e){return t}}return this.storageFallback[e]}_storageSet(e,t){if("undefined"!=typeof window&&window?.localStorage){let s=t;"string"!=typeof t&&(s=JSON.stringify(t)),window.localStorage.setItem(e,s)}else this.storageFallback[e]=t}_storageRemove(e){"undefined"!=typeof window&&window?.localStorage&&window.localStorage?.removeItem(e),delete this.storageFallback[e]}_bindStorageEvent(){"undefined"!=typeof window&&window?.localStorage&&window.addEventListener&&window.addEventListener("storage",e=>{if(e.key!=this.storageKey)return;const t=this._storageGet(this.storageKey)||{};super.save(t.token||"",t.model||null)})}}class O{constructor(e){this.client=e}}class v extends O{async getAll(e){return e=Object.assign({method:"GET"},e),this.client.send("/api/settings",e)}async update(e,t){return t=Object.assign({method:"PATCH",body:e},t),this.client.send("/api/settings",t)}async testS3(e="storage",t){return t=Object.assign({method:"POST",body:{filesystem:e}},t),this.client.send("/api/settings/test/s3",t).then(()=>!0)}async testEmail(e,t,s){return s=Object.assign({method:"POST",body:{email:e,template:t}},s),this.client.send("/api/settings/test/email",s).then(()=>!0)}async generateAppleClientSecret(e,t,s,n,i,r){return r=Object.assign({method:"POST",body:{clientId:e,teamId:t,keyId:s,privateKey:n,duration:i}},r),this.client.send("/api/settings/apple/generate-client-secret",r)}}class I extends O{decode(e){return e}async getFullList(e,t){if("number"==typeof e)return this._getFullList(e,t);let s=500;return(t=Object.assign({},e,t)).batch&&(s=t.batch,delete t.batch),this._getFullList(s,t)}async getList(e=1,t=30,s){return(s=Object.assign({method:"GET"},s)).query=Object.assign({page:e,perPage:t},s.query),this.client.send(this.baseCrudPath,s).then(e=>(e.items=e.items?.map(e=>this.decode(e))||[],e))}async getFirstListItem(e,t){return(t=Object.assign({requestKey:"one_by_filter_"+this.baseCrudPath+"_"+e},t)).query=Object.assign({filter:e,skipTotal:1},t.query),this.getList(1,1,t).then(e=>{if(!e?.items?.length)throw new h({status:404,response:{code:404,message:"The requested resource wasn't found.",data:{}}});return e.items[0]})}async getOne(e,t){if(!e)throw new h({url:this.client.buildUrl(this.baseCrudPath+"/"),status:404,response:{code:404,message:"Missing required record id.",data:{}}});return t=Object.assign({method:"GET"},t),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e),t).then(e=>this.decode(e))}async create(e,t){return t=Object.assign({method:"POST",body:e},t),this.client.send(this.baseCrudPath,t).then(e=>this.decode(e))}async update(e,t,s){return s=Object.assign({method:"PATCH",body:t},s),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e),s).then(e=>this.decode(e))}async delete(e,t){return t=Object.assign({method:"DELETE"},t),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e),t).then(()=>!0)}_getFullList(e=500,t){(t=t||{}).query=Object.assign({skipTotal:1},t.query);let s=[],n=async i=>this.getList(i,e||500,t).then(e=>{const t=e.items;return s=s.concat(t),t.length==e.perPage?n(i+1):s});return n(1)}}function T(e,t,s,n){const i=void 0!==n;return i||void 0!==s?i?(t.body=Object.assign({},t.body,s),t.query=Object.assign({},t.query,n),t):Object.assign(t,s):t}function P(e){e._resetAutoRefresh?.()}class E extends I{get baseCrudPath(){return"/api/admins"}async update(e,t,s){return super.update(e,t,s).then(e=>(this.client.authStore.model?.id===e.id&&void 0===this.client.authStore.model?.collectionId&&this.client.authStore.save(this.client.authStore.token,e),e))}async delete(e,t){return super.delete(e,t).then(t=>(t&&this.client.authStore.model?.id===e&&void 0===this.client.authStore.model?.collectionId&&this.client.authStore.clear(),t))}authResponse(e){const t=this.decode(e?.admin||{});return e?.token&&e?.admin&&this.client.authStore.save(e.token,t),Object.assign({},e,{token:e?.token||"",admin:t})}async authWithPassword(e,t,s,n){let i={method:"POST",body:{identity:e,password:t}};i=T(0,i,s,n);const r=i.autoRefreshThreshold;delete i.autoRefreshThreshold,i.autoRefresh||P(this.client);let o=await this.client.send(this.baseCrudPath+"/auth-with-password",i);return o=this.authResponse(o),r&&function(e,t,s,n){P(e);const i=e.beforeSend,r=e.authStore.model,o=e.authStore.onChange((t,s)=>{(!t||s?.id!=r?.id||(s?.collectionId||r?.collectionId)&&s?.collectionId!=r?.collectionId)&&P(e)});e._resetAutoRefresh=function(){o(),e.beforeSend=i,delete e._resetAutoRefresh},e.beforeSend=async(r,o)=>{const a=e.authStore.token;if(o.query?.autoRefresh)return i?i(r,o):{url:r,sendOptions:o};let c=e.authStore.isValid;if(c&&y(e.authStore.token,t))try{await s()}catch(e){c=!1}c||await n();const l=o.headers||{};for(let t in l)if("authorization"==t.toLowerCase()&&a==l[t]&&e.authStore.token){l[t]=e.authStore.token;break}return o.headers=l,i?i(r,o):{url:r,sendOptions:o}}}(this.client,r,()=>this.authRefresh({autoRefresh:!0}),()=>this.authWithPassword(e,t,Object.assign({autoRefresh:!0},i))),o}async authRefresh(e,t){let s={method:"POST"};return s=T(0,s,e,t),this.client.send(this.baseCrudPath+"/auth-refresh",s).then(this.authResponse.bind(this))}async requestPasswordReset(e,t,s){let n={method:"POST",body:{email:e}};return n=T(0,n,t,s),this.client.send(this.baseCrudPath+"/request-password-reset",n).then(()=>!0)}async confirmPasswordReset(e,t,s,n,i){let r={method:"POST",body:{token:e,password:t,passwordConfirm:s}};return r=T(0,r,n,i),this.client.send(this.baseCrudPath+"/confirm-password-reset",r).then(()=>!0)}}const k=["requestKey","$cancelKey","$autoCancel","fetch","headers","body","query","params","cache","credentials","headers","integrity","keepalive","method","mode","redirect","referrer","referrerPolicy","signal","window"];function j(e){if(e){e.query=e.query||{};for(let t in e)k.includes(t)||(e.query[t]=e[t],delete e[t])}}class R extends O{constructor(){super(...arguments),this.clientId="",this.eventSource=null,this.subscriptions={},this.lastSentSubscriptions=[],this.maxConnectTimeout=15e3,this.reconnectAttempts=0,this.maxReconnectAttempts=1/0,this.predefinedReconnectIntervals=[200,300,500,1e3,1200,1500,2e3],this.pendingConnects=[]}get isConnected(){return!!this.eventSource&&!!this.clientId&&!this.pendingConnects.length}async subscribe(e,t,s){if(!e)throw new Error("topic must be set.");let n=e;if(s){j(s=Object.assign({},s));const e="options="+encodeURIComponent(JSON.stringify({query:s.query,headers:s.headers}));n+=(n.includes("?")?"&":"?")+e}const i=function(e){const s=e;let n;try{n=JSON.parse(s?.data)}catch{}t(n||{})};return this.subscriptions[n]||(this.subscriptions[n]=[]),this.subscriptions[n].push(i),this.isConnected?1===this.subscriptions[n].length?await this.submitSubscriptions():this.eventSource?.addEventListener(n,i):await this.connect(),async()=>this.unsubscribeByTopicAndListener(e,i)}async unsubscribe(e){let t=!1;if(e){const s=this.getSubscriptionsByTopic(e);for(let e in s)if(this.hasSubscriptionListeners(e)){for(let t of this.subscriptions[e])this.eventSource?.removeEventListener(e,t);delete this.subscriptions[e],t||(t=!0)}}else this.subscriptions={};this.hasSubscriptionListeners()?t&&await this.submitSubscriptions():this.disconnect()}async unsubscribeByPrefix(e){let t=!1;for(let s in this.subscriptions)if((s+"?").startsWith(e)){t=!0;for(let e of this.subscriptions[s])this.eventSource?.removeEventListener(s,e);delete this.subscriptions[s]}t&&(this.hasSubscriptionListeners()?await this.submitSubscriptions():this.disconnect())}async unsubscribeByTopicAndListener(e,t){let s=!1;const n=this.getSubscriptionsByTopic(e);for(let i in n){if(!Array.isArray(this.subscriptions[i])||!this.subscriptions[i].length)continue;let e=!1;for(let s=this.subscriptions[i].length-1;s>=0;s--)this.subscriptions[i][s]===t&&(e=!0,delete this.subscriptions[i][s],this.subscriptions[i].splice(s,1),this.eventSource?.removeEventListener(i,t));e&&(this.subscriptions[i].length||delete this.subscriptions[i],s||this.hasSubscriptionListeners(i)||(s=!0))}this.hasSubscriptionListeners()?s&&await this.submitSubscriptions():this.disconnect()}hasSubscriptionListeners(e){if(this.subscriptions=this.subscriptions||{},e)return!!this.subscriptions[e]?.length;for(let t in this.subscriptions)if(this.subscriptions[t]?.length)return!0;return!1}async submitSubscriptions(){if(this.clientId)return this.addAllSubscriptionListeners(),this.lastSentSubscriptions=this.getNonEmptySubscriptionKeys(),this.client.send("/api/realtime",{method:"POST",body:{clientId:this.clientId,subscriptions:this.lastSentSubscriptions},requestKey:this.getSubscriptionsCancelKey()}).catch(e=>{if(!e?.isAbort)throw e})}getSubscriptionsCancelKey(){return"realtime_"+this.clientId}getSubscriptionsByTopic(e){const t={};e=e.includes("?")?e:e+"?";for(let s in this.subscriptions)(s+"?").startsWith(e)&&(t[s]=this.subscriptions[s]);return t}getNonEmptySubscriptionKeys(){const e=[];for(let t in this.subscriptions)this.subscriptions[t].length&&e.push(t);return e}addAllSubscriptionListeners(){if(this.eventSource){this.removeAllSubscriptionListeners();for(let e in this.subscriptions)for(let t of this.subscriptions[e])this.eventSource.addEventListener(e,t)}}removeAllSubscriptionListeners(){if(this.eventSource)for(let e in this.subscriptions)for(let t of this.subscriptions[e])this.eventSource.removeEventListener(e,t)}async connect(){if(!(this.reconnectAttempts>0))return new Promise((e,t)=>{this.pendingConnects.push({resolve:e,reject:t}),this.pendingConnects.length>1||this.initConnect()})}initConnect(){this.disconnect(!0),clearTimeout(this.connectTimeoutId),this.connectTimeoutId=setTimeout(()=>{this.connectErrorHandler(new Error("EventSource connect took too long."))},this.maxConnectTimeout),this.eventSource=new EventSource(this.client.buildUrl("/api/realtime")),this.eventSource.onerror=e=>{this.connectErrorHandler(new Error("Failed to establish realtime connection."))},this.eventSource.addEventListener("PB_CONNECT",e=>{const t=e;this.clientId=t?.lastEventId,this.submitSubscriptions().then(async()=>{let e=3;for(;this.hasUnsentSubscriptions()&&e>0;)e--,await this.submitSubscriptions()}).then(()=>{for(let e of this.pendingConnects)e.resolve();this.pendingConnects=[],this.reconnectAttempts=0,clearTimeout(this.reconnectTimeoutId),clearTimeout(this.connectTimeoutId);const t=this.getSubscriptionsByTopic("PB_CONNECT");for(let s in t)for(let n of t[s])n(e)}).catch(e=>{this.clientId="",this.connectErrorHandler(e)})})}hasUnsentSubscriptions(){const e=this.getNonEmptySubscriptionKeys();if(e.length!=this.lastSentSubscriptions.length)return!0;for(const t of e)if(!this.lastSentSubscriptions.includes(t))return!0;return!1}connectErrorHandler(e){if(clearTimeout(this.connectTimeoutId),clearTimeout(this.reconnectTimeoutId),!this.clientId&&!this.reconnectAttempts||this.reconnectAttempts>this.maxReconnectAttempts){for(let t of this.pendingConnects)t.reject(new h(e));return this.pendingConnects=[],void this.disconnect()}this.disconnect(!0);const t=this.predefinedReconnectIntervals[this.reconnectAttempts]||this.predefinedReconnectIntervals[this.predefinedReconnectIntervals.length-1];this.reconnectAttempts++,this.reconnectTimeoutId=setTimeout(()=>{this.initConnect()},t)}disconnect(e=!1){if(clearTimeout(this.connectTimeoutId),clearTimeout(this.reconnectTimeoutId),this.removeAllSubscriptionListeners(),this.client.cancelRequest(this.getSubscriptionsCancelKey()),this.eventSource?.close(),this.eventSource=null,this.clientId="",!e){this.reconnectAttempts=0;for(let e of this.pendingConnects)e.resolve();this.pendingConnects=[]}}}class A extends I{constructor(e,t){super(e),this.collectionIdOrName=t}get baseCrudPath(){return this.baseCollectionPath+"/records"}get baseCollectionPath(){return"/api/collections/"+encodeURIComponent(this.collectionIdOrName)}async subscribe(e,t,s){if(!e)throw new Error("Missing topic.");if(!t)throw new Error("Missing subscription callback.");return this.client.realtime.subscribe(this.collectionIdOrName+"/"+e,t,s)}async unsubscribe(e){return e?this.client.realtime.unsubscribe(this.collectionIdOrName+"/"+e):this.client.realtime.unsubscribeByPrefix(this.collectionIdOrName)}async getFullList(e,t){if("number"==typeof e)return super.getFullList(e,t);const s=Object.assign({},e,t);return super.getFullList(s)}async getList(e=1,t=30,s){return super.getList(e,t,s)}async getFirstListItem(e,t){return super.getFirstListItem(e,t)}async getOne(e,t){return super.getOne(e,t)}async create(e,t){return super.create(e,t)}async update(e,t,s){return super.update(e,t,s).then(e=>(this.client.authStore.model?.id!==e?.id||this.client.authStore.model?.collectionId!==this.collectionIdOrName&&this.client.authStore.model?.collectionName!==this.collectionIdOrName||this.client.authStore.save(this.client.authStore.token,e),e))}async delete(e,t){return super.delete(e,t).then(t=>(!t||this.client.authStore.model?.id!==e||this.client.authStore.model?.collectionId!==this.collectionIdOrName&&this.client.authStore.model?.collectionName!==this.collectionIdOrName||this.client.authStore.clear(),t))}authResponse(e){const t=this.decode(e?.record||{});return this.client.authStore.save(e?.token,t),Object.assign({},e,{token:e?.token||"",record:t})}async listAuthMethods(e){return e=Object.assign({method:"GET"},e),this.client.send(this.baseCollectionPath+"/auth-methods",e).then(e=>Object.assign({},e,{usernamePassword:!!e?.usernamePassword,emailPassword:!!e?.emailPassword,authProviders:Array.isArray(e?.authProviders)?e?.authProviders:[]}))}async authWithPassword(e,t,s,n){let i={method:"POST",body:{identity:e,password:t}};return i=T(0,i,s,n),this.client.send(this.baseCollectionPath+"/auth-with-password",i).then(e=>this.authResponse(e))}async authWithOAuth2Code(e,t,s,n,i,r,o){let a={method:"POST",body:{provider:e,code:t,codeVerifier:s,redirectUrl:n,createData:i}};return a=T(0,a,r,o),this.client.send(this.baseCollectionPath+"/auth-with-oauth2",a).then(e=>this.authResponse(e))}authWithOAuth2(...e){if(e.length>1||"string"==typeof e?.[0])return this.authWithOAuth2Code(e?.[0]||"",e?.[1]||"",e?.[2]||"",e?.[3]||"",e?.[4]||{},e?.[5]||{},e?.[6]||{});const t=e?.[0]||{};let s=null;t.urlCallback||(s=L(void 0));const n=new R(this.client);function i(){s?.close(),n.unsubscribe()}const r={},o=t.requestKey;return o&&(r.requestKey=o),this.listAuthMethods(r).then(e=>{const r=e.authProviders.find(e=>e.name===t.provider);if(!r)throw new h(new Error(`Missing or invalid provider "${t.provider}".`));const a=this.client.buildUrl("/api/oauth2-redirect"),c=o?this.client.cancelControllers?.[o]:void 0;return c&&(c.signal.onabort=()=>{i()}),new Promise(async(e,o)=>{try{await n.subscribe("@oauth2",async s=>{const l=n.clientId;try{if(!s.state||l!==s.state)throw new Error("State parameters don't match.");if(s.error||!s.code)throw new Error("OAuth2 redirect error or missing code: "+s.error);const n=Object.assign({},t);delete n.provider,delete n.scopes,delete n.createData,delete n.urlCallback,c?.signal?.onabort&&(c.signal.onabort=null);const i=await this.authWithOAuth2Code(r.name,s.code,r.codeVerifier,a,t.createData,n);e(i)}catch(e){o(new h(e))}i()});const l={state:n.clientId};t.scopes?.length&&(l.scope=t.scopes.join(" "));const u=this._replaceQueryParams(r.authUrl+a,l);let d=t.urlCallback||function(e){s?s.location.href=e:s=L(e)};await d(u)}catch(e){i(),o(new h(e))}})}).catch(e=>{throw i(),e})}async authRefresh(e,t){let s={method:"POST"};return s=T(0,s,e,t),this.client.send(this.baseCollectionPath+"/auth-refresh",s).then(e=>this.authResponse(e))}async requestPasswordReset(e,t,s){let n={method:"POST",body:{email:e}};return n=T(0,n,t,s),this.client.send(this.baseCollectionPath+"/request-password-reset",n).then(()=>!0)}async confirmPasswordReset(e,t,s,n,i){let r={method:"POST",body:{token:e,password:t,passwordConfirm:s}};return r=T(0,r,n,i),this.client.send(this.baseCollectionPath+"/confirm-password-reset",r).then(()=>!0)}async requestVerification(e,t,s){let n={method:"POST",body:{email:e}};return n=T(0,n,t,s),this.client.send(this.baseCollectionPath+"/request-verification",n).then(()=>!0)}async confirmVerification(e,t,s){let n={method:"POST",body:{token:e}};return n=T(0,n,t,s),this.client.send(this.baseCollectionPath+"/confirm-verification",n).then(()=>{const t=b(e),s=this.client.authStore.model;return s&&!s.verified&&s.id===t.id&&s.collectionId===t.collectionId&&(s.verified=!0,this.client.authStore.save(this.client.authStore.token,s)),!0})}async requestEmailChange(e,t,s){let n={method:"POST",body:{newEmail:e}};return n=T(0,n,t,s),this.client.send(this.baseCollectionPath+"/request-email-change",n).then(()=>!0)}async confirmEmailChange(e,t,s,n){let i={method:"POST",body:{token:e,password:t}};return i=T(0,i,s,n),this.client.send(this.baseCollectionPath+"/confirm-email-change",i).then(()=>{const t=b(e),s=this.client.authStore.model;return s&&s.id===t.id&&s.collectionId===t.collectionId&&this.client.authStore.clear(),!0})}async listExternalAuths(e,t){return t=Object.assign({method:"GET"},t),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e)+"/external-auths",t)}async unlinkExternalAuth(e,t,s){return s=Object.assign({method:"DELETE"},s),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e)+"/external-auths/"+encodeURIComponent(t),s).then(()=>!0)}_replaceQueryParams(e,t={}){let s=e,n="";e.indexOf("?")>=0&&(s=e.substring(0,e.indexOf("?")),n=e.substring(e.indexOf("?")+1));const i={},r=n.split("&");for(const o of r){if(""==o)continue;const e=o.split("=");i[decodeURIComponent(e[0].replace(/\+/g," "))]=decodeURIComponent((e[1]||"").replace(/\+/g," "))}for(let o in t)t.hasOwnProperty(o)&&(null==t[o]?delete i[o]:i[o]=t[o]);n="";for(let o in i)i.hasOwnProperty(o)&&(""!=n&&(n+="&"),n+=encodeURIComponent(o.replace(/%20/g,"+"))+"="+encodeURIComponent(i[o].replace(/%20/g,"+")));return""!=n?s+"?"+n:s}}function L(e){if("undefined"==typeof window||!window?.open)throw new h(new Error("Not in a browser context - please pass a custom urlCallback function."));let t=1024,s=768,n=window.innerWidth,i=window.innerHeight;t=t>n?n:t,s=s>i?i:s;let r=n/2-t/2,o=i/2-s/2;return window.open(e,"popup_window","width="+t+",height="+s+",top="+o+",left="+r+",resizable,menubar=no")}class U extends I{get baseCrudPath(){return"/api/collections"}async import(e,t=!1,s){return s=Object.assign({method:"PUT",body:{collections:e,deleteMissing:t}},s),this.client.send(this.baseCrudPath+"/import",s).then(()=>!0)}}class x extends O{async getList(e=1,t=30,s){return(s=Object.assign({method:"GET"},s)).query=Object.assign({page:e,perPage:t},s.query),this.client.send("/api/logs",s)}async getOne(e,t){if(!e)throw new h({url:this.client.buildUrl("/api/logs/"),status:404,response:{code:404,message:"Missing required log id.",data:{}}});return t=Object.assign({method:"GET"},t),this.client.send("/api/logs/"+encodeURIComponent(e),t)}async getStats(e){return e=Object.assign({method:"GET"},e),this.client.send("/api/logs/stats",e)}}class q extends O{async check(e){return e=Object.assign({method:"GET"},e),this.client.send("/api/health",e)}}class N extends O{getUrl(e,t,s={}){if(!t||!e?.id||!e?.collectionId&&!e?.collectionName)return"";const n=[];n.push("api"),n.push("files"),n.push(encodeURIComponent(e.collectionId||e.collectionName)),n.push(encodeURIComponent(e.id)),n.push(encodeURIComponent(t));let i=this.client.buildUrl(n.join("/"));if(Object.keys(s).length){!1===s.download&&delete s.download;const e=new URLSearchParams(s);i+=(i.includes("?")?"&":"?")+e}return i}async getToken(e){return e=Object.assign({method:"POST"},e),this.client.send("/api/files/token",e).then(e=>e?.token||"")}}class K extends O{async getFullList(e){return e=Object.assign({method:"GET"},e),this.client.send("/api/backups",e)}async create(e,t){return t=Object.assign({method:"POST",body:{name:e}},t),this.client.send("/api/backups",t).then(()=>!0)}async upload(e,t){return t=Object.assign({method:"POST",body:e},t),this.client.send("/api/backups/upload",t).then(()=>!0)}async delete(e,t){return t=Object.assign({method:"DELETE"},t),this.client.send(`/api/backups/${encodeURIComponent(e)}`,t).then(()=>!0)}async restore(e,t){return t=Object.assign({method:"POST"},t),this.client.send(`/api/backups/${encodeURIComponent(e)}/restore`,t).then(()=>!0)}getDownloadUrl(e,t){return this.client.buildUrl(`/api/backups/${encodeURIComponent(t)}?token=${encodeURIComponent(e)}`)}}const F=new class{enabled=!0;formatTimestamp(){return(new Date).toISOString()}formatMessage(e){return`${e.timestamp} ${e.prefix} ${e.action}`}logWithLevel(e){if(!this.enabled)return;this.formatMessage(e);const t=e.level||"log";if("error"===t||e.action.includes("START")||e.action.includes("BEGIN"),"error"===t)e.data;"error"===t||e.action.includes("END")||e.action.includes("COMPLETE")}log(e,t,s){this.logWithLevel({timestamp:this.formatTimestamp(),prefix:e,action:t,data:s,level:"log"})}info(e,t,s){this.logWithLevel({timestamp:this.formatTimestamp(),prefix:e,action:t,data:s,level:"info"})}warn(e,t,s){this.logWithLevel({timestamp:this.formatTimestamp(),prefix:e,action:t,data:s,level:"warn"})}error(e,t,s){this.logWithLevel({timestamp:this.formatTimestamp(),prefix:e,action:t,data:s,level:"error"})}group(e,t,s){if(this.enabled)try{s()}finally{}else s()}logObject(e,t,s){this.log(e,t,JSON.stringify(s,null,2))}logUrl(e,t,s){const n="string"==typeof s?new URL(s):s;n.href,n.origin,n.pathname,n.search,n.hash,Object.fromEntries(n.searchParams),this.parseHashParams(n.hash);this.group(e,`${t} - URL Details`,()=>{})}parseHashParams(e){if(!e||"#"===e)return{};const t={},s=e.substring(1).split("&");for(const n of s){const[e,s]=n.split("=");e&&(t[e]=s||"")}return t}logTokens(e,t,s){this.group(e,`${t} - Token Details`,()=>{Object.entries(s).forEach(([e,t])=>{if(e.toLowerCase().includes("token")||e.toLowerCase().includes("secret")){t&&(String(t).slice(0,8),String(t).slice(-8))}})})}logSession(e,t,s){s?this.group(e,`${t} - Session Details`,()=>{}):this.warn(e,`${t} - No session data`)}logApiResponse(e,t,s){this.group(e,`${t} - API Response`,()=>{s.error&&(s.error.message,s.error.status,s.error.code),s.data,s.session&&this.logSession(e,"Response session",s.session)})}},D="http://127.0.0.1:8090";F.log("[POCKETBASE]","Initializing PocketBase client",{url:D,environment:"production"});const _=new class{constructor(e="/",t,s="en-US"){this.cancelControllers={},this.recordServices={},this.enableAutoCancellation=!0,this.baseUrl=e,this.lang=s,this.authStore=t||new C,this.admins=new E(this),this.collections=new U(this),this.files=new N(this),this.logs=new x(this),this.settings=new v(this),this.realtime=new R(this),this.health=new q(this),this.backups=new K(this)}collection(e){return this.recordServices[e]||(this.recordServices[e]=new A(this,e)),this.recordServices[e]}autoCancellation(e){return this.enableAutoCancellation=!!e,this}cancelRequest(e){return this.cancelControllers[e]&&(this.cancelControllers[e].abort(),delete this.cancelControllers[e]),this}cancelAllRequests(){for(let e in this.cancelControllers)this.cancelControllers[e].abort();return this.cancelControllers={},this}filter(e,t){if(!t)return e;for(let s in t){let n=t[s];switch(typeof n){case"boolean":case"number":n=""+n;break;case"string":n="'"+n.replace(/'/g,"\\'")+"'";break;default:n=null===n?"null":n instanceof Date?"'"+n.toISOString().replace("T"," ")+"'":"'"+JSON.stringify(n).replace(/'/g,"\\'")+"'"}e=e.replaceAll("{:"+s+"}",n)}return e}getFileUrl(e,t,s={}){return this.files.getUrl(e,t,s)}buildUrl(e){let t=this.baseUrl;return"undefined"==typeof window||!window.location||t.startsWith("https://")||t.startsWith("http://")||(t=window.location.origin?.endsWith("/")?window.location.origin.substring(0,window.location.origin.length-1):window.location.origin||"",this.baseUrl.startsWith("/")||(t+=window.location.pathname||"/",t+=t.endsWith("/")?"":"/"),t+=this.baseUrl),e&&(t+=t.endsWith("/")?"":"/",t+=e.startsWith("/")?e.substring(1):e),t}async send(e,t){t=this.initSendOptions(e,t);let s=this.buildUrl(e);if(this.beforeSend){const e=Object.assign({},await this.beforeSend(s,t));void 0!==e.url||void 0!==e.options?(s=e.url||s,t=e.options||t):Object.keys(e).length&&(t=e,console)}if(void 0!==t.query){const e=this.serializeQueryParams(t.query);e&&(s+=(s.includes("?")?"&":"?")+e),delete t.query}return"application/json"==this.getHeader(t.headers,"Content-Type")&&t.body&&"string"!=typeof t.body&&(t.body=JSON.stringify(t.body)),(t.fetch||fetch)(s,t).then(async e=>{let t={};try{t=await e.json()}catch(e){}if(this.afterSend&&(t=await this.afterSend(e,t)),e.status>=400)throw new h({url:e.url,status:e.status,data:t});return t}).catch(e=>{throw new h(e)})}initSendOptions(e,t){if((t=Object.assign({method:"GET"},t)).body=this.convertToFormDataIfNeeded(t.body),j(t),t.query=Object.assign({},t.params,t.query),void 0===t.requestKey&&(!1===t.$autoCancel||!1===t.query.$autoCancel?t.requestKey=null:(t.$cancelKey||t.query.$cancelKey)&&(t.requestKey=t.$cancelKey||t.query.$cancelKey)),delete t.$autoCancel,delete t.query.$autoCancel,delete t.$cancelKey,delete t.query.$cancelKey,null!==this.getHeader(t.headers,"Content-Type")||this.isFormData(t.body)||(t.headers=Object.assign({},t.headers,{"Content-Type":"application/json"})),null===this.getHeader(t.headers,"Accept-Language")&&(t.headers=Object.assign({},t.headers,{"Accept-Language":this.lang})),this.authStore.token&&null===this.getHeader(t.headers,"Authorization")&&(t.headers=Object.assign({},t.headers,{Authorization:this.authStore.token})),this.enableAutoCancellation&&null!==t.requestKey){const s=t.requestKey||(t.method||"GET")+e;delete t.requestKey,this.cancelRequest(s);const n=new AbortController;this.cancelControllers[s]=n,t.signal=n.signal}return t}convertToFormDataIfNeeded(e){if("undefined"==typeof FormData||void 0===e||"object"!=typeof e||null===e||this.isFormData(e)||!this.hasBlobField(e))return e;const t=new FormData;for(const s in e){const n=e[s];if("object"!=typeof n||this.hasBlobField({data:n})){const e=Array.isArray(n)?n:[n];for(let n of e)t.append(s,n)}else{let e={};e[s]=n,t.append("@jsonPayload",JSON.stringify(e))}}return t}hasBlobField(e){for(const t in e){const s=Array.isArray(e[t])?e[t]:[e[t]];for(const e of s)if("undefined"!=typeof Blob&&e instanceof Blob||"undefined"!=typeof File&&e instanceof File)return!0}return!1}getHeader(e,t){e=e||{},t=t.toLowerCase();for(let s in e)if(s.toLowerCase()==t)return e[s];return null}isFormData(e){return e&&("FormData"===e.constructor.name||"undefined"!=typeof FormData&&e instanceof FormData)}serializeQueryParams(e){const t=[];for(const s in e){if(null===e[s])continue;const n=e[s],i=encodeURIComponent(s);if(Array.isArray(n))for(const e of n)t.push(i+"="+encodeURIComponent(e));else n instanceof Date?t.push(i+"="+encodeURIComponent(n.toISOString())):null!==typeof n&&"object"==typeof n?t.push(i+"="+encodeURIComponent(JSON.stringify(n))):t.push(i+"="+encodeURIComponent(n))}return t.join("&")}}(D);F.log("[POCKETBASE]","PocketBase client created successfully"),_.authStore.onChange((e,t)=>{F.info("[POCKETBASE]","Low-level auth state change",{hasToken:!!e,hasRecord:!!t,userId:t?.id,userEmail:t?.email,timestamp:(new Date).toISOString()}),e&&t?F.log("[POCKETBASE]","User authenticated",{userId:t.id,email:t.email,username:t.username}):e||t||F.log("[POCKETBASE]","User signed out")}),F.log("[POCKETBASE]","PocketBase client initialization complete",{timestamp:(new Date).toISOString()});function B(e,t){let s;try{s=e()}catch(n){return}return{getItem:e=>{var t;const n=e=>null===e?null:JSON.parse(e,void 0),i=null!=(t=s.getItem(e))?t:null;return i instanceof Promise?i.then(n):n(i)},setItem:(e,t)=>s.setItem(e,JSON.stringify(t,void 0)),removeItem:e=>s.removeItem(e)}}const $=e=>t=>{try{const s=e(t);return s instanceof Promise?s:{then:e=>$(e)(s),catch(e){return this}}}catch(u){return{then(e){return this},catch:t=>$(t)(u)}}},H=(e,t)=>"getStorage"in t||"serialize"in t||"deserialize"in t?((e,t)=>(s,n,i)=>{let r={getStorage:()=>localStorage,serialize:JSON.stringify,deserialize:JSON.parse,partialize:e=>e,version:0,merge:(e,t)=>({...t,...e}),...t},o=!1;const a=new Set,c=new Set;let l;try{l=r.getStorage()}catch(f){}if(!l)return e((...e)=>{s(...e)},n,i);const h=$(r.serialize),u=()=>{const e=r.partialize({...n()});let t;const s=h({state:e,version:r.version}).then(e=>l.setItem(r.name,e)).catch(e=>{t=e});if(t)throw t;return s},d=i.setState;i.setState=(e,t)=>{d(e,t),u()};const p=e((...e)=>{s(...e),u()},n,i);let g;const m=()=>{var e;if(!l)return;o=!1,a.forEach(e=>e(n()));const t=(null==(e=r.onRehydrateStorage)?void 0:e.call(r,n()))||void 0;return $(l.getItem.bind(l))(r.name).then(e=>{if(e)return r.deserialize(e)}).then(e=>{if(e){if("number"!=typeof e.version||e.version===r.version)return e.state;if(r.migrate)return r.migrate(e.state,e.version)}}).then(e=>{var t;return g=r.merge(e,null!=(t=n())?t:p),s(g,!0),u()}).then(()=>{null==t||t(g,void 0),o=!0,c.forEach(e=>e(g))}).catch(e=>{null==t||t(void 0,e)})};return i.persist={setOptions:e=>{r={...r,...e},e.getStorage&&(l=e.getStorage())},clearStorage:()=>{null==l||l.removeItem(r.name)},getOptions:()=>r,rehydrate:()=>m(),hasHydrated:()=>o,onHydrate:e=>(a.add(e),()=>{a.delete(e)}),onFinishHydration:e=>(c.add(e),()=>{c.delete(e)})},m(),g||p})(e,t):((e,t)=>(s,n,i)=>{let r={storage:B(()=>localStorage),partialize:e=>e,version:0,merge:(e,t)=>({...t,...e}),...t},o=!1;const a=new Set,c=new Set;let l=r.storage;if(!l)return e((...e)=>{s(...e)},n,i);const h=()=>{const e=r.partialize({...n()});return l.setItem(r.name,{state:e,version:r.version})},u=i.setState;i.setState=(e,t)=>{u(e,t),h()};const d=e((...e)=>{s(...e),h()},n,i);let p;i.getInitialState=()=>d;const g=()=>{var e,t;if(!l)return;o=!1,a.forEach(e=>{var t;return e(null!=(t=n())?t:d)});const i=(null==(t=r.onRehydrateStorage)?void 0:t.call(r,null!=(e=n())?e:d))||void 0;return $(l.getItem.bind(l))(r.name).then(e=>{if(e){if("number"!=typeof e.version||e.version===r.version)return[!1,e.state];if(r.migrate)return[!0,r.migrate(e.state,e.version)]}return[!1,void 0]}).then(e=>{var t;const[i,o]=e;if(p=r.merge(o,null!=(t=n())?t:d),s(p,!0),i)return h()}).then(()=>{null==i||i(p,void 0),p=n(),o=!0,c.forEach(e=>e(p))}).catch(e=>{null==i||i(void 0,e)})};return i.persist={setOptions:e=>{r={...r,...e},e.storage&&(l=e.storage)},clearStorage:()=>{null==l||l.removeItem(r.name)},getOptions:()=>r,rehydrate:()=>g(),hasHydrated:()=>o,onHydrate:e=>(a.add(e),()=>{a.delete(e)}),onFinishHydration:e=>(c.add(e),()=>{c.delete(e)})},r.skipHydration||g(),p||d})(e,t);export{H as a,l as c,F as d,_ as p};
//# sourceMappingURL=data-vendor-DCs_U7y1.js.map
